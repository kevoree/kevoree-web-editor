"use strict";angular.module("editorApp",["ngAnimate","ngTouch","ui.router","ui.bootstrap","ui.codemirror","ui-notification","cfp.hotkeys","ngDragDrop","hljs","infinite-scroll"]).run(["$rootScope","$stateParams","kEditor","kFactory","kRegistry","kWs","Notification","VERSION",function(e,t,n,a,r,o,i,s){e.VERSION=s,e.dndLoad=function(e,t){var r,o=n.getModel(),s=a.createJSONLoader();try{r=s.loadModelFromString(t).get(0)}catch(t){return console.error("[app.dndLoad()] Error loading model file"),console.error(t.stack),i.error({title:"Open from file (dnd)",message:"Unable to load a model from <strong>"+e+"</strong>"}),void n.setModel(o)}n.setModel(r,function(t){t?i.error({title:"Open from file (dnd)",message:"Unable to load model from <strong>"+e+"</strong><br/>"+t.message,delay:15e3}):i.success({title:"Open from file (dnd)",message:"Model loaded from <strong>"+e+"</strong>"})})},e.keys=function(e){return!!angular.isObject(e)&&Object.keys(e)},jQuery("#bootstrap-container").fadeOut(function(){this.remove(),t.host&&o.getModel(t.host,t.port||9e3,t.path||"",function(e,t,a){e?i.error({title:"Open from node",message:"Unable to load model from <strong>"+a+"</strong>"}):(n.setModel(t),i.success({title:"Open from node",message:"Model loaded from <strong>"+a+"</strong>"}))})})}]),angular.module("editorApp").config(["$stateProvider",function(e){e.state("treeview",{parent:"app",url:"/treeview",views:{"content@":{templateUrl:"app/treeview/treeview.html",controller:"TreeViewCtrl"}},onExit:["kEditor",function(e){e.removeModelUpdateListeners("treeview")}]})}]),angular.module("editorApp").controller("TreeViewCtrl",["$scope","$timeout","$filter","$uibModal","kEditor","kModelHelper","kFactory","kWs","kFilterParser","saveFile","hotkeys","Notification",function(e,t,n,a,r,o,i,s,l,c,d,p){function u(t){e.nbInstances+=1;var n={name:t.name,kevsName:t.eContainer().name+"."+t.name,type:"component",typeName:t.typeDefinition.name,version:t.typeDefinition.version,tags:o.getTags(t),path:t.path(),selected:o.isSelected(t)};return n.selected&&e.selectedItems.push(n),n}function f(t){e.nbInstances+=1;var n={name:t.name,type:"node",typeName:t.typeDefinition.name,version:t.typeDefinition.version,tags:o.getTags(t),path:t.path(),folded:o.isFolded(t),selected:o.isSelected(t),children:t.components.array.map(u)};return n.selected&&e.selectedItems.push(n),n}function m(t){e.nbInstances+=1;var n={name:t.name,type:"group",typeName:t.typeDefinition.name,version:t.typeDefinition.version,tags:o.getTags(t),path:t.path(),selected:o.isSelected(t)};return n.selected&&e.selectedItems.push(n),n}function h(t){e.nbInstances+=1;var n={name:t.name,type:"channel",typeName:t.typeDefinition.name,version:t.typeDefinition.version,tags:o.getTags(t),path:t.path(),selected:o.isSelected(t)};return n.selected&&e.selectedItems.push(n),n}function g(e){return e.nodes.array.map(f).concat(e.groups.array.map(m)).concat(e.hubs.array.map(h))}function v(t){for(var n=0;n<e.items.length;n++)if(e.items[n].path===t)return void(e.items[n].folded&&(e.items[n].folded=!1,o.setFolded(r.getModel().findByPath(e.items[n].path),!1)))}function y(){e.nbInstances=0,e.selectedItems=[],e.items=g(r.getModel())}function b(e){D=e.ctrlKey}function k(e){D=e.ctrlKey}function x(t){D||e.clearSelected(),e.items.forEach(function(n){n.type===t&&(n.selected=!0,e.selectedItems.push(n),o.setSelected(r.getModel().findByPath(n.path),!0))})}e.items=[],e.limit=30,e.nbInstances=0,e.showTags=!0,e.selectedItems=[],e.filterExpr="",e.filterComparator=!1,e.treeReverse=!1,e.query=null;var C=r.addNewModelListener("treeview",y);y();var D=!1;document.addEventListener("keydown",b),document.addEventListener("keyup",k),e.loadMore=function(){e.items.length>e.limit&&(e.limit+=10)},e.onClick=function(t){var n=t.selected;D||(n&&e.selectedItems.length>1&&e.selectedItems.indexOf(t)!==-1&&(n=!n),e.selectedItems.forEach(function(e){o.setSelected(r.getModel().findByPath(e.path),!1),e.selected=!1}),e.selectedItems.length=0),o.setSelected(r.getModel().findByPath(t.path),!n),t.selected=!n,t.selected?e.selectedItems.push(t):e.selectedItems.splice(e.selectedItems.indexOf(t),1)},e.onExpand=function(e){e.folded=!e.folded,o.setFolded(r.getModel().findByPath(e.path),e.folded)},e.collapse=function(){e.items.forEach(function(e){"node"===e.type&&(e.folded=!0,o.setFolded(r.getModel().findByPath(e.path),!0))})},e.expand=function(){e.items.forEach(function(e){"node"===e.type&&(e.folded=!1,o.setFolded(r.getModel().findByPath(e.path),!1))})},e.selectAll=function(){e.selectedItems.length=0,e.items.forEach(function(t){t.selected=!0;var n=r.getModel().findByPath(t.path);o.setSelected(n,!0),e.selectedItems.push(t),t.children&&t.children.forEach(function(a){a.selected=!0,t.folded=!1,o.setFolded(n,!1),o.setSelected(r.getModel().findByPath(a.path),!0),e.selectedItems.push(a)})})},e.selectNodes=function(){x("node")},e.selectGroups=function(){x("group")},e.selectChannels=function(){x("channel")},e.selectComponents=function(){D||e.clearSelected(),e.items.forEach(function(t){"node"===t.type&&t.children&&t.children.forEach(function(n){t.folded=!1,n.selected=!0,o.setFolded(r.getModel().findByPath(t.path),!1),o.setSelected(r.getModel().findByPath(n.path),!0),e.selectedItems.push(n)})})},e.selectByTag=function(t){D||e.clearSelected(),t.forEach(function(t){t.selected=!0,e.selectedItems.push(t);var n=r.getModel().findByPath(t.path);o.setSelected(n,!0),"component"===t.type&&v(n.eContainer().path())})},e.clearSelected=function(){e.selectedItems.forEach(function e(t){t.selected=!1,o.setSelected(r.getModel().findByPath(t.path),!1),t.children&&t.children.forEach(e)}),e.selectedItems.length=0},e.toggleTags=function(){e.showTags=!e.showTags},e.reverseSort=function(){e.treeReverse=!e.treeReverse},e.createItem=function(t,n,a){switch(t){case"node":e.items.push(f(n));break;case"group":e.items.push(m(n));break;case"channel":e.items.push(h(n));break;case"component":for(var r=0;r<e.items.length;r++)if(e.items[r].path===a.path()){e.items[r].children.push(u(n));break}}},e.clearFilter=function(){e.query=null,e.filterExpr="",e.filterError=null};var w;e.onFilterExprChanged=function(){t.cancel(w),w=t(function(){e.parseFilterExpr()},300)},e.parseFilterExpr=function(){if(0===e.filterExpr.length)e.query=null,e.filterError=null;else try{e.query=l.parse(e.filterExpr),e.filterError=null}catch(t){e.query=null,e.filterError=t.name+': "'+t.found+'" at col.'+t.location.start.column}},e.open=function(n){n.preventDefault(),e.onFileLoaded=function(n,a){t(function(){e.loading=!0,t(function(){var t=r.getModel();try{var o=i.createJSONLoader(),s=o.loadModelFromString(a).get(0);r.setModel(s),p.success({title:"Open from file",message:"Model loaded from <strong>"+n+"</strong>"})}catch(e){console.warn("[treeview.controller.open()] Error loading model file"),console.error(e.stack),p.error({title:"Open from file",message:"Unable to load a model from <strong>"+n+"</strong>"}),r.setModel(t)}finally{e.loading=!1}})})},jQuery("input#file").click()},e.merge=function(n){n.preventDefault(),e.onFileLoaded=function(n,a){t(function(){e.loading=!0,t(function(){try{var t=i.createJSONLoader(),o=i.createModelCompare(),s=t.loadModelFromString(a).get(0);o.merge(s,r.getModel()).applyOn(s),r.setModel(s),p.success({title:"Merge from file",message:"Model merged with <strong>"+n+"</strong>"})}catch(e){console.warn("[treeview.controller.merge()] Error loading model file"),console.error(e.stack),p.error({title:"Merge from file",message:"Unable to merge the model with <strong>"+n+"</strong>"})}finally{e.loading=!1}})})},jQuery("input#file").click()},e.openFromNode=function(e){e.preventDefault(),a.open({templateUrl:"app/components/util/host-port-path.modal.html",size:"md",controller:["$scope","$uibModalInstance","storage",function(e,n,a){e.title="Open from node",e.action="Open",e.host=a.get("previous-host","127.0.0.1"),e.port=9e3,e.path="/",e.onHostChange=function(e){a.set("previous-host",e)},n.rendered.then(function(){t(function(){jQuery("#host").focus()},250)}),e.confirm=function(){e.closeError(),s.getModel(e.host,e.port,e.path,function(a,o,i){a?t(function(){e.error=a.message}):(r.setModel(o),p.success({title:e.title,message:"Model loaded from <strong>"+i+"</strong>"}),n.close())})},e.closeError=function(){e.error=null}}]})},e.mergeFromNode=function(e){e.preventDefault(),a.open({templateUrl:"app/components/util/host-port-path.modal.html",size:"md",controller:["$scope","$uibModalInstance","kWs","storage",function(e,n,a,o){e.title="Merge from node",e.action="Merge",e.host=o.get("previous-host","127.0.0.1"),e.port=9e3,e.path="/",e.onHostChange=function(e){o.set("previous-host",e)},n.rendered.then(function(){t(function(){jQuery("#host").focus()},250)}),e.confirm=function(){e.closeError(),a.getModel(e.host,e.port,e.path,function(a,o,s){if(a)t(function(){e.error=a.message});else{var l=i.createModelCompare();l.merge(o,r.getModel()).applyOn(o),r.setModel(o),p.success({title:e.title,message:"Model merged with <strong>"+s+"</strong>"}),n.close()}})},e.closeError=function(){e.error=null}}]})},e.save=function(e,t){e.preventDefault();var n=i.createJSONSerializer();try{var a=n.serialize(r.getModel());a=JSON.stringify(JSON.parse(a),null,4),c.save(a,t,".json","application/json")}catch(e){p.error({title:"Save",message:"Unable to serialize model to JSON"})}},e.deleteAll=function(t){t.preventDefault(),e.deleteInstances(t),r.getModel().removeAllPackages()},e.deleteInstances=function(e){e.preventDefault();var t=r.getModel();t.removeAllNodes(),t.removeAllGroups(),t.removeAllHubs(),t.removeAllMBindings(),t.removeAllRepositories(),y()},e.deleteSelection=function(e){e.preventDefault();var t=o.getSelection(r.getModel());0===t.length?p.warning({title:"Delete selection",message:"Nothing selected"}):(t.forEach(function(e){e.delete()}),y())},e.toggleShortcutHelp=function(){d.toggleCheatSheet()},d.bindTo(e).add({combo:"ctrl+o",description:"Open a model from a file",callback:e.open}),d.bindTo(e).add({combo:"ctrl+m",description:"Merge a model from a file with current model in editor",callback:e.merge}),d.bindTo(e).add({combo:"ctrl+shift+o",description:"Open a model from a node",callback:e.openFromNode}),d.bindTo(e).add({combo:"ctrl+shift+m",description:"Merge a model from a node with current model in editor",callback:e.mergeFromNode}),d.bindTo(e).add({combo:"ctrl+shift+g",description:"Connect to a Web Socket server and stay synced with it",callback:e.connectSync}),d.bindTo(e).add({combo:"ctrl+s",description:"Save the current model into a JSON file",callback:function(n){n.preventDefault();var r=e.save;a.open({templateUrl:"app/components/util/filename.modal.html",size:"sm",controller:["$scope","$uibModalInstance",function(e,a){e.title="Save model",e.body="Would you like to save your current model to a file?",e.filename="model"+(Math.floor(900*Math.random())+100),a.rendered.then(function(){t(function(){jQuery("#filename").focus()},250)}),e.save=function(){function t(e,t){return e.indexOf(t,e.length-t.length)!==-1}var o=".json";t(e.filename,o)&&(e.filename=e.filename.substr(0,e.filename.length-o.length)),r(n,e.filename),a.close()}}]})}}),d.bindTo(e).add({combo:"alt+shift+d",description:"Delete everything in the current model",callback:e.deleteAll}),d.bindTo(e).add({combo:"alt+shift+i",description:"Delete instances in the current model",callback:e.deleteInstances}),d.bindTo(e).add({combo:"del",description:"Delete selected instances in the current model",callback:e.deleteSelection}),d.bindTo(e).add({combo:"ctrl+a",description:"Select all instances",callback:function(t){t.preventDefault(),e.selectAll()}}),e.$on("$destroy",function(){C(),document.removeEventListener("keydown",b),document.removeEventListener("keyup",k),t.cancel(w)})}]),angular.module("editorApp").directive("tabTags",function(){return{restrict:"E",scope:!0,templateUrl:"app/treeview/tab-tags/tab-tags.html",controller:["$scope","kEditor","kFactory","kModelHelper","KWE_TAG",function(e,t,n,a,r){function o(){e.tags=[],e.selectedItems.forEach(function(n){var r=t.getModel().findByPath(n.path);a.getTags(r).forEach(function(t){e.tags.indexOf(t)===-1&&e.tags.push(t)})})}function i(e,t){var n=t.split(","),a=n.indexOf(e);return a!==-1&&n.splice(a,1),n}e.tag="",e.tags=[],o();var s=e.$watchCollection("selectedItems",o);e.$on("$destroy",s),e.addTag=function(){e.tag.trim().length>0&&e.tag.indexOf(",")===-1&&(e.tag=e.tag.trim(),e.selectedItems.forEach(function(o){var i=t.getModel().findByPath(o.path),s=i.findMetaDataByID(r);s||(s=n.createValue(),s.name=r,s.value="",i.addMetaData(s));var l=a.getTags(i);l.indexOf(e.tag)===-1&&(l.push(e.tag),o.tags.push(e.tag)),e.tags.indexOf(e.tag)===-1&&e.tags.push(e.tag),s.value=l.join(",")}),e.tag="")},e.validate=function(){e.tag.indexOf(",")!==-1?e.error='Character "," is not allowed in a tag':e.error=null},e.removeTag=function(n){e.tags.splice(e.tags.indexOf(n),1),e.selectedItems.forEach(function(e){var a=t.getModel().findByPath(e.path),o=a.findMetaDataByID(r);if(o){var s=i(n,o.value);o.value=s.join(","),e.tags=s}})}}]}}),angular.module("editorApp").directive("tabParams",["$timeout","kEditor","kModelHelper","kInstance","util",function(e,t,n,a,r){return{restrict:"E",scope:!0,templateUrl:"app/treeview/tab-params/tab-params.html",link:function(o){function i(e){switch(e){case"LONG":case"DOUBLE":case"FLOAT":case"SHORT":case"INT":return"number";case"BOOLEAN":return"boolean";default:return"text"}}function s(){o.message=null,o.error=!1,o.length={},o.prepend={},o.append={},o.min={},o.max={},o.each={},o.toggleEachFlag=!1,o.state={started:null},o.nets=[];var e=t.getModel();if(o.selectedItems.length>1){var s=e.findByPath(o.selectedItems[0].path);o.types=[s.name+": "+n.getFqn(s.typeDefinition)];for(var l=1;l<o.selectedItems.length;l++){var c=e.findByPath(o.selectedItems[l-1].path),d=e.findByPath(o.selectedItems[l].path);if(n.getFqn(c.typeDefinition)!==n.getFqn(d.typeDefinition))return o.types.push(d.name+": "+n.getFqn(d.typeDefinition)),void(o.error=!0)}}o.selectedItems.forEach(function(e){var n=t.getModel().findByPath(e.path);a.initDictionaries(n)}),o.util=r,o.instance=e.findByPath(o.selectedItems[0].path),1===o.selectedItems.length?o.state.started=o.instance.started:o.state.started=null,o.type=o.instance.typeDefinition,o.typeName=n.getFqn(o.type),o.dictionary=[],o.type.dictionaryType&&(o.dictionary=o.type.dictionaryType.select("attributes[fragmentDependant=false]").array.map(function(e){var t,a=i(e.datatype.name());if(1===o.selectedItems.length&&o.instance.dictionary){var r=o.instance.dictionary.findValuesByID(e.name);if(r)switch(a){case"number":t=+r.value;break;default:t=r.value}}var s={name:e.name,optional:n.isTruish(e.optional),defaultValue:e.defaultValue,type:a,value:t};return s})),o.instance.networkInformation&&o.instance.networkInformation.array.forEach(function(e){o.nets.push({name:e.name,values:e.values.array.map(function(e){return{name:e.name,value:e.value}})})})}s();var l=o.$watchCollection("selectedItems",s);o.$on("$destroy",l),o.applyToAllInstances=function(){try{o.selectedItems.forEach(function(e){var n=t.getModel().findByPath(e.path);n.started=o.state.started,o.dictionary.forEach(function(e){var t=n.dictionary.findValuesByID(e.name);o.each[e.name]&&o.random(e),t.value=e.value})}),o.dictionary.forEach(function(e){e.value=null}),s(),o.message={type:"success",content:"Success"}}catch(e){o.message={type:"danger",content:"Error (check console for more information)"},console.error("[treeview.tab-params.applyToAllInstances()] Error"),console.error(e.stack)}e(function(){o.message=null},1500)},o.random=function(e){switch(e.type){case"text":e.value=o.prepend[e.name]+r.randomString(o.length[e.name])+o.append[e.name];break;case"number":e.value=r.randomNumber(o.min[e.name],o.max[e.name]);break;case"boolean":e.value=r.randomBoolean()+""}},o.allRandom=function(){o.dictionary.forEach(o.random)},o.toggleEach=function(){o.toggleEachFlag=!o.toggleEachFlag,Object.keys(o.each).forEach(function(e){o.each[e]=o.toggleEachFlag})}}}}]),angular.module("editorApp").directive("tabCreate",["$timeout","$filter","kFactory","kEditor","kInstance","kModelHelper","util","KWE_TAG",function(e,t,n,a,r,o,i,s){return{restrict:"E",scope:!0,templateUrl:"app/treeview/tab-create/tab-create.html",link:function(e){function i(e){return{name:o.getFqn(e),tdef:e}}function l(){var t=a.getModel();e.tags="",e.name="",e.types=["node","group","channel","component"],e.instanceTypes={node:o.getNodeTypes(t).map(i),group:o.getGroupTypes(t).map(i),channel:o.getChannelTypes(t).map(i),component:o.getComponentTypes(t).map(i)},e.selectedType=e.types[0],e.instanceTypes[e.selectedType].length>0&&(e.selectedInstanceType=e.instanceTypes[e.selectedType][0]),e.availableNodes=e.items.filter(function(e){return"node"===e.type}),e.selectedNode=e.availableNodes[0],e.instancesCount=1,e.verifyName()}function c(){for(var a=[],o=0;o<e.instancesCount;o++){var i,l=t("namingPattern")(e.namePattern,{index:o,metatype:e.selectedType});switch(e.selectedType){case"node":i=n.createContainerNode();break;case"group":i=n.createGroup();break;case"channel":i=n.createChannel();break;case"component":i=n.createComponentInstance()}i.name=l,i.typeDefinition=e.selectedInstanceType.tdef,i.started=e.state.started,r.initDictionaries(i);var c=e.tags.split(",").map(function(e){return e.trim()}).filter(function(e){return e.length>0}).join(","),d=n.createValue();d.name=s,d.value=c,i.addMetaData(d),a.push(i)}return a}e.$on("$destroy",e.$watchCollection("selectedItems",function(){e.verifyName()})),e.namePattern="{metatype}{index}",e.state={started:!0},e.tags="",e.verifyName=function(){var n,r;switch(e.selectedType){case"node":for(n=0;n<e.instancesCount;n++)if(r=t("namingPattern")(e.namePattern,{index:n,metatype:e.selectedType}),a.getModel().findNodesByID(r))return void(e.message={type:"danger",content:'There is already a node named "'+r+'"'});break;case"group":for(n=0;n<e.instancesCount;n++)if(r=t("namingPattern")(e.namePattern,{index:n,metatype:e.selectedType}),a.getModel().findGroupsByID(r))return void(e.message={type:"danger",content:'There is already a group named "'+r+'"'});break;case"channel":for(n=0;n<e.instancesCount;n++)if(r=t("namingPattern")(e.namePattern,{index:n,metatype:e.selectedType}),a.getModel().findHubsByID(r))return void(e.message={type:"danger",content:'There is already a channel named "'+r+'"'});break;case"component":if(0===e.selectedItems.length)return void(e.message={type:"danger",content:"You must select node instances in the tree view in order to add components"});for(n=0;n<e.instancesCount;n++){r=t("namingPattern")(e.namePattern,{index:n,metatype:e.selectedType});for(var o=0;o<e.selectedItems.length;o++){var i=a.getModel().findNodesByID(e.selectedItems[o].name);if(!i)return void(e.message={type:"danger",content:'"'+e.selectedItems[o].name+'" is not a node instance'});if(i.findComponentsByID(r))return void(e.message={type:"danger",content:'There is already a component named "'+r+'" in node "'+i.name+'"'})}}}e.message=null},l();var d=a.addNewModelListener("treeview",l),p=e.$watchCollection("items",l);e.$on("$destroy",function(){d(),p()}),e.create=function(){var t=a.getModel();switch(e.selectedType){case"node":c().forEach(function(n){t.addNodes(n),e.createItem(e.selectedType,n)});break;case"group":c().forEach(function(n){t.addGroups(n),e.createItem(e.selectedType,n)});break;case"channel":c().forEach(function(n){t.addHubs(n),e.createItem(e.selectedType,n)});break;case"component":e.selectedItems.forEach(function(n){var a=t.findNodesByID(n.name);c().forEach(function(t){a.addComponents(t),e.createItem(e.selectedType,t,a)})})}},e.onTypeChange=function(){e.verifyName()},e.areInstanceTypesValid=function(){return"component"===e.selectedType?e.availableNodes.length>0&&e.instanceTypes[e.selectedType].length>0:e.instanceTypes[e.selectedType].length>0},e.isValid=function(){return!("component"===e.selectedType&&!e.selectedNode)&&(!e.message&&e.namePattern.trim().length>0&&e.selectedType.length>0&&e.instancesCount>0&&e.selectedInstanceType)}}}}]),angular.module("editorApp").directive("tabActions",["$filter","$uibModal","kEditor",function(e,t,n){return{restrict:"E",scope:!0,templateUrl:"app/treeview/tab-actions/tab-actions.html",link:function(a){function r(){var t=n.getModel();a.groups=t.groups.array,a.selectedGroup=e("orderBy")(a.groups,"name")[0]}function o(){a.tags={},a.items.forEach(function e(t){t.tags.forEach(function(e){a.tags[e]||(a.tags[e]=[]),a.tags[e].push(t)}),t.children&&t.children.forEach(e)}),a.tagsCount=Object.keys(a.tags).length}function i(){r(),o()}i();var s=a.$watchCollection("items",i),l=a.$watch("items",function(){o()},!0);a.$on("$destroy",function(){s(),l()}),a.openGroupModal=function(){t.open({templateUrl:"app/main/instance/group.modal.html",size:"md",resolve:{group:function(){return a.selectedGroup}},controller:"GroupModalCtrl"})}}}}]),angular.module("editorApp").factory("kFilterParser",function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,n,a,r){this.message=e,this.expected=n,this.found=a,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}function n(e){function n(){return e.substring(at,nt)}function a(t){throw s(t,null,e.substring(at,nt),o(at,nt))}function r(t){var n,a,r=rt[t];if(r)return r;for(n=t-1;!rt[n];)n--;for(r=rt[n],r={line:r.line,column:r.column,seenCR:r.seenCR};n<t;)a=e.charAt(n),"\n"===a?(r.seenCR||r.line++,r.column=1,r.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(r.line++,r.column=1,r.seenCR=!0):(r.column++,r.seenCR=!1),n++;return rt[t]=r,r}function o(e,t){var n=r(e),a=r(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:a.line,column:a.column}}}function i(e){nt<ot||(nt>ot&&(ot=nt,it=[]),it.push(e))}function s(e,n,a,r){function o(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function i(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+t(e)})}var a,r,o,i=new Array(e.length);for(o=0;o<e.length;o++)i[o]=e[o].description;return a=e.length>1?i.slice(0,-1).join(", ")+" or "+i[e.length-1]:i[0],r=t?'"'+n(t)+'"':"end of input","Expected "+a+" but "+r+" found."}return null!==n&&o(n),new t(null!==e?e:i(n,a),n,a,r)}function l(){var t,n,a,r,o,s,l,d;if(t=nt,n=c(),n!==I){for(a=[],r=nt,o=S(),o!==I?(124===e.charCodeAt(nt)?(s=L,nt++):(s=I,0===st&&i(O)),s!==I?(l=S(),l!==I?(d=c(),d!==I?(o=[o,s,l,d],r=o):(nt=r,r=I)):(nt=r,r=I)):(nt=r,r=I)):(nt=r,r=I);r!==I;)a.push(r),r=nt,o=S(),o!==I?(124===e.charCodeAt(nt)?(s=L,nt++):(s=I,0===st&&i(O)),s!==I?(l=S(),l!==I?(d=c(),d!==I?(o=[o,s,l,d],r=o):(nt=r,r=I)):(nt=r,r=I)):(nt=r,r=I)):(nt=r,r=I);a!==I?(at=t,n=U(n,a),t=n):(nt=t,t=I)}else nt=t,t=I;return t}function c(){var t,n,a,r,o,s,l,c;if(t=nt,n=d(),n!==I){for(a=[],r=nt,o=S(),o!==I?(38===e.charCodeAt(nt)?(s=V,nt++):(s=I,0===st&&i(H)),s!==I?(l=S(),l!==I?(c=d(),c!==I?(o=[o,s,l,c],r=o):(nt=r,r=I)):(nt=r,r=I)):(nt=r,r=I)):(nt=r,r=I);r!==I;)a.push(r),r=nt,o=S(),o!==I?(38===e.charCodeAt(nt)?(s=V,nt++):(s=I,0===st&&i(H)),s!==I?(l=S(),l!==I?(c=d(),c!==I?(o=[o,s,l,c],r=o):(nt=r,r=I)):(nt=r,r=I)):(nt=r,r=I)):(nt=r,r=I);a!==I?(at=t,n=R(n,a),t=n):(nt=t,t=I)}else nt=t,t=I;return t}function d(){var t,n,a,r,o,s;return t=nt,40===e.charCodeAt(nt)?(n=F,nt++):(n=I,0===st&&i(W)),n!==I?(a=S(),a!==I?(r=l(),r!==I?(o=S(),o!==I?(41===e.charCodeAt(nt)?(s=G,nt++):(s=I,0===st&&i(_)),s!==I?(at=t,n=j(r),t=n):(nt=t,t=I)):(nt=t,t=I)):(nt=t,t=I)):(nt=t,t=I)):(nt=t,t=I),t===I&&(t=p()),t}function p(){var e;return e=f(),e===I&&(e=m(),e===I&&(e=g(),e===I&&(e=h(),e===I&&(e=u())))),e}function u(){var t,n,a;return st++,t=nt,e.substr(nt,5)===z?(n=z,nt+=5):(n=I,0===st&&i(q)),n!==I?(a=v(),a!==I?(at=t,n=Q(a),t=n):(nt=t,t=I)):(nt=t,t=I),st--,t===I&&(n=I,0===st&&i(K)),t}function f(){var t,n,a;return st++,t=nt,e.substr(nt,3)===Z?(n=Z,nt+=3):(n=I,0===st&&i(Y)),n!==I?(a=y(),a!==I?(at=t,n=X(a),t=n):(nt=t,t=I)):(nt=t,t=I),st--,t===I&&(n=I,0===st&&i(J)),t}function m(){var t,n,a,r;return st++,t=nt,e.substr(nt,5)===te?(n=te,nt+=5):(n=I,0===st&&i(ne)),n!==I?(62===e.charCodeAt(nt)?(a=ae,nt++):(a=I,0===st&&i(re)),a===I&&(60===e.charCodeAt(nt)?(a=oe,nt++):(a=I,0===st&&i(ie)),a===I&&(e.substr(nt,2)===se?(a=se,nt+=2):(a=I,0===st&&i(le)),a===I&&(e.substr(nt,2)===ce?(a=ce,nt+=2):(a=I,0===st&&i(de))))),a===I&&(a=null),a!==I?(r=v(),r!==I?(at=t,n=pe(a,r),t=n):(nt=t,t=I)):(nt=t,t=I)):(nt=t,t=I),st--,t===I&&(n=I,0===st&&i(ee)),t}function h(){var t,n,a;return st++,t=nt,e.substr(nt,4)===fe?(n=fe,nt+=4):(n=I,0===st&&i(me)),n!==I?(a=v(),a!==I?(at=t,n=he(a),t=n):(nt=t,t=I)):(nt=t,t=I),st--,t===I&&(n=I,0===st&&i(ue)),t}function g(){var t,n,a,r,o;return st++,t=nt,e.substr(nt,6)===ve?(n=ve,nt+=6):(n=I,0===st&&i(ye)),n!==I?(a=y(),a!==I?(58===e.charCodeAt(nt)?(r=be,nt++):(r=I,0===st&&i(ke)),r!==I?(o=v(),o!==I?(at=t,n=xe(a,o),t=n):(nt=t,t=I)):(nt=t,t=I)):(nt=t,t=I)):(nt=t,t=I),st--,t===I&&(n=I,0===st&&i(ge)),t}function v(){var e;return st++,e=y(),e===I&&(e=b()),st--,e===I&&0===st&&i(Ce),e}function y(){var t,n,a;if(st++,t=nt,n=[],we.test(e.charAt(nt))?(a=e.charAt(nt),nt++):(a=I,0===st&&i(Te)),a!==I)for(;a!==I;)n.push(a),we.test(e.charAt(nt))?(a=e.charAt(nt),nt++):(a=I,0===st&&i(Te));else n=I;return n!==I&&(at=t,n=Ee()),t=n,st--,t===I&&(n=I,0===st&&i(De)),t}function b(){var t,n,a,r,o;return st++,t=nt,47===e.charCodeAt(nt)?(n=Ne,nt++):(n=I,0===st&&i(Se)),n!==I?(a=nt,r=k(),a=r!==I?e.substring(a,nt):r,a!==I?(47===e.charCodeAt(nt)?(r=Ne,nt++):(r=I,0===st&&i(Se)),r!==I?(103===e.charCodeAt(nt)?(o=Ae,nt++):(o=I,0===st&&i(Pe)),o===I&&(109===e.charCodeAt(nt)?(o=Ie,nt++):(o=I,0===st&&i($e)),o===I&&(105===e.charCodeAt(nt)?(o=Be,nt++):(o=I,0===st&&i(Le)),o===I&&(o=Oe))),o!==I?(at=t,n=Ue(a,o),t=n):(nt=t,t=I)):(nt=t,t=I)):(nt=t,t=I)):(nt=t,t=I),st--,t===I&&(n=I,0===st&&i(Me)),t}function k(){var e,t,n,a;if(e=nt,t=x(),t!==I){for(n=[],a=C();a!==I;)n.push(a),a=C();n!==I?(t=[t,n],e=t):(nt=e,e=I)}else nt=e,e=I;return e}function x(){var t,n,a;return t=nt,n=nt,st++,Ve.test(e.charAt(nt))?(a=e.charAt(nt),nt++):(a=I,0===st&&i(He)),st--,a===I?n=void 0:(nt=n,n=I),n!==I?(a=w(),a!==I?(n=[n,a],t=n):(nt=t,t=I)):(nt=t,t=I),t===I&&(t=D(),t===I&&(t=T())),t}function C(){var t,n,a;return t=nt,n=nt,st++,Re.test(e.charAt(nt))?(a=e.charAt(nt),nt++):(a=I,0===st&&i(Fe)),st--,a===I?n=void 0:(nt=n,n=I),n!==I?(a=w(),a!==I?(n=[n,a],t=n):(nt=t,t=I)):(nt=t,t=I),t===I&&(t=D(),t===I&&(t=T())),t}function D(){var t,n,a;return t=nt,92===e.charCodeAt(nt)?(n=We,nt++):(n=I,0===st&&i(Ge)),n!==I?(a=w(),a!==I?(n=[n,a],t=n):(nt=t,t=I)):(nt=t,t=I),t}function w(){var e,t,n;return e=nt,t=nt,st++,n=M(),st--,n===I?t=void 0:(nt=t,t=I),t!==I?(n=N(),n!==I?(t=[t,n],e=t):(nt=e,e=I)):(nt=e,e=I),e}function T(){var t,n,a,r;if(t=nt,91===e.charCodeAt(nt)?(n=_e,nt++):(n=I,0===st&&i(je)),n!==I){for(a=[],r=E();r!==I;)a.push(r),r=E();a!==I?(93===e.charCodeAt(nt)?(r=Ke,nt++):(r=I,0===st&&i(ze)),r!==I?(n=[n,a,r],t=n):(nt=t,t=I)):(nt=t,t=I)}else nt=t,t=I;return t}function E(){var t,n,a;return t=nt,n=nt,st++,qe.test(e.charAt(nt))?(a=e.charAt(nt),nt++):(a=I,0===st&&i(Qe)),st--,a===I?n=void 0:(nt=n,n=I),n!==I?(a=w(),a!==I?(n=[n,a],t=n):(nt=t,t=I)):(nt=t,t=I),t===I&&(t=D()),t}function M(){var t;return Je.test(e.charAt(nt))?(t=e.charAt(nt),nt++):(t=I,0===st&&i(Ze)),t}function N(){var t;return e.length>nt?(t=e.charAt(nt),nt++):(t=I,0===st&&i(Ye)),t}function S(){var t,n;for(st++,t=[],et.test(e.charAt(nt))?(n=e.charAt(nt),nt++):(n=I,0===st&&i(tt));n!==I;)t.push(n),et.test(e.charAt(nt))?(n=e.charAt(nt),nt++):(n=I,0===st&&i(tt));return st--,t===I&&(n=I,0===st&&i(Xe)),t}var A,P=arguments.length>1?arguments[1]:{},I={},$={Query:l},B=l,L="|",O={type:"literal",value:"|",description:'"|"'},U=function(e,t){return t.length>0?{type:"or",content:[e].concat(t.map(function(e,n){return t[n][3]}))}:e},V="&",H={type:"literal",value:"&",description:'"&"'},R=function(e,t){return t.length>0?{type:"and",content:[e].concat(t.map(function(e,n){return t[n][3]}))}:e},F="(",W={type:"literal",value:"(",description:'"("'},G=")",_={type:"literal",value:")",description:'")"'},j=function(e){return e},K={type:"other",description:"name:"},z="name:",q={type:"literal",value:"name:",description:'"name:"'},Q=function(e){return{type:"name",content:e}},J={type:"other",description:"is:"},Z="is:",Y={type:"literal",value:"is:",description:'"is:"'},X=function(e){return{type:"is",content:e}},ee={type:"other",description:"vers:"},te="vers:",ne={type:"literal",value:"vers:",description:'"vers:"'},ae=">",re={type:"literal",value:">",description:'">"'},oe="<",ie={type:"literal",value:"<",description:'"<"'},se=">=",le={type:"literal",value:">=",description:'">="'},ce="<=",de={type:"literal",value:"<=",description:'"<="'},pe=function(e,t){var n={type:"vers",content:t};return">"===e&&(n.operator="gt"),"<"===e&&(n.operator="lt"),">="===e&&(n.operator="ge"),"<="===e&&(n.operator="le"),n},ue={type:"other",description:"tag:"},fe="tag:",me={type:"literal",value:"tag:",description:'"tag:"'},he=function(e){return{type:"tag",content:e}},ge={type:"other",description:"bound:"},ve="bound:",ye={type:"literal",value:"bound:",description:'"bound:"'},be=":",ke={type:"literal",value:":",description:'":"'},xe=function(e,t){return{type:"bound",target:e,content:t}},Ce={type:"other",description:"identifier or regex"},De={type:"other",description:"identifier"},we=/^[a-zA-Z0-9.]/,Te={type:"class",value:"[a-zA-Z0-9\\.]",description:"[a-zA-Z0-9\\.]"},Ee=function(){return n()},Me={type:"other",description:"regular expression"},Ne="/",Se={type:"literal",value:"/",description:'"/"'},Ae="g",Pe={type:"literal",value:"g",description:'"g"'},Ie="m",$e={type:"literal",value:"m",description:'"m"'},Be="i",Le={type:"literal",value:"i",description:'"i"'},Oe="",Ue=function(e,t){var n;try{n=new RegExp(e,t)}catch(e){a(e.message)}return{type:"regex",content:n}},Ve=/^[*\\\/[]/,He={type:"class",value:"[*\\\\/[]",description:"[*\\\\/[]"},Re=/^[\\\/[]/,Fe={type:"class",value:"[\\\\/[]",description:"[\\\\/[]"},We="\\",Ge={type:"literal",value:"\\",description:'"\\\\"'},_e="[",je={type:"literal",value:"[",description:'"["'},Ke="]",ze={type:"literal",value:"]",description:'"]"'},qe=/^[\]\\]/,Qe={type:"class",value:"[\\]\\\\]",description:"[\\]\\\\]"},Je=/^[\n\r\u2028\u2029]/,Ze={type:"class",value:"[\\n\\r\\u2028\\u2029]",description:"[\\n\\r\\u2028\\u2029]"},Ye={type:"any",description:"any character"},Xe={type:"other",description:"whitespace"},et=/^[ \t]/,tt={type:"class",value:"[ \\t]",description:"[ \\t]"},nt=0,at=0,rt=[{line:1,column:1,seenCR:!1}],ot=0,it=[],st=0;if("startRule"in P){if(!(P.startRule in $))throw new Error("Can't start parsing from rule \""+P.startRule+'".');B=$[P.startRule]}if(A=B(),A!==I&&nt===e.length)return A;throw A!==I&&nt<e.length&&i({type:"end",description:"end of input"}),s(null,it,ot<e.length?e.charAt(ot):null,ot<e.length?o(ot,ot+1):o(ot,ot))}return e(t,Error),{SyntaxError:t,parse:n}}),angular.module("editorApp").filter("doFilter",function(){function e(e,t){return t.type&&"regex"===t.type?t.content.test(e):e===t}function t(t,n){var a=e(t.name,n.content);return!a&&t.children?t.children.some(function(t){return e(t.name,n.content)}):a}function n(e,n){return e.filter(function(e){return t(e,n)})}function a(e,t){var n;switch(t.content){case"node":n="node"===e.type;break;case"chan":case"channel":n="channel"===e.type;break;case"comp":case"component":n="component"===e.type;break;case"group":case"grp":n="group"===e.type;break;case"selected":n=e.selected;break;case"folded":n=e.folded;break;default:n=!1}return!n&&e.children?e.children.some(function(e){return a(e,t)}):n}function r(e,t){return e.filter(function(e){return a(e,t)})}function o(t,n){
var a=t.tags.some(function(t){return e(t,n.content)});return!a&&t.children?t.children.some(function(e){return o(e,n)}):a}function i(e,t){return e.filter(function(e){return o(e,t)})}function s(t,n){var a=e(t.version,n.content);return!a&&t.children?t.children.some(function(e){return s(e,n)}):a}function l(e,t){return e.filter(function(e){return s(e,t)})}function c(e,t){var n=e;return t.content.forEach(function(e){n=p(n,e)}),n}function d(e,t){var n=[],a=[];return t.content.forEach(function(t){var r=e.filter(function(e){return n.indexOf(e.path)===-1}),o=p(r,t);o.forEach(function(e){n.indexOf(e.path)===-1&&n.push(e.path)}),a=a.concat(o)}),a}var p=function(){};return p=function(e,t){if(e){if(!t)return e;switch(t.type){case"name":return n(e,t);case"is":return r(e,t);case"tag":return i(e,t);case"vers":return l(e,t);case"and":return c(e,t);case"or":return d(e,t);default:return e}}}}),angular.module("editorApp").config(["$stateProvider",function(e){e.state("settings",{parent:"app",url:"/settings",views:{"content@":{templateUrl:"app/settings/settings.html",controller:"SettingsCtrl"}}})}]),angular.module("editorApp").controller("SettingsCtrl",["$scope","kScript","kRegistry","storage","Notification",function(e,t,n,a,r){e.registryUrl=n.getUrl(),e.getUrl=function(){return n.getUrl()},e.changeKevoreeRegistry=function(){if(e.registryUrl!==n.getUrl().toString())try{var t=new URL(e.registryUrl);n.setUrl(t),r.success({title:"Kevoree Registry",message:"URL successfully updated",delay:3e3})}catch(t){r.error({title:"Kevoree Registry",message:"Invalid URL "+e.registryUrl,delay:3e3})}},e.canChangeKevoreeRegistry=function(){return void 0!==e.registryUrl&&null!==e.registryUrl&&e.registryUrl!==n.getUrl().toString()},e.clearKevScriptCache=function(){var e=TinyConf.get("cache.root");Object.keys(localStorage).forEach(function(t){t.startsWith(e)&&delete localStorage[t]})},e.canClearKevScriptCache=function(){var e=TinyConf.get("cache.root");return Object.keys(localStorage).find(function(t){return t.startsWith(e)})}}]),angular.module("editorApp").controller("NavBarCtrl",["$state",function(e){this.isCollapsed=!0,this.$state=e}]),angular.module("editorApp").controller("TypedefsCtrl",["$scope","kEditor","ui","kModelHelper","kFactory","kInstance","Notification","KWE_POSITION",function(e,t,n,a,r,o,i,s){function l(){e.packages=[];var n=t.getModel(),r={};n.select("**/typeDefinitions[*]").array.forEach(function(e){var t=a.genPkgName(e.eContainer());r[t]=r[t]||{},r[t].tdefs=r[t].tdefs||{};var n=e.findMetaDataByID("description"),o=n?n.value:null;o&&o.length>=200&&(o=o.substr(0,200)+"..."),r[t].tdefs[e.name]={name:e.name,type:a.getTypeDefinitionType(e),pkgPath:e.eContainer().path(),deployUnits:e.deployUnits.array,description:o}}),Object.keys(r).forEach(function(t){var n={name:t,collapsed:!1,tdefs:[]};Object.keys(r[t].tdefs).forEach(function(e){n.tdefs.push(r[t].tdefs[e])}),e.packages.push(n)})}e.packages={},e.dragDraggable={animate:!0,placeholder:"keep",onStart:"onStart",onDrag:"onDrag",onStop:"onStop"},e.dragOptions={revert:"invalid",helper:"clone",addClasses:!1,scroll:!1,appendTo:"#tdef-drag-panel",containment:"#tdef-drag-panel",cursor:"move",cursorAt:{top:-5,right:-5}},e.hasPackages=function(){return Object.keys(e.packages).length>0},e.onStart=function(e,r){if(n.setDropTarget(null),r.helper.hasClass("tdef-item-component")||r.helper.hasClass("tdef-item-node")){var o=document.getElementById("editor-container");this.offset={left:o.offsetLeft,top:o.offsetTop};var i=r.helper[0].dataset.pkgPath,s=r.helper[0].innerHTML.trim(),l=t.getModel().select(i+"/typeDefinitions[name="+s+"]");this.typeDef=a.findBestVersion(l.array)}},e.onDrag=function(e,r){n.mousePos={x:e.clientX,y:e.clientY},(r.helper.hasClass("tdef-item-component")||r.helper.hasClass("tdef-item-node"))&&(clearTimeout(this.timeout),this.hoveredNode&&this.hoveredNode.select(".bg").removeClass("hovered error"),this.timeout=setTimeout(function(){if(this.hoveredNode=n.getHoveredNode(n.mousePos.x-this.offset.left,n.mousePos.y-this.offset.top),this.hoveredNode){var e=this.hoveredNode.select(".bg");e.addClass("hovered"),a.isCompatible(this.typeDef,t.getModel().findByPath(this.hoveredNode.attr("data-path")))?n.setDropTarget(this.hoveredNode):(e.addClass("error"),n.setDropTarget(null))}else n.setDropTarget(null)}.bind(this),100))},e.onStop=function(e,t){(t.helper.hasClass("tdef-item-component")||t.helper.hasClass("tdef-item-node"))&&(clearTimeout(this.timeout),this.hoveredNode?(this.hoveredNode.select(".bg").hasClass("error")&&i.warning({title:"Add component",message:"Targeted node platform cannot run this TypeDefinition",delay:5e3}),this.hoveredNode.select(".bg").removeClass("hovered error")):t.helper.hasClass("tdef-item-component")&&i.warning({title:"Add component",message:"You have to drop components in nodes",delay:5e3}),delete this.typeDef,delete this.timeout,delete this.offset,delete this.hoveredNode)},e.addInstance=function(e){function l(t){t.typeDefinition=e,t.started=!0;var n=r.createValue();n.name=s,n.value=JSON.stringify({x:100,y:100}),t.addMetaData(n),o.initDictionaries(t)}var c=t.getModel().select(e.pkgPath+"/typeDefinitions[name="+e.name+"]");e=a.findBestVersion(c.array);var d,p=a.getTypeDefinitionType(e),u=t.getModel(),f=n.getSelectedNodes();switch(p){case"node":f.length>0?f.forEach(function(e){var t=u.findByPath(e.attr("data-path"));t&&(d=r.createContainerNode(),d.name="node"+parseInt(1e3*Math.random()),l(d),u.addNodes(d),t.addHosts(d))}):(d=r.createContainerNode(),d.name="node"+parseInt(1e3*Math.random()),l(d),u.addNodes(d));break;case"group":d=r.createGroup(),d.name="group"+parseInt(1e3*Math.random()),l(d),u.addGroups(d);break;case"component":f.length>0?f.forEach(function(e){var t=u.findByPath(e.attr("data-path"));t&&(d=r.createComponentInstance(),d.name="comp"+parseInt(1e3*Math.random()),l(d),t.addComponents(d))}):i.warning({title:"Add component",message:"You have to select at least one node",delay:5e3});break;case"channel":d=r.createChannel(),d.name="chan"+parseInt(1e3*Math.random()),l(d),u.addHubs(d)}};var c=t.addModelUpdateListener("tdefs",l,!0),d=t.addNewModelListener("tdefs",l);l(),e.$on("$destroy",function(){c(),d()})}]),angular.module("editorApp").config(["$stateProvider",function(e){e.state("main",{parent:"app",url:"/",views:{"content@":{templateUrl:"app/main/main.html",controller:"MainCtrl"},"typedefs@main":{templateUrl:"app/main/typedefs/typedefs.html",controller:"TypedefsCtrl"},"editor@main":{templateUrl:"app/main/editor/editor.html",controller:"EditorCtrl"},"instance@main":{templateUrl:"app/main/instance/instance.html",controller:"InstanceCtrl",controllerAs:"vm"}},onExit:["ui",function(e){e.editor=null}]})}]),angular.module("editorApp").controller("MainCtrl",["$scope","$timeout","$stateParams","$uibModal","kEditor","hotkeys","saveFile","ui","kModelHelper","kFactory","kWs","Notification",function(e,t,n,a,r,o,i,s,l,c,d,p){function u(){r.drawModel()}var f=r.addNewModelListener("main",u);e.synced=!1;var m;e.onFileLoaded=function(){},e.open=function(t){t.preventDefault(),e.onFileLoaded=function(e,t){var n,a=r.getModel(),o=c.createJSONLoader();try{n=o.loadModelFromString(t).get(0)}catch(t){return console.warn("[main.controller.open()] Error loading model file"),console.error(t.stack),p.error({title:"Open from file",message:"Unable to load a model from <strong>"+e+"</strong>",delay:15e3}),void r.setModel(a)}r.setModel(n,function(t){t?p.error({title:"Open from file",message:"Unable to open model <strong>"+e+"</strong><br/>"+t.message,delay:15e3}):p.success({title:"Open from file",message:"Model loaded from <strong>"+e+"</strong>"})})},jQuery("input#file").click()},e.merge=function(t){t.preventDefault(),e.onFileLoaded=function(e,t){var n,a=c.createJSONLoader(),o=c.createModelCompare(),i=c.createModelCloner();try{n=a.loadModelFromString(t).get(0);var s=i.clone(r.getModel());o.merge(s,n).applyOn(s)}catch(t){return console.warn("[main.controller.merge()] Error loading model file"),console.error(t.stack),void p.error({title:"Merge from file",message:"Unable to merge the model with <strong>"+e+"</strong>",delay:15e3})}r.setModel(s,function(t){t?p.error({title:"Merge from file",message:"Unable to merge model <strong>"+e+"</strong><br/>"+t.message,delay:15e3}):p.success({title:"Merge from file",message:"Model merged with <strong>"+e+"</strong>"})})},jQuery("input#file").click()},e.openFromNode=function(e){e.preventDefault(),a.open({templateUrl:"app/components/util/host-port-path.modal.html",size:"md",controller:["$scope","$uibModalInstance","storage",function(e,n,a){e.title="Open from node",e.action="Open",e.host=a.get("previous-host","127.0.0.1"),e.port=9e3,e.path="/",e.onHostChange=function(e){a.set("previous-host",e)},n.rendered.then(function(){t(function(){jQuery("#host").focus()},250)}),e.confirm=function(a){(!a||a&&13===a.keyCode)&&(e.closeError(),d.getModel(e.host,e.port,e.path,function(a,o,i){a?t(function(){e.error=a.message}):(n.close(),r.setModel(o,function(t){t?p.error({title:e.title,message:"Unable to load model from <strong>"+i+"</strong><br/>"+t.message,delay:15e3}):p.success({title:e.title,message:"Model loaded from <strong>"+i+"</strong>"})}))}))},e.closeError=function(){e.error=null}}]})},e.mergeFromNode=function(e){e.preventDefault(),a.open({templateUrl:"app/components/util/host-port-path.modal.html",size:"md",controller:["$scope","$uibModalInstance","kWs","storage",function(e,n,a,o){e.title="Merge from node",e.action="Merge",e.host=o.get("previous-host","127.0.0.1"),e.port=9e3,e.path="/",e.onHostChange=function(e){o.set("previous-host",e)},n.rendered.then(function(){t(function(){jQuery("#host").focus()},250)}),e.confirm=function(o){(!o||o&&13===o.keyCode)&&(e.closeError(),a.getModel(e.host,e.port,e.path,function(a,o,i){if(a)t(function(){e.error=a.message});else{n.close();var s=c.createModelCompare(),l=c.createModelCloner(),d=l.clone(r.getModel());s.merge(d,o).applyOn(d),r.setModel(d,function(t){t?p.error({title:e.title,message:"Unable to merge model from <strong>"+i+"</strong><br/>"+t.message,delay:15e3}):p.success({title:e.title,message:"Model merged with <strong>"+i+"</strong>"})})}}))},e.closeError=function(){e.error=null}}]})},e.disconnectSync=function(){m&&(m.close(),t(function(){e.synced=!1}))},e.connectSync=function(n){if(n.preventDefault(),e.synced)p.warning({title:"Connect sync",message:"You are already synced"});else{var o=e;a.open({templateUrl:"app/components/util/host-port-path.modal.html",size:"md",controller:["$scope","$uibModalInstance","storage",function(e,n,a){e.title="Connect sync",e.action="Sync",e.host=a.get("previous-host","127.0.0.1"),e.port=9e3,e.path="/",e.onHostChange=function(e){a.set("previous-host",e)},n.rendered.then(function(){t(function(){jQuery("#host").focus()},250)}),e.confirm=function(a){(!a||a&&13===a.keyCode)&&(e.closeError(),e.path?1===e.path.length&&"/"===e.path?e.path="":"/"!==e.path.substr(0,1)&&(e.path="/"+e.path):e.path="",m=new WebSocket("ws://"+e.host+":"+e.port+e.path),m.addEventListener("open",function(){t(function(){o.url=e.host+(80===e.port?"":":"+e.port)+e.path,o.synced=!0}),n.close(),p.success({title:e.title,message:"Connected to <strong>ws://"+e.host+":"+e.port+e.path+"</strong>"})}),m.addEventListener("message",function(t){var n=t.data;"push/"===n.substr(0,"push/".length)&&(n=n.substr("push/".length));var a=c.createJSONLoader();try{var o=a.loadModelFromString(n).get(0);r.setModel(o,function(t){t?p.error({title:e.title,message:"Unable to update synced model from <strong>ws://"+e.host+":"+e.port+e.path+"</strong><br/>"+t.message,delay:15e3}):p.success({title:e.title,message:"Model updated from sync with <strong>ws://"+e.host+":"+e.port+e.path+"</strong>"})})}catch(t){p.error({title:e.title,message:"Error: unable to load received message as a Kevoree JSON model",delay:15e3})}}),m.addEventListener("error",function(){p.error({title:e.title,message:"Error: unable to sync with <strong>ws://"+e.host+":"+e.port+e.path+"</strong>",delay:15e3})}),m.addEventListener("close",function(){t(function(){o.synced=!1}),p.warning({title:e.title,message:"Connection with <strong>ws://"+e.host+":"+e.port+e.path+"</strong> closed"})}))},e.closeError=function(){e.error=null}}]})}},e.save=function(e,t){e.preventDefault();var n=c.createJSONSerializer();try{var a=n.serialize(r.getModel());a=JSON.stringify(JSON.parse(a),null,4),i.save(a,t,".json","application/json")}catch(e){p.error({title:"Save",message:"Unable to serialize model to JSON"})}};var h=[];e.copy=function(){h=s.getSelectedPaths().filter(function(e){return"string"==typeof e})},e.paste=function(){h.forEach(function(e){var t=r.getModel(),n=t.findByPath(e);if(n){var a=l.clone(n);switch(l.getTypeDefinitionType(n.typeDefinition)){case"node":t.addNodes(a),n.host&&n.host.addHosts(a);break;case"group":t.addGroups(a);break;case"channel":t.addHubs(a);break;case"component":n.eContainer().addComponents(a)}}}),h.length>0&&r.drawModel()},e.fixOverlapping=function(e){e.preventDefault(),r.fixOverlapping()},e.deleteAll=function(t){t.preventDefault(),e.deleteInstances(t),r.getModel().removeAllPackages()},e.deleteInstances=function(e){e.preventDefault();var t=r.getModel();t.removeAllNodes(),t.removeAllGroups(),t.removeAllHubs(),t.removeAllMBindings(),t.removeAllRepositories()},e.deleteSelection=function(e){e.preventDefault();var t=s.deleteSelected();0===t&&p.warning({title:"Delete selected",message:"Nothing selected"})},e.toggleShortcutHelp=function(){o.toggleCheatSheet()},o.bindTo(e).add({combo:"ctrl+o",description:"Open a model from a file",callback:e.open}),o.bindTo(e).add({combo:"ctrl+m",description:"Merge a model from a file with current model in editor",callback:e.merge}),o.bindTo(e).add({combo:"ctrl+shift+o",description:"Open a model from a node",callback:e.openFromNode}),o.bindTo(e).add({combo:"ctrl+shift+m",description:"Merge a model from a node with current model in editor",callback:e.mergeFromNode}),o.bindTo(e).add({combo:"ctrl+shift+g",description:"Connect to a Web Socket server and stay synced with it",callback:e.connectSync}),o.bindTo(e).add({combo:"ctrl+s",description:"Save the current model into a JSON file",callback:function(n){n.preventDefault();var r=e.save;a.open({templateUrl:"app/components/util/filename.modal.html",size:"sm",controller:["$scope","$uibModalInstance",function(e,a){e.title="Save model",e.body="Would you like to save your current model to a file?",e.filename="model"+(Math.floor(900*Math.random())+100),a.rendered.then(function(){t(function(){jQuery("#filename").focus()},250)}),e.save=function(){function t(e,t){return e.indexOf(t,e.length-t.length)!==-1}var o=".json";t(e.filename,o)&&(e.filename=e.filename.substr(0,e.filename.length-o.length)),r(n,e.filename),a.close()}}]})}}),o.bindTo(e).add({combo:"alt+o",description:"Fix overlapping",callback:e.fixOverlapping}),o.bindTo(e).add({combo:"alt+shift+d",description:"Delete everything in the current model",callback:e.deleteAll}),o.bindTo(e).add({combo:"alt+shift+i",description:"Delete instances in the current model",callback:e.deleteInstances}),o.bindTo(e).add({combo:"del",description:"Delete selected instances in the current model",callback:e.deleteSelection}),o.bindTo(e).add({combo:"ctrl+a",description:"Select all instances",callback:function(e){e.preventDefault(),s.selectAll()}}),o.bindTo(e).add({combo:"ctrl+c",description:"Copy the selected instance(s)",callback:e.copy}),o.bindTo(e).add({combo:"ctrl+v",description:"Paste the selected instance(s)",callback:e.paste}),e.$on("$destroy",function(){f()})}]),angular.module("editorApp").controller("InstanceNetworkModalCtrl",["$scope","$uibModalInstance","$timeout","node","net","kFactory",function(e,t,n,a,r,o){e.node=a,e.net=r,e.newVal={name:null,value:null},e.addNewVal=function(){if(e.newVal.name&&e.newVal.value){var t=o.createValue();t.name=e.newVal.name,t.value=e.newVal.value,e.net.addValues(t),e.newVal.name=null,e.newVal.value=null,jQuery("input#newValName").focus()}},e.add=function(){a.addNetworkInformation(e.net),t.close()},e.delete=function(){e.net.delete(),t.close()},e.canSave=function(){return r.values.array.length>0}}]),angular.module("editorApp").controller("InstanceCtrl",["$scope","$timeout","$uibModal","hotkeys","ui","kEditor","kFactory","kInstance","kModelHelper",function(e,t,n,a,r,o,i,s,l){function c(){f.versions=f.instance.typeDefinition.eContainer().select("typeDefinitions[name="+f.instance.typeDefinition.name+"]").array.map(function(e){return e.version}),f.instance.selectedVersion=f.instance.typeDefinition.version,f.dus=f.instance.typeDefinition.deployUnits.array;var e=f.instance.typeDefinition.findMetaDataByID("description");e?f.description=e.value:f.description="<em>- none -</em>",f.instance.typeDefinition.dictionaryType?(f.dicAttrs=f.instance.typeDefinition.dictionaryType.select("attributes[fragmentDependant=false]").array,f.fragDicAttrs=f.instance.typeDefinition.dictionaryType.select("attributes[fragmentDependant=true]").array):(f.dicAttrs=[],f.fragDicAttrs=[]),s.initDictionaries(f.instance)}function d(e,t,n){t&&e.values.array.forEach(function(e){var a=t.select("attributes[name="+e.name+"]").array[0];a?f.isTruish(a.fragmentDependant)?n||e.delete():n&&e.delete():e.delete()})}function p(){t(function(){f.instance=null,f.type=null,f.versions=[],f.dus=null,f.description="<em>- none -</em>",f.dicAttrs=[],f.fragDicAttrs=[],f.processing=!0;var e=l.getSelection(o.getModel());1===e.length&&(f.instance=e[0],f.instance&&(f.instance.selectedVersion=f.instance.typeDefinition.version,jQuery(".ui-notification").css("right","260px"),f.instance.preName=f.instance.name,f.type=l.getTypeDefinitionType(f.instance.typeDefinition),c(),f.processing=!1))})}var u,f=this;f.instance=null,f.type=null,f.mainCollapsed=!1,f.dicCollapsed=!1,f.netCollapsed=!1,f.descCollapsed=!1,f.fragCollapsed={},f.changeName=function(e,t){e.name.$valid&&(f.instance.name=t)},f.changeVersion=function(e){e&&(f.instance.typeDefinition=f.instance.typeDefinition.eContainer().select("**/typeDefinitions[name="+f.instance.typeDefinition.name+",version="+e+"]").array[0],d(f.instance.dictionary,f.instance.typeDefinition.dictionaryType,!1),f.instance.fragmentDictionary.array.forEach(function(e){d(e,f.instance.typeDefinition.dictionaryType,!0)}),c())},f.hasFragmentDictionary=function(){return!(!f.instance||!f.instance.fragmentDictionary)&&f.instance.fragmentDictionary.size()>0},f.hasNetworkInformation=function(){return f.instance&&"undefined"!=typeof f.instance.networkInformation},f.manageNetwork=function(e,t){e.stopPropagation(),n.open({templateUrl:"app/main/instance/network.modal.html",size:"md",resolve:{node:function(){return f.instance},net:function(){return t}},controller:"InstanceNetworkModalCtrl"})},f.addNetwork=function(){var e=i.createNetworkInfo();e.name="net"+f.instance.networkInformation.size(),n.open({templateUrl:"app/main/instance/network.modal.html",size:"md",resolve:{node:function(){return f.instance},net:function(){return e}},controller:"InstanceNetworkModalCtrl"})},f.openGroupModal=function(){n.open({templateUrl:"app/main/instance/group.modal.html",size:"md",resolve:{group:function(){return f.instance}},controller:"GroupModalCtrl"})},f.isTruish=l.isTruish,f.isReadOnly=function(){if(f.instance){var e=f.instance.findMetaDataByID("access_mode");return e&&"read-only"===e.value}return!1},f.isVirtual=function(){return l.isVirtual(f.instance)},p();var m=o.addModelUpdateListener("selected",p,!0),h=o.addNewModelListener("selected",p);e.$on("$destroy",function(){m(),h(),t.cancel(u)})}]),angular.module("editorApp").factory("groupModalHolder",function(){return{host:"127.0.0.1",port:"9000",path:"/"}}).controller("GroupModalCtrl",["$scope","$uibModalInstance","$timeout","group","kEditor","kWs","groupModalHolder",function(e,t,n,a,r,o,i){if(e.type="push to",e.action="push",e.group=a,e.selectedHost=i.host,e.selectedPort=i.port,e.selectedPath=i.path,e.processing=!1,e.modelHasErrors=r.modelHasErrors(),e.hosts={"127.0.0.1":"default"},e.ports={9000:"default"},e.paths={"/":"default"},e.changeHost=function(){i.host=e.selectedHost},e.changePort=function(){i.port=e.selectedPort},e.changePath=function(){i.path=e.selectedPath},a.dictionary){var s=a.dictionary.findValuesByID("host");s&&!e.hosts[s.value]&&(e.hosts[s.value]=a.name);var l=a.dictionary.findValuesByID("port");l&&!e.ports[l.value]&&(e.ports[l.value]=a.name);var c=a.dictionary.findValuesByID("path");c&&!e.paths[c.value]&&(e.paths[c.value]=a.name)}a.subNodes.array.forEach(function(t){var n=a.findFragmentDictionaryByID(t.name);if(n){var r=n.findValuesByID("port"),o=n.findValuesByID("path");r&&!e.ports[r.value]&&(e.ports[r.value]=t.name),o&&!e.paths[o.value]&&(e.paths[o.value]=t.name)}t.networkInformation.array.forEach(function(n){n.values.array.forEach(function(n){e.hosts[n.value]||(e.hosts[n.value]=t.name)})})}),e.closeError=function(){e.error=null},e.closeModelHasErrorsWarning=function(){e.modelHasErrors=null},e.closeSuccess=function(){e.success=null};var d;e.push=function(){e.action="pushed to",e.error=null,e.processing=!0,n(function(){d=o.pushModel(r.getModel(),e.selectedHost,e.selectedPort,e.selectedPath,function(t){n(function(){t?(e.processing=!1,e.error=t.message):(e.processing=!1,e.success=!0)})})})},e.pull=function(){e.action="pulled from",e.error=null,e.processing=!0,d=o.getModel(e.selectedHost,e.selectedPort,e.selectedPath,function(t,a){n(function(){t?(e.processing=!1,e.error=t.message):(e.processing=!1,e.success=!0,r.setModel(a))})})},e.close=function(){d&&d.close(),t.close()}}]),angular.module("editorApp").controller("SelectChanModalCtrl",["$scope","$uibModalInstance","startPort","endPort","orderByFilter","kInstance","kEditor","kFactory","kModelHelper","KWE_POSITION",function(e,t,n,a,r,o,i,s,l,c){var d;e.instances=r(i.getModel().hubs.array.filter(function(e){return e.selected=!1,!l.isAlreadyBound(a,e)&&!l.isAlreadyBound(n,e)&&l.isCompatible(e.typeDefinition,n.eContainer().eContainer())&&l.isCompatible(e.typeDefinition,a.eContainer().eContainer())}),"typeDefinition.name"),e.types=r(l.getChannelTypes(i.getModel()).filter(function(e){return e.selected=!1,l.isCompatible(e,n.eContainer().eContainer())&&l.isCompatible(e,a.eContainer().eContainer())}),"name"),e.types.length>0&&(e.types[0].selected=!0,d=e.types[0]),e.isValid=function(){for(var t=0;t<e.instances.length;t++)if(e.instances[t].selected)return!0;for(t=0;t<e.types.length;t++)if(e.types[t].selected)return!0;return!1},e.select=function(t){t.selected||(e.instances.forEach(function(e){t.path()!==e.path()&&e.selected&&(e.selected=!1)}),e.types.forEach(function(e){t.path()!==e.path()&&e.selected&&(e.selected=!1)}),t.selected=!t.selected,d=t)},e.confirm=function(){var e;if("typeDefinitions"===d.getRefInParent()){e=s.createChannel(),e.name="chan"+parseInt(1e3*Math.random()),e.typeDefinition=d,e.started=!0;var n=s.createValue();n.name=c,n.value=JSON.stringify({x:100,y:100}),e.addMetaData(n),o.initDictionaries(e),i.getModel().addHubs(e)}else e=d;t.close(e)}}]),angular.module("editorApp").controller("EditorCtrl",["$scope","kEditor","ui","uiUtils","kModelHelper","kFactory","kInstance","hotkeys","Notification","KWE_POSITION","KWE_FOLDED",function(e,t,n,a,r,o,i,s,l,c,d){function p(e,a){return function(){var r=n.getSelectedPaths();r&&r.forEach(function(n){if(n){var r=t.getModel().findByPath(n);if(r&&"function"==typeof r.findMetaDataByID){var o=r.findMetaDataByID(c);if(o){var i=JSON.parse(o.value);switch(e){case"up":i.y-=a;break;case"right":i.x+=a;break;case"down":i.y+=a;break;case"left":i.x-=a}o.value=JSON.stringify(i)}}}})}}n.init(),t.drawModel(),e.dropDroppable={onDrop:"onDrop"},e.dropOptions={accept:function(e){var a=!1,o=e[0].dataset.pkgPath,i=e[0].innerHTML.trim(),s=t.getModel().select(o+"/typeDefinitions[name="+i+"]"),l=r.findBestVersion(s.array),c=r.getTypeDefinitionType(l);return a="component"!==c||n.getDropTarget()}},e.onDrop=function(e,s){function d(e){e.typeDefinition=g,e.started=!0;var t=o.createValue();t.name=c;var r=a.getPointInEditor(n.mousePos.x,n.mousePos.y);t.value=JSON.stringify({x:r.x-y.e,y:r.y-y.f}),e.addMetaData(t),i.initDictionaries(e)}var p,u,f=angular.element(s.draggable).scope().tdef.pkgPath,m=angular.element(s.draggable).scope().tdef.name,h=t.getModel().select(f+"/typeDefinitions[name="+m+"]"),g=r.findBestVersion(h.array),v=r.getTypeDefinitionType(g),y=n.editor.transform().localMatrix,b=t.getModel(),k=n.getDropTarget();switch(v){case"node":p=o.createContainerNode(),p.name="node"+parseInt(1e3*Math.random()),d(p),b.addNodes(p),k&&(u=b.findByPath(k.attr("data-path")),u&&u.addHosts(p));break;case"group":p=o.createGroup(),p.name="group"+parseInt(1e3*Math.random()),d(p),i.initFragmentDictionaries(p),b.addGroups(p);break;case"component":p=o.createComponentInstance(),p.name="comp"+parseInt(1e3*Math.random()),d(p),k?(u=b.findByPath(k.attr("data-path")),u&&u.addComponents(p)):l.warning({title:"Add component",message:"You have to drop components in nodes",delay:5e3});break;case"channel":p=o.createChannel(),p.name="chan"+parseInt(1e3*Math.random()),d(p),i.initFragmentDictionaries(p),b.addHubs(p)}return n.setDropTarget(null),!0},s.bindTo(e).add({combo:"f",description:"Fold/Unfold selected node",callback:function(){var e=n.getSelectedPaths();e&&e.forEach(function(e){if(e){var n=t.getModel().findByPath(e);if("node"===r.getTypeDefinitionType(n.typeDefinition)){var a=n.findMetaDataByID(d);if(a){var i=r.isTruish(a.value);a.value=!i}else a=o.createValue(),a.name=d,a.value=!0,n.addMetaData(a)}}})}}),s.bindTo(e).add({combo:"up",description:"Move the selected instances 1 pixel up",callback:p("up",1)}),s.bindTo(e).add({combo:"ctrl+up",description:"Move the selected instances 15 pixel up",callback:p("up",15)}),s.bindTo(e).add({combo:"right",description:"Move the selected instances 1 pixel right",callback:p("right",1)}),s.bindTo(e).add({combo:"ctrl+right",description:"Move the selected instances 15 pixel right",callback:p("right",15)}),s.bindTo(e).add({combo:"down",description:"Move the selected instances 1 pixel down",callback:p("down",1)}),s.bindTo(e).add({combo:"ctrl+down",description:"Move the selected instances 15 pixel down",callback:p("down",15)}),s.bindTo(e).add({combo:"left",description:"Move the selected instances 1 pixel left",callback:p("left",1)}),s.bindTo(e).add({combo:"ctrl+left",description:"Move the selected instances 15 pixel left",callback:p("left",15)})}]),function(){function e(e,t){function n(e){e.versions&&e.versions.currentValue&&(o.selectedVersion=o.versions.find(function(e){return o.tdef.version===e.version}))}function a(){o.disabled||o.onVersionChanged({tdef:o.selectedVersion})}function r(e){o.disabled||o.onAddDusToModel({dus:e})}var o=this;o.versions=null,o.selectedVersion=null,o.baseUrl=t.getUrl(),o.$onChanges=n,o.changeVersion=a,o.addDusToModel=r}angular.module("editorApp").component("tdefDetail",{templateUrl:"app/libraries/tdef-detail.html",bindings:{tdef:"<",versions:"<",disabled:"<",onVersionChanged:"&",onAddDusToModel:"&"},controller:e}),e.$inject=["$q","kRegistry"]}(),angular.module("editorApp").config(["$stateProvider",function(e){e.state("libraries",{parent:"app",url:"/libs",views:{"content@":{templateUrl:"app/libraries/libraries.html",controller:"LibrariesCtrl",controllerAs:"vm"}}})}]),angular.module("editorApp").controller("LibrariesCtrl",["$q","$uibModal","kRegistry","kEditor","kFactory","Notification",function(e,t,n,a,r,o){function i(){g.tdefs=null,g.tdefDetail=null,g.tdefDetailVersions=null;var e=g.namespaces.find(function(e){return e.active});return e?s(e).then(function(){return l(g.tdefDetail)}).then(function(){return c(g.tdefDetail)}):null}function s(e){return n.tdef.getLatestsByNamespace(e.name).then(function(e){g.tdefs=e.map(function(e,t){return 0===t?(e.active=!0,g.tdefDetail=e):e.active=!1,e})})}function l(e){return e?n.tdef.getAllByNamespaceAndName(e.namespace,e.name).then(function(e){g.tdefDetailVersions=e}):null}function c(t){return t?e.all([n.du.getReleases(t.namespace,t.name,t.version),n.du.getLatests(t.namespace,t.name,t.version)]).then(function(e){g.tdefDetail.releases=u(e[0]),g.tdefDetail.latests=u(e[1])}):null}function d(e){g.disabled=!0,g.namespaces.forEach(function(t){t.name===e.name?t.active=!t.active:t.active=!1}),i().then(function(){g.disabled=!1})}function p(e){g.disabled=!0,g.tdefDetail=null,g.tdefDetailVersions=null,g.tdefs.forEach(function(t){t.name===e.name?t.active=!t.active:t.active=!1}),g.tdefDetail=g.tdefs.find(function(e){return e.active}),f(g.tdefDetail).then(function(){g.disabled=!1})}function u(e){return e.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),e.map(function(e){return e.active=!1,e})}function f(t){return t?(g.tdefDetail=t,l(t).then(function(){return c(t)})):e.resolve()}function m(e){var n=a.getModel(),i=n.select("/packages["+g.tdefDetail.namespace+"]/typeDefinitions[name="+g.tdefDetail.name+",version="+g.tdefDetail.version+"]").array[0];if(i)t.open({templateUrl:"app/libraries/dus.modal.html",size:"md",resolve:{tdef:function(){return g.tdefDetail},currentDus:function(){return i.deployUnits.array},dus:function(){return e}},controller:"DusModalController as vm"}).result.then(function(){i.deployUnits.array=[],h(i,e),o.success({title:"Add to model",message:"DeployUnits successfully added to <strong>"+i.eContainer().name+"."+i.name+"/"+i.version+"</strong>"})});else{var s=n.findPackagesByID(g.tdefDetail.namespace);s||(s=r.createPackage().withName(g.tdefDetail.namespace),n.addPackages(s)),s.addTypeDefinitions(g.tdefDetail.model),i=n.select("/packages["+g.tdefDetail.namespace+"]/typeDefinitions[name="+g.tdefDetail.name+",version="+g.tdefDetail.version+"]").array[0],h(i,e),o.success({title:"Add to model",message:"<strong>"+i.eContainer().name+"."+i.name+"/"+i.version+"</strong> successfully added to model"})}}function h(e,t){t.forEach(function(t){t.error||(e.eContainer().addDeployUnits(t.model),e.addDeployUnits(t.model))})}var g=this;g.namespaces=[],g.tdefs=[],g.selectNs=d,g.selectTdef=p,g.tdefDetail=null,g.changeTdefVersion=f,g.addDusToModel=m,n.namespace.all().then(function(e){g.namespaces=e.map(function(e){return"kevoree"===e.name?e.active=!0:e.active=!1,e})}).then(i)}]),function(){function e(){var e=this;angular.isDefined(e.props)||(e.props=[]),angular.isDefined(e.selectable)||(e.selectable=!0),e.select=function(t){e.disabled||e.onSelect({elem:t})}}angular.module("editorApp").component("klist",{templateUrl:"app/libraries/klist.html",bindings:{parent:"@",title:"@",placeholder:"@",props:"<",elems:"<",onSelect:"&",disabled:"<"},controller:e})}(),function(){function e(e,t,n){var a=this;a.tdef=e,a.dus=n,a.currentDus=t}angular.module("editorApp").controller("DusModalController",e),e.$inject=["tdef","currentDus","dus"]}(),function(){function e(){function e(){t.disabled||t.onAddToModel({dus:t.dus})}var t=this;t.addToModel=e}angular.module("editorApp").component("dusInstaller",{templateUrl:"app/libraries/dus-installer.html",bindings:{tag:"@",dus:"<",disabled:"<",onAddToModel:"&"},controller:e}),e.$inject=[]}(),angular.module("editorApp").config(["$stateProvider",function(e){e.state("kevscript",{parent:"app",url:"/kevscript",views:{"content@":{templateUrl:"app/kevscript/kevscript.html",controller:"KevScriptCtrl"}}})}]),angular.module("editorApp").controller("KevScriptCtrl",["$rootScope","$scope","$uibModal","$timeout","$state","hotkeys","kEditor","kScript","saveFile","storage","Notification",function(e,t,n,a,r,o,i,s,l,c,d){function p(e){e&&e.preventDefault&&e.preventDefault(),n.open({templateUrl:"app/components/util/filename.modal.html",size:"sm",scope:t,controller:["$scope","$uibModalInstance",function(e,t){e.title="Save Kevscript",e.body="Would you like to save your current KevScript to a file?",e.filename="script"+(Math.floor(900*Math.random())+100),e.save=function(){function n(e,t){return e.indexOf(t,e.length-t.length)!==-1}var a=".kevs";n(e.filename,a)&&(e.filename=e.filename.substr(0,e.filename.length-".kevs".length)),l.save(e.kevscript,e.filename,a,"kevscript"),t.close()}}]}).result.finally(function(){f&&f.focus()})}function u(e){e&&e.preventDefault&&e.preventDefault(),jQuery("input#kevscript-upload").click();
}var f=null;t.kevscript="",t.processing=!1,t.message=null,t.ctxVars={},t.error=null,t.lintWarnings=[],t.linting=!1,t.typing=!1,t.editorState="idle",t.editorOptions={mode:"kevscript",theme:"kevscript",lineWrapping:!0,lineNumbers:!0,styleActiveLine:!0,extraKeys:{"Shift-Enter":function(){t.merge()},"Ctrl-Space":function(e){e.showHint({hint:CodeMirror.hint.kevscript,completeSingle:!1,alignWithWord:!1})},"Ctrl-S":p,"Ctrl-O":u},gutters:["CodeMirror-lint-markers"],lint:{getAnnotations:CodeMirror.lint.kevscript(t.ctxVars),async:!0}},t.dndLoad=function(n,a){n.endsWith(".kevs")?t.kevscript=a:(t.kevscript="",e.dndLoad(n,a))},t.editorLoaded=function(e){f=e,CodeMirror.hint.kevscript.async=!0,f.on("beforeChange",function(){a(function(){t.editorState="typing",t.error=null,t.lintWarnings=[]})}),f.on("lintStart",function(){a(function(){t.editorState="linting"})}),f.on("lintDone",function(e,n,r){a(function(){t.editorState="idle",t.model=r,t.error=e||n.filter(function(e){return"error"===e.severity})[0],t.lintWarnings=n.filter(function(e){return"warning"===e.severity}),t.linting=!1})}),f.focus(),CodeMirror.signal(f,"change",f)},t.uploadKevscript=function(){var e=jQuery("#kevscript-upload");e.on("change",function(e){var n=new FileReader;n.onloadend=function(){t.kevscript=f.setValue(n.result)},n.readAsBinaryString(e.target.files[0])}),e.trigger("click")},t.closeMessage=function(){t.message=null},t.isMergeable=function(){return"idle"===t.editorState&&!t.processing&&!t.error&&t.kevscript.trim().length>0},t.clearCtxVars=function(){Object.keys(t.ctxVars).forEach(function(e){delete t.ctxVars[e]}),CodeMirror.signal(f,"change",f)},t.addCtxVar=function(e){e.key&&e.value&&(t.ctxVars[e.key]=e.value,e.key="",e.value="",CodeMirror.signal(f,"change",f))},t.onFileLoaded=function(e,n){t.kevscript=n},t.removeCtxVar=function(e){delete t.ctxVars[e],CodeMirror.signal(f,"change",f)},t.merge=function(){t.processing||(t.processing=!0,a(function(){i.setModel(t.model,function(e){t.processing=!1,e?t.error=e:(f.setValue(""),d.success({title:"KevScript",message:"Successfully merged"}))})}))},t.model2kevs=function(){try{var e=s.parseModel(i.getModel());f.setValue(e)}catch(e){console.warn("[kevscript.controller.model2kevs()] Error creating Kevscript from model"),console.error(e.stack),d.error({title:"KevScript parser",message:"Unable to convert current model to KevScript",delay:5e3})}},t.save=p,t.open=u,o.bindTo(t).add({combo:"ctrl+o",description:"Open a KevScript from a file",callback:t.open}),o.bindTo(t).add({combo:"ctrl+s",description:"Save current KevScript to a file",callback:t.save}),o.bindTo(t).add({combo:"shift+enter",description:"Merges current KevScript to model",callback:function(){t.isMergeable()&&t.merge()}}),t.toggleShortcutHelp=function(){o.toggleCheatSheet()}}]),angular.module("editorApp").factory("util",function(){function e(e){return"true"===e||e>0||e===!0}function t(e){e=e||5;for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function n(e,t){return"number"!=typeof e&&(e=0),"number"!=typeof t&&(t=65535),Math.floor(Math.random()*(t-e+1))+e}function a(){return Math.random()<.5}function r(e){for(var t=e.concat(),n=0;n<t.length;++n)for(var a=n+1;a<t.length;++a)t[n]===t[a]&&t.splice(a--,1);return t}return{isTruish:e,randomString:t,randomNumber:n,randomBoolean:a,arrayUnique:r}}),angular.module("editorApp").filter("trustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),function(){function e(e){function t(e){e.content.currentValue&&(o.expanded=!0,angular.isNumber(o.length)||(o.length=200),o.expandable=o.content.length>o.length,o.toggleText="Reduce",n())}function n(){var t=o.content.substr(0,o.length);o.expandable&&(t+="..."),o.expanded=!1,o.toggleText="Read more",o.trustedHtml=e.trustAsHtml(t)}function a(){o.expanded=!0,o.toggleText="Reduce",o.trustedHtml=e.trustAsHtml(o.content)}function r(){o.expanded?n():a()}var o=this;o.expanded=!1,o.expandable=!1,o.toggleText="Read more",o.$onChanges=t,o.toggle=r,o.expand=a,o.reduce=n}angular.module("editorApp").component("truncate",{template:'<p class="text-justify" ng-bind-html="$ctrl.trustedHtml"></p><a ng-if="$ctrl.expandable" href ng-click="$ctrl.toggle()">{{ $ctrl.toggleText }}</a>',bindings:{content:"<",length:"<"},controller:e}),e.$inject=["$sce"]}(),angular.module("editorApp").factory("saveFile",function(){return{save:function(e,t,n,a){t=t||"model"+(Math.floor(900*Math.random())+100),n=n||".txt",a=a||"text/plain";var r=new Blob([e],{type:a}),o=document.createElement("a");o.download=t+n,o.innerHTML="Download File",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?o.href=URL.createObjectURL(r):(o.href=URL.createObjectURL(r),o.onclick=function(e){document.body.removeChild(e.target)},o.style.display="none",document.body.appendChild(o)),o.click()}}}),angular.module("editorApp").directive("onData",["$parse",function(e){return{restrict:"A",scope:!1,link:function(t,n,a){var r=e(a.onData);n.on("change",function(e){var n=new FileReader;n.onload=function(n){t.$apply(function(){r(t,{$data:n.target.result,$name:e.target.files[0].name})})};try{n.readAsText(e.target.files[0])}catch(e){}}),n.on("click",function(){this.value=null})}}}]),angular.module("editorApp").filter("namingPattern",["util",function(e){var t=new RegExp("\\{randomInt(:(\\d+):(\\d+))?\\}","g"),n=new RegExp("\\{randomStr(:(\\d+))?\\}","g");return function(a,r){if("string"==typeof a){"object"==typeof r&&Object.keys(r).forEach(function(e){a=a.replace(new RegExp("{"+e+"}","g"),r[e])});var o=t.exec(a),i=e.randomNumber();o&&o[2]&&o[3]&&(i=e.randomNumber(parseInt(o[2]),parseInt(o[3])));var s=n.exec(a),l=e.randomString();return s&&s[2]&&(l=e.randomString(parseInt(s[2]))),a.replace(t,i).replace(n,l)}throw new Error("namingPattern filter must be applied on string only.")}}]),angular.module("editorApp").factory("kModelHelper",["kFactory","KWE_POSITION","KWE_TAG","KWE_SELECTED","KWE_FOLDED",function(e,t,n,a,r){function o(e,t,n){"undefined"==typeof n&&(n=0);var a,r=e.name+"_"+n;switch(t){case"node":a=e.eContainer().findNodesByID(r),a&&(r=o(e,t,++n));break;case"group":a=e.eContainer().findGroupsByID(r),a&&(r=o(e,t,++n));break;case"channel":a=e.eContainer().findHubsByID(r),a&&(r=o(e,t,++n));break;case"component":a=e.eContainer().findComponentsByID(r),a&&(r=o(e,t,++n))}return r}return{genPkgName:function(e){function t(e){e.eContainer()&&(n=e.name+"."+n,t(e.eContainer()))}var n=e.name;return t(e.eContainer()),n},getFqn:function(e){var t=this.genPkgName(e.eContainer());return"org.kevoree.library"===t?t="":t+=".",t+e.name+"/"+e.version},getTypeDefinitionType:function(e){if(e)switch(e.metaClassName()){case"org.kevoree.NodeType":return"node";case"org.kevoree.GroupType":return"group";case"org.kevoree.ComponentType":return"component";case"org.kevoree.ChannelType":return"channel"}return null},findBestVersion:function(e){for(var t=e[0],n=1;n<e.length;n++)parseInt(t.version,10)<=parseInt(e[n].version,10)&&(t=e[n]);return t},getPlatforms:function(e){var t=[];return e&&e.deployUnits.array.forEach(function(e){var n=e.findFiltersByID("platform");n&&t.indexOf(n.value)===-1&&t.push(n.value)}),t},getTags:function(e){var t=[],a=e.findMetaDataByID(n);return a&&a.value.length>0&&(t=a.value.split(",")),t},getNodeTreeHeight:function e(t){if(0===t.hosts.size())return 0;var n=t.hosts.array.map(e),a=0;return n.forEach(function(e){e>a&&(a=e)}),a+1},getNodeTypes:function(e){return e.select("**/typeDefinitions[*]").array.filter(function(e){return"org.kevoree.NodeType"===e.metaClassName()})},getGroupTypes:function(e){return e.select("**/typeDefinitions[*]").array.filter(function(e){return"org.kevoree.GroupType"===e.metaClassName()})},getComponentTypes:function(e){return e.select("**/typeDefinitions[*]").array.filter(function(e){return"org.kevoree.ComponentType"===e.metaClassName()})},getChannelTypes:function(e){return e.select("**/typeDefinitions[*]").array.filter(function(e){return"org.kevoree.ChannelType"===e.metaClassName()})},getNodeTreeHeights:function(e){var t=[];return e.forEach(function(e){var n=this.getNodeTreeHeight(e);t.indexOf(n)===-1&&t.push(n)}.bind(this)),t},getCompDepth:function(e){function t(e){e.host&&(n+=1,t(e.host))}var n=0;return t(e.eContainer()),n},getNbInstances:function(e){return this.getNbNodes(e)+this.getNbGroups(e)+this.getNbChannels(e)+this.getNbComponents(e)},getNbNodes:function(e){return e.nodes.array.length},getNbGroups:function(e){return e.groups.array.length},getNbChannels:function(e){return e.hubs.array.length},getNbComponents:function(e){var t=0;return e.nodes.array.forEach(function(e){t+=e.components.array.length}),t},getHighestNode:function(e){switch(e.getRefInParent()){case"components":return this.getHighestNode(e.eContainer());case"hosts":return this.getHighestNode(e.host);case"nodes":return e.host?this.getHighestNode(e.host):e}},isCompatible:function(e,t){if(e&&t){if(e.select("metaData[name=virtual]").array.length>0)return!0;var n=[];t.typeDefinition.deployUnits.array.forEach(function(e){var t=e.findFiltersByID("platform");t&&n.push(t.value)});for(var a=0;a<n.length;a++)if(e.select("deployUnits[name=*]/filters[name=platform,value="+n[a]+"]").array.length>0)return!0}return!1},isAlreadyBound:function(e,t){var n=!1;if(e)for(var a=0;a<e.bindings.array.length;a++)if(e.bindings.array[a].hub&&e.bindings.array[a].hub.path()===t.path())return!0;return n},isTruish:function(e){return e===!0||"true"===e||e>0},isValid:function(e){if(e.typeDefinition&&e.typeDefinition.dictionaryType&&e.typeDefinition.dictionaryType.attributes.array.length>0)if(e.dictionary&&e.dictionary.values.array.length>0)for(var t=0;t<e.dictionary.values.array.length;t++){var n=e.dictionary.values.array[t],a=e.typeDefinition.dictionaryType.findAttributesByID(n.name);if(!this.isValueValid(n,a))return!1}else for(var r=0;r<e.typeDefinition.dictionaryType.attributes.array.length;r++)if(!this.isTruish(e.typeDefinition.dictionaryType.attributes.array[r].optional))return!1;return!0},isValueValid:function(e,t){return!!(this.isTruish(t.optional)||"undefined"!=typeof e.value&&null!==e.value&&0!==e.value.length)},isVirtual:function(e){if(e){if("org.kevoree.ComponentInstance"===e.metaClassName()||"org.kevoree.ContainerNode"===e.metaClassName()||"org.kevoree.Group"===e.metaClassName()||"org.kevoree.Channel"===e.metaClassName())return this.isVirtual(e.typeDefinition);if("org.kevoree.ComponentType"===e.metaClassName()||"org.kevoree.NodeType"===e.metaClassName()||"org.kevoree.GroupType"===e.metaClassName()||"org.kevoree.ChannelType"===e.metaClassName()){var t=e.findMetaDataByID("virtual");return null!==t}if("org.kevoree.MBinding"===e.metaClassName()&&e.hub)return this.isVirtual(e.hub.typeDefinition)}return!1},isChannelDistributed:function(e){var t={};return e.bindings.array.forEach(function(e){if(e.port&&e.port.eContainer()){var n=e.port.eContainer(),a=this.getHighestNode(n);t[a.path()]=!0}}.bind(this)),Object.keys(t).length>1},isSelected:function(e){if(e&&e.findMetaDataByID){var t=e.findMetaDataByID(a);if(t)return this.isTruish(t.value)}return!1},isFolded:function(e){if(e&&e.findMetaDataByID){var t=e.findMetaDataByID(r);if(t)return this.isTruish(t.value)}return!1},setSelected:function(t,n){if(t&&t.findMetaDataByID){var r=t.findMetaDataByID(a);r||(r=e.createValue(),r.name=a,t.addMetaData(r)),r.value=n}},setFolded:function(t,n){if(t){var a=t.findMetaDataByID(r);a||(a=e.createValue(),a.name=r,t.addMetaData(a)),a.value=n}},isAttributeInType:function(e,t,n){if(e.typeDefinition.dictionaryType){var a=e.typeDefinition.dictionaryType.findAttributesByID(t);return a&&a.fragmentDependant===n}return!1},getSelection:function(e){return e.select("**/metaData[name="+a+",value=true]").array.map(function(e){return e.eContainer()})},fqnToPath:function(e){e=e.split("/");var t;2===e.length&&(t=e.pop()),e=e[0].split(".");var n=e.pop();return e=0===e.length?"packages[name="+n:"packages["+e.join("]/packages[")+"]/*[name="+n,t&&(e+=",version="+t),e+="]"},pkgFqnToPath:function(e){e=e.split(".");var t=e.pop();return 0===e.length?"packages["+t+"]":"packages["+e.join("]/packages[")+"]/packages["+t+"]"},clone:function(n){function a(a){a.started=n.started;var r=n.findMetaDataByID(t);if(r){var o=JSON.parse(r.value),s=e.createValue();s.name=t,s.value=JSON.stringify({x:o.x+50,y:o.y+50}),a.addMetaData(s)}a.dictionary=i.cloneDictionary(n.dictionary)}var r,i=this;switch(this.getTypeDefinitionType(n.typeDefinition)){case"node":r=e.createContainerNode(),a(r),r.typeDefinition=n.eContainer().findByPath(n.typeDefinition.path()),r.name=o(n,"node"),n.components.array.forEach(function(e){r.addComponents(i.clone(e))}),n.hosts.array.forEach(function(e){var t=i.clone(e);n.eContainer().addNodes(t),r.addHosts(t)});break;case"group":r=e.createGroup(),a(r),r.typeDefinition=n.eContainer().findByPath(n.typeDefinition.path()),r.name=o(n,"group");break;case"channel":r=e.createChannel(),a(r),r.typeDefinition=n.eContainer().findByPath(n.typeDefinition.path()),r.name=o(n,"channel");break;case"component":r=e.createComponentInstance(),a(r),r.typeDefinition=n.eContainer().eContainer().findByPath(n.typeDefinition.path()),r.name=o(n,"component")}return r},cloneDictionary:function(t){var n=e.createDictionary().withGenerated_KMF_ID("0.0");return t&&t.values.array.forEach(function(t){var a=e.createValue();a.name=t.name,a.value=t.value,n.addValues(a)}),n}}}]),angular.module("editorApp").filter("isCompatible",["kModelHelper","kEditor",function(e,t){return function(n,a,r){return"component"===a?n.filter(function(n){if(n&&n.tdef&&r){var a=e.isCompatible(n.tdef,t.getModel().findNodesByID(r));return a}return!1}):n}}]),angular.module("editorApp").directive("hljs",function(){return{restrict:"AE",scope:{content:"="},link:function(e,t){hljs.highlightBlock(t[0])}}}),angular.module("editorApp").directive("focus",["$timeout",function(e){return{restrict:"A",link:function(t,n,a){t.$watch(a.focus,function(t){var a,r;angular.isNumber(t)?(a=t,r=!0):(a=0,r=Boolean(t)),r&&e(function(){n[0].focus(),"function"==typeof n[0].select&&n[0].select()},a)})}}}]),angular.module("editorApp").directive("dropTarget",["$parse",function(e){var t="dnd-overlay";return{restrict:"A",scope:!1,link:function(n,a,r){function o(e){var t=e.originalEvent.dataTransfer;if(t&&t.files.length){var a=t.files[0],r=new FileReader;r.onloadend=function(e){n.$apply(function(){c(n,{$event:e,$data:e.target.result,$name:a.name})})},r.readAsText(a)}e.stopPropagation(),e.preventDefault(),p.hide()}function i(e){clearTimeout(l),e.stopPropagation(),e.preventDefault(),p.show()}function s(e){l=setTimeout(function(){e.stopPropagation(),p.hide()},200)}var l,c=e(r.dropTarget),d=jQuery(a[0]),p=jQuery('<div class="'+t+'" style="display: none;"><p class="center-message">Drop to load the model</p></div>');d.append(p),d.on("dragleave",s),d.on("dragover",i),d.on("drop",o),n.$on("$destroy",function(){d.off("dragleave",s),d.off("dragover",i),d.off("drop",o)})}}}]),angular.module("editorApp").filter("camelize",function(){return function(e){if("string"==typeof e)return e.replace(/(?:^|[-_])(\w)/g,function(e,t){return t?t.toUpperCase():""});throw new Error("Camelize filter must be used on string only")}}),angular.module("editorApp").directive("fileread",[function(){return{controller:["$scope","$element","$attrs",function(e,t,n){t.bind("change",function(t){var a=new FileReader;a.onload=function(t){e.fileread=t.target.result,e.$eval(n.onfileread)},a.readAsBinaryString(t.target.files[0])})}]}}]),angular.module("editorApp").service("storage",function(){return{get:function(e,t){var n=localStorage.getItem(e);return n?JSON.parse(n).val:t},set:function(e,t){localStorage.setItem(e,JSON.stringify({val:t}))},remove:function(e){localStorage.removeItem(e)},clear:function(){localStorage.clear()},keys:function(){for(var e=[],t=0,n=localStorage.length;t<n;++t)e.push(localStorage.key(t));return e}}}),angular.module("editorApp").service("kWs",["kFactory",function(e){function t(e){return e?"/"!==e.substr(0,1)&&(e="/"+e):e="/",e}return{getModel:function(n,a,r,o){var i=!1,s=!1,l=null,c=setTimeout(function(){i=!0,s=!0;try{l.close()}catch(e){}var e=new Error("Connection with ws://"+n+":"+a+r+" timed out");o(e,null,"ws://"+n+":"+a+r)},5e3);r=t(r);try{l=new WebSocket("ws://"+n+":"+a+r),l.onopen=function(){clearTimeout(c),l.send("pull")},l.onmessage=function(t){try{var s=e.createJSONLoader(),d=s.loadModelFromString(t.data).get(0);i=!0,l.close(),setTimeout(function(){o(null,d,"ws://"+n+":"+a+r)})}catch(e){clearTimeout(c),console.warn("[ws.factory.getModel()] Error parsing model from message:"),console.warn("[ws.factory.getModel()] msg.data="+t.data),i=!0,l.close(),o(new Error("Unable to load received model from ws://"+n+":"+a+r),null,"ws://"+n+":"+a+r)}},l.onerror=function(e){s=!0,e=new Error("Unable to connect to ws://"+n+":"+a+r),clearTimeout(c),o(e,null,"ws://"+n+":"+a+r)},l.onclose=function(){if(!i&&!s){clearTimeout(c);var e=new Error("Connection with ws://"+n+":"+a+r+" closed");o(e,null,"ws://"+n+":"+a+r)}}}catch(e){clearTimeout(c),o(new Error("Unable to load received model from ws://"+n+":"+a+r),null,"ws://"+n+":"+a+r)}return l},pushModel:function(n,a,r,o,i){var s,l=!1,c=!1,d=null,p=setTimeout(function(){l=!0,c=!0;try{d.close()}catch(e){}var e=new Error("Connection with ws://"+a+":"+r+o+" timed out");i(e,null,"ws://"+a+":"+r+o)},5e3);try{var u=e.createJSONSerializer();s=u.serialize(n)}catch(e){var f=new Error("Unable to serialize current model");return i(f),null}return s&&(o=t(o),d=new WebSocket("ws://"+a+":"+r+o),d.onopen=function(){clearTimeout(p),d.send("push/"+s),l=!0,d.close(),i()},d.onerror=function(e){c=!0,e=new Error("Unable to connect to ws://"+a+":"+r+o),clearTimeout(p),i(e)},d.onclose=function(){if(!l&&!c){clearTimeout(p);var e=new Error("Connection with ws://"+a+":"+r+o+" closed");i(e,null,"ws://"+a+":"+r+o)}}),d}}}]),angular.module("editorApp").factory("uiUtils",["kModelHelper","NODE_HEIGHT","NODE_WIDTH","COMP_HEIGHT","CHANNEL_RADIUS","GROUP_RADIUS",function(e,t,n,a,r,o){function i(e){var n=t;return e.components.array.forEach(function(e){n+=s(e)+10}),e.hosts.array.forEach(function(e){n+=i(e)+10}),n}function s(e){return 0===e.typeDefinition.provided.size()&&0===e.typeDefinition.required.size()?a:e.typeDefinition.provided.size()>e.typeDefinition.required.size()?a*e.typeDefinition.provided.size():a*e.typeDefinition.required.size()}function l(e){return e.parent().hasClass("instance")?l(e.parent()):e.attr("data-path")}function c(e){function t(e){if(e.parent()&&e.parent().hasClass("instance")){var a=e.parent().getBBox();n.x+=a.x,n.y+=a.y,t(e.parent())}}var n=e.getBBox();return t(e),n}function d(e,t,n,a){var r=c(e);return r.x=r.x*a.a+a.e,r.y=r.y*a.a+a.f,r.width*=a.a,r.height*=a.a,t>=r.x&&t<=r.x+r.width&&n>=r.y&&n<=r.y+r.height}function p(e,t){var n=jQuery("svg#editor").offset();return{x:e-n.left,y:t-n.top}}function u(e,t,n,a){function r(){return e.x>=t.x+n/3&&e.x<=t.x+n/3*2?"middle":e.x>t.x+n/3*2?"right":"left"}function o(){return e.y>=t.y+a/3&&e.y<=t.y+a/3*2?"middle":e.y>t.y+a/3*2?"bottom":"top"}var i=o()+"-"+r();switch(i){default:case"top-left":return{x:t.x+2,y:t.y+2};case"top-middle":return{x:t.x+n/2,y:t.y};case"top-right":return{x:t.x+n-2,y:t.y+2};case"middle-left":return{x:t.x,y:t.y+a/2};case"middle-right":return{x:t.x+n,y:t.y+a/2};case"bottom-left":return{x:t.x+2,y:t.y+a-2};case"bottom-middle":return{x:t.x+n/2,y:t.y+a};case"bottom-right":return{x:t.x+n-2,y:t.y+a-2}}}function f(e,t){var n=t.transform().localMatrix,r={x:n.e,y:n.f},o=c(e.parent()),i=e.transform().localMatrix,s={x:o.x+i.e+2,y:o.y+i.f+a-5},l={x:0,y:0};return s.x>r.x?l.x=r.x+(s.x-r.x)/2:l.x=s.x+(r.x-s.x)/2,l.y=(s.y>=r.y?s.y:r.y)+20,{chan:r,port:s,middle:l}}function m(t){var a=document.getElementById("editor");if(a){var i,s=a.getElementsByTagName("defs")[0];if(!document.getElementById("group-clip")){i=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),i.id="group-clip";var l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttribute("cx","0"),l.setAttribute("cy","0"),l.setAttribute("r",o-4+""),i.appendChild(l),s.appendChild(i)}if(!document.getElementById("chan-clip")){i=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),i.id="chan-clip";var c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx","0"),c.setAttribute("cy","0"),c.setAttribute("r",r-4+""),i.appendChild(c),s.appendChild(i)}var d=e.getNodeTreeHeights(t.nodes.array);d.forEach(function(e){if(!document.getElementById("node-clip-"+e)){var t=document.createElementNS("http://www.w3.org/2000/svg","clipPath");t.id="node-clip-"+e;var a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("width",n+20*e-5+""),a.setAttribute("height","100%"),a.setAttribute("x","2"),a.setAttribute("y","0"),t.appendChild(a),s.appendChild(t)}if(!document.getElementById("comp-clip-"+e)){var r=document.createElementNS("http://www.w3.org/2000/svg","clipPath");r.id="comp-clip-"+e;var o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width",n+20*e-60+""),o.setAttribute("height","100%"),o.setAttribute("x","20"),o.setAttribute("y","0"),r.appendChild(o),s.appendChild(r)}})}}return{getAbsoluteBBox:c,getNodeUIHeight:i,getCompUIHeight:s,getHighestNodePath:l,isPointInsideElem:d,computeWireNodeAnchor:u,computeBindingCoords:f,updateSVGDefs:m,getPointInEditor:p}}]),angular.module("editorApp").factory("ui",["util","uiUtils","uiCreateGroup","uiCreateGroupWire","uiCreateNode","uiCreateComponent","uiCreateBinding","uiCreateChannel","kModelHelper","kFactory","Notification","KWE_POSITION","NODE_WIDTH","NODE_HEIGHT","INVALID_RADIUS","GROUP_RADIUS","CHANNEL_RADIUS",function(e,t,n,a,r,o,i,s,l,c,d,p,u,f,m,h,g){var v={model:null,overedInstancePath:null,draggedInstancePath:null,mousePos:{x:0,y:0},init:function(){var e=new Snap("svg#editor");e.zpd({zoomThreshold:[.2,1],zoomScale:.05});var n=this.editor=e.select("#snapsvg-zpd-"+e.id);n.addClass("zpd"),e.mousedown(function(t){1===t.which&&e.selectAll(".selected").forEach(function(e){e.removeClass("selected");var t=e.parent().attr("data-path");if(t&&t.length>0){var n=v.model.findByPath(t);l.setSelected(n,!1)}})}),t.updateSVGDefs(this.model);var a=new MutationObserver(function(t){t.forEach(function(t){if("transform"===t.attributeName){var a=n.transform().localMatrix;e.select("#coord-text").attr({text:"("+parseInt(a.e,10)+", "+parseInt(a.f,10)+") "+parseInt(100*a.a,10)+"%"})}})});a.observe(n.node,{attributes:!0,childList:!1,characterData:!1}),e.dblclick(function(){n.animate({transform:"s1,t0,0"},400,mina.ease)}),e.text("100%","100%","(0, 0) 100%").attr({id:"coord-text",fill:"#000",textAnchor:"end"}).transform("t-5,-5")},createGroup:function(e){n(this,e)},createGroupWire:function(e,t){a(this,e,t)},createNode:function(e){r(this,e)},createComponent:function(e){return o(this,e)},createBinding:function(e){i(this,e)},createChannel:function(e){s(this,e)},updateValidity:function(e){if(this.editor){var t=this.editor.select('.instance[data-path="'+e.path()+'"]'),n=this.editor.select('.instance[data-path="'+e.path()+'"] > .invalid-icon');if(l.isValid(e))n&&n.remove();else{n&&n.remove(),n=this.editor.circle(0,0,m).attr({class:"invalid-icon",fill:"red",stroke:"black",title:"Invalid dictionary attributes"});var a=n.transform().localMatrix;switch(l.getTypeDefinitionType(e.typeDefinition)){case"node":a.e=t.getBBox().width-2*m,a.f=2*m;break;case"group":a.f=-h+2*m;break;case"channel":a.f=-g+2*m;break;case"component":a.e=t.getBBox().width}n.transform(a),t.append(n)}}},deleteInstance:function(e,n){var a=this.editor.select('.instance[data-path="'+n+'"]');if(a)if(a.hasClass("comp")||a.hasClass("node")){var r=t.getHighestNodePath(a);v.draggedInstancePath===n?this.editor.append(a):(this.editor.selectAll('.group-wire[data-to="'+n+'"]').remove(),a.remove()),v.refreshNode(r);var o=v.model.findByPath(r);o&&(o.groups.array.forEach(function(e){v.createGroupWire(e,o)}),o.hosts.array.forEach(function e(t){t.groups.array.forEach(function(e){v.createGroupWire(e,t)}),t.hosts.array.forEach(e)}),o.components.array.forEach(function(e){e.provided.array.forEach(function(e){e.bindings.array.forEach(function(e){v.createBinding(e)})}),e.required.array.forEach(function(e){e.bindings.array.forEach(function(e){v.createBinding(e)})})}),o.hosts.array.forEach(function e(t){t.components.array.forEach(function(e){e.provided.array.forEach(function(e){e.bindings.array.forEach(function(e){v.createBinding(e)})}),e.required.array.forEach(function(e){e.bindings.array.forEach(function(e){v.createBinding(e)})})}),t.hosts.array.forEach(e)}))}else a.remove()},deleteGroupWire:function(e,t){var n=this.editor.select('.group-wire[data-from="'+e+'"][data-to="'+t+'"]');n&&n.remove()},deleteBinding:function(e){var t=this.editor.select('.binding[data-path="'+e+'"]');t&&t.remove()},deleteSelected:function(){var e=this.getSelected();return e.forEach(function(e){var t=e.attr("data-path");if(t){var n=v.model.findByPath(t);if(n){var a=!1;if("function"==typeof n.findMetaDataByID){var r=n.findMetaDataByID("access_mode");a=r&&"read-only"===r.value}a?d.warning({title:"Delete instance",message:'Cannot delete read-only instance "'+n.name+'"',delay:3e3}):(n.hosts&&n.hosts.array.forEach(function e(t){t.hosts.array.forEach(e),t.delete()}),n.delete())}}else if(e.hasClass("group-wire")){var o=v.model.findByPath(e.attr("data-from")),i=v.model.findByPath(e.attr("data-to"));i&&o&&(i.removeGroups(o),o.removeSubNodes(i))}}),e.length},removeUIElem:function(e){var t=this.editor.select('.instance[data-path="'+e+'"]');t&&t.remove()},deleteNodes:function(){this.editor.selectAll(".node").remove(),this.editor.selectAll(".group-wire").remove()},deleteGroups:function(){this.editor.selectAll(".group").remove(),this.editor.selectAll(".group-wire").remove()},deleteChannels:function(){this.editor.selectAll(".chan").remove()},deleteBindings:function(){this.editor.selectAll(".binding").remove()},updateInstance:function(t,n){var a=this.editor.select('.instance[data-path="'+t+'"]');if(a){a.attr({"data-path":n.path()});var r=a.select("text.name");r&&r.attr({text:n.name}),a.parent().hasClass("node")||a.relocate(n),(n.components||n.hosts)&&n.components.array.forEach(function(e){var r=a.select('.instance[data-path="'+t+"/components["+e.name+']"]');r&&r.attr({"data-path":e.path().replace(t,n.path())})}),a.hasClass("comp")?a.select(".bg").attr({fillOpacity:e.isTruish(n.started)?1:.65}):r&&r.attr({fill:e.isTruish(n.started)?"#fff":"#000"}),a.hasClass("node")&&this.editor.selectAll('.group-wire[data-to="'+t+'"]').attr({"data-to":n.path()}),a.hasClass("group")&&this.editor.selectAll('.group-wire[data-from="'+t+'"]').attr({"data-from":n.path()})}},updatePosition:function(e){var t=this.editor.select('.instance[data-path="'+e.path()+'"]');t&&(t.parent().hasClass("node")||t.relocate(e))},updateCompTypeDefinition:function(e,t){t.required.array.forEach(function(t){var n=!1;if(e.typeDefinition.required.array.forEach(function(a){if(a.name===t.name){n=!0;var r=e.findRequiredByID(a.name);r&&(r.portTypeRef=a)}}),!n){var a=e.findRequiredByID(t.name);a&&(a.bindings.array.forEach(function(e){e.delete()}),a.delete())}}),t.provided.array.forEach(function(t){var n=!1;if(e.typeDefinition.provided.array.forEach(function(a){if(a.name===t.name){n=!0;var r=e.findProvidedByID(t.name);r&&(r.portTypeRef=a)}}),!n){var a=e.findProvidedByID(t.name);a&&(a.bindings.array.forEach(function(e){e.delete()}),a.delete())}});var n=v.createComponent(e);n.select(".bg").addClass("selected"),this.refreshNode(e.eContainer().path())},toggleFold:function(e,n){function a(e){var t=v.editor.select('.chan[data-path="'+e.path()+'"]');t&&(l.isChannelDistributed(e)?n?t.attr({strokeDasharray:"5 3"}):t.attr({strokeDasharray:""}):n?t.addClass("hide"):t.removeClass("hide"))}function r(e){e.hub&&a(e.hub);var t=v.editor.select('.binding[data-path="'+e.path()+'"]');t&&(n?t.addClass("hide"):t.removeClass("hide"))}function o(e){e.bindings.array.forEach(r)}function i(e){e.provided.array.forEach(o),e.required.array.forEach(o);var t=v.editor.select('.comp[data-path="'+e.path()+'"]');t&&(n?t.addClass("hide"):t.removeClass("hide"))}function s(e){e.components.array.forEach(i),e.hosts.array.forEach(s);var t=v.editor.select('.node[data-path="'+e.path()+'"]');t&&(n?t.addClass("hide"):t.removeClass("hide"))}e.components.array.forEach(i),e.hosts.array.forEach(s);var c=v.editor.select('.node[data-path="'+e.path()+'"]');c&&(n?c.select(".bg").attr({height:f,strokeDasharray:"5 3"}):c.select(".bg").attr({height:t.getNodeUIHeight(e),strokeDasharray:""}))},refreshNode:function(e){var n=v.model.findByPath(e);if(n){var a=v.editor.select('.node[data-path="'+e+'"]'),r=l.getNodeTreeHeight(n),o=u+20*r;n.host&&(o=u+20*(l.getNodeTreeHeight(n.host)-1)),a.relocate(n),a.select(".bg").attr({width:o,height:t.getNodeUIHeight(n)}),v.editor.selectAll('.node[data-path="'+e+'"] > text').attr({x:o/2,"clip-path":"url(#node-clip-"+r+")"}),n.components.array.forEach(function(e){v.refreshComp(e.path())}),n.hosts.array.forEach(function(e){v.refreshNode(e.path())});var i=v.editor.selectAll('.node[data-path="'+n.path()+'"] > .instance').items,s=f;i.forEach(function(e){e.transform("t"+(o-e.select(".bg").asPX("width"))/2+","+s),s+=e.select(".bg").asPX("height")+10}),n.components.array.forEach(function(e){e.provided.array.forEach(function(e){e.bindings.array.forEach(function(e){v.createBinding(e)})}),e.required.array.forEach(function(e){e.bindings.array.forEach(function(e){v.createBinding(e)})})}),this.updateValidity(n)}},refreshComp:function(e){var t=v.model.findByPath(e);if(t){var n=v.editor.select('.comp[data-path="'+e+'"]'),a=v.editor.select('.node[data-path="'+t.eContainer().path()+'"]'),r=l.getNodeTreeHeight(t.eContainer()),o=a.select(".bg").asPX("width")-20;if(n&&a){n.select(".bg").attr({width:o}),v.editor.selectAll('.comp[data-path="'+e+'"] > text').attr({x:o/2,"clip-path":"url(#comp-clip-"+r+")"});var i=3;t.typeDefinition.required.array.forEach(function(e){var t=n.select('.required[data-name="'+e.name+'"]');t.transform("t"+(o-i)+","+t.transform().localMatrix.f)}),this.updateValidity(t)}}else this.createComponent(t)},getSelected:function(){return this.editor.selectAll(".selected").items.map(function(e){return e.parent()})},getSelectedPaths:function(){return this.getSelected().map(function(e){return e.attr("data-path")})},getSelectedNodes:function(){return this.editor.selectAll(".node > .selected").items.map(function(e){return e.parent()})},getNodePathAtPoint:function(e,t){var n=this.getEditorContainer(),a=v.getHoveredNode(e-n.offsetLeft,t-n.offsetTop);return a?a.attr("data-path"):null},getEditorContainer:function(){return document.getElementById("editor-container")},selectAll:function(){this.editor.selectAll(".bg").items.forEach(function(e){e.addClass("selected")})},isSelected:function(e){var t=this.editor.select('.instance[data-path="'+e+'"]');return!(!t||!t.select(".bg").hasClass("selected"))},setDropTarget:function(e){this.dropTarget=e},getDropTarget:function(){return this.dropTarget},setModel:function(e){this.model=e,this.editor&&(t.updateSVGDefs(e),this.editor.clear())},getHoveredNode:function(e,n,a){var r=this.editor.transform().localMatrix;return this.editor.selectAll(".node").items.filter(function(o){return a?o.attr("data-path")!==a&&t.isPointInsideElem(o,e,n,r):t.isPointInsideElem(o,e,n,r)}).sort(function(e,t){return e.getBBox().width-t.getBBox().width})[0]},getHoveredChan:function(e,t){for(var n=this.editor.selectAll(".chan").items,a=0;a<n.length;a++)if(Snap.path.isPointInsideBBox(n[a].getBBox(),e,t))return n[a];return null},getHoveredPort:function(e,n){for(var a=this.editor.selectAll(".port").items,r=0;r<a.length;r++)if(t.isPointInsideElem(a[r],e,n,this.editor.transform().localMatrix))return a[r];return null},hasErrors:function(){return this.editor.selectAll(".invalid-icon").length>0},order:function(){this.editor.selectAll(".binding").forEach(function(e){e.node.parentNode.appendChild(e.node)})}};return Snap.plugin(function(e,n){var a=function(e,n,a){if(!this.parent().hasClass("instance")){
var r=jQuery(v.editor.node).find("> .instance");this.node.parentNode.insertBefore(this.node,r[r.length-1].nextSibling)}this.data("dragStartX",e),this.data("dragStartY",n),v.draggedInstancePath=this.attr("data-path");var o=this.data("dragStart");if(o&&o.forEach(function(t){t.apply(this,[e,n,a])}.bind(this)),this.hasClass("comp")||this.hasClass("node")){var i=t.getAbsoluteBBox(this);this.data("ot","t"+i.x+","+i.y)}else this.data("ot",this.transform().local);this.data("hasMoved",!1)},r=function(e,t,n,a,r){var o=this.data("dragStartX"),i=this.data("dragStartY");if("undefined"!=typeof o&&"undefined"!=typeof i)if("object"==typeof e&&"touchmove"===e.type&&(r=e,n=r.changedTouches[0].clientX,a=r.changedTouches[0].clientY,e=n-o,t=a-i),this.transform(this.data("ot")+(this.data("ot")?"T":"t")+[e,t]),this.data("hasMoved")){var s=this.data("dragMove");s&&s.forEach(function(o){o.apply(this,[e,t,n,a,r])}.bind(this))}else{this.data("hasMoved",!0);var l=this.data("firstDragMove");l&&l.forEach(function(o){o.apply(this,[e,t,n,a,r])}.bind(this))}},o=function(){var e=arguments;if(this.data("hasMoved")){var t=v.model.findByPath(this.attr("data-path"));if(t){var n=t.findMetaDataByID(p);n||(n=c.createValue(),n.name=p,t.addMetaData(n));var a=this.transform().localMatrix;n.value=JSON.stringify({x:a.e,y:a.f})}var r=this.data("dragEnd");r&&r.forEach(function(t){t.apply(this,e)}.bind(this)),this.data("hasMoved",!1)}this.removeData("dragStartX"),this.removeData("dragStartY"),this.removeData("ot"),v.draggedInstancePath=null};n.prototype.draggable=function(){return this.drag(function(e,t,n,a,o){1===o.which&&r.apply(this,arguments)},function(e,t,n){1===n.which&&a.apply(this,arguments)},function(e){1===e.which&&o.apply(this,arguments)})},n.prototype.dragStart=function(e){var t=this.data("dragStart")||[];return t.push(e),this.data("dragStart",t)},n.prototype.dragEnd=function(e){var t=this.data("dragEnd")||[];return t.push(e),this.data("dragEnd",t)},n.prototype.dragMove=function(e){var t=this.data("dragMove")||[];return t.push(e),this.data("dragMove",t)},n.prototype.startPtDrag=function(e){return this.data("startPtDrag",e)},n.prototype.endPtDrag=function(e){return this.data("endPtDrag",e)},n.prototype.firstDragMove=function(e){var t=this.data("firstDragMove")||[];return t.push(e),this.data("firstDragMove",t)},n.prototype.selectable=function(e){var t=function(t){1===t.which&&(t.cancelBubble=!0,t.ctrlKey||t.shiftKey||v.editor.selectAll(".selected").forEach(function(e){e.removeClass("selected");var t=e.parent().attr("data-path");if(t&&t.length>0){var n=v.model.findByPath(t);l.setSelected(n,!1)}}),t.ctrlKey||t.shiftKey?(this.select(".bg").toggleClass("selected"),this.select(".bg").hasClass("selected")?l.setSelected(e,!0):l.setSelected(e,!1)):(this.select(".bg").addClass("selected"),l.setSelected(e,!0)))};return this.mousedown(t).touchstart(t)},n.prototype.relocate=function(e){var t=e.findMetaDataByID(p),n={x:100,y:100};if(t)try{n=JSON.parse(t.value)}catch(e){n={x:100,y:100}}else t=c.createValue(),t.name=p,t.value=JSON.stringify(n),e.addMetaData(t);return this.transform("t"+n.x+","+n.y)}}),v}]),angular.module("editorApp").constant("GROUP_RADIUS",55).constant("GROUP_PLUG_RADIUS",10).constant("NODE_WIDTH",210).constant("NODE_HEIGHT",50).constant("COMP_HEIGHT",40).constant("CHANNEL_RADIUS",12).constant("INVALID_RADIUS",5),angular.module("editorApp").factory("uiCreateNode",["uiUtils","util","kModelHelper","NODE_WIDTH","NODE_HEIGHT",function(e,t,n,a,r){return function(o,i){o.removeUIElem(i.path()),e.updateSVGDefs(o.model);var s=n.getNodeTreeHeight(i),l=a+20*s;i.host&&(l=a+20*(n.getNodeTreeHeight(i.host)-1));var c=e.getNodeUIHeight(i),d=o.editor.rect(0,0,l,c,8).attr({fill:"white",fillOpacity:.1,stroke:"white",strokeWidth:2,class:n.isSelected(i)?"bg selected":"bg"}),p=o.editor.text(l/2,r/2-2,i.name).attr({fill:t.isTruish(i.started)?"#fff":"#000",textAnchor:"middle",class:"name","clip-path":"url(#node-clip-"+s+")"}),u=o.editor.text(l/2,r/2+12,i.typeDefinition.name).attr({fill:"white",textAnchor:"middle","clip-path":"url(#node-clip-"+s+")"}),f=o.editor.group().attr({class:"instance node","data-path":i.path()}).append(d).append(p).append(u).selectable(i).draggable().dragStart(function(){var e=document.getElementById("editor-container");this.data("offset",{left:e.offsetLeft,top:e.offsetTop})}).firstDragMove(function(){var e=arguments;i.host&&i.host.removeHosts(i);var t=function(t){var n=function(t){var n=o.editor.select('.binding[data-path="'+t.path()+'"]');n&&n.data("firstDragMove").forEach(function(t){t.apply(n,e)})}.bind(this);t.provided.array.forEach(function(e){e.bindings.array.forEach(n)}),t.required.array.forEach(function(e){e.bindings.array.forEach(n)})}.bind(this);i.components.array.forEach(t),i.hosts.array.forEach(function e(n){n.components.array.forEach(t),n.hosts.array.forEach(e)})}).dragMove(function(e,t,n,a){var r=arguments;clearTimeout(this.data("dragTimeout"));var s=this.data("hoveredNode");s&&s.select(".bg").removeClass("hovered error");var l=setTimeout(function(){var e=this.data("offset")||{left:0,right:0},t=o.getHoveredNode(n-e.left,a-e.top,i.path());t?(this.data("hoveredNode",t),t.select(".bg").addClass("hovered")):this.data("hoveredNode",null)}.bind(this),100);this.data("dragTimeout",l);var c=function(e,t){var n=o.editor.select('.group-wire[data-from="'+e.path()+'"][data-to="'+t.path()+'"]');n&&n.data("endPtDrag").apply(n,r)};i.groups.array.forEach(function(e){c(e,i)});var d=function(e){var t=function(e){var t=o.editor.select('.binding[data-path="'+e.path()+'"]');t&&t.data("endPtDrag").apply(t,r)}.bind(this);e.provided.array.forEach(function(e){e.bindings.array.forEach(t)}),e.required.array.forEach(function(e){e.bindings.array.forEach(t)})}.bind(this);i.components.array.forEach(d),i.hosts.array.forEach(function e(t){t.components.array.forEach(d),t.groups.array.forEach(function(e){c(e,t)}),t.hosts.array.forEach(e)})}).dragEnd(function(){function e(e,t){var a=o.editor.select('.group-wire[data-from="'+e.path()+'"][data-to="'+t.path()+'"]');a&&a.data("dragEnd").forEach(function(e){e.apply(a,n)})}function t(e){function t(e){var t=o.editor.select('.binding[data-path="'+e.path()+'"]');t&&t.data("dragEnd").forEach(function(e){e.apply(t,n)})}e.provided.array.forEach(function(e){e.bindings.array.forEach(t)}),e.required.array.forEach(function(e){e.bindings.array.forEach(t)})}var n=arguments,a=this.data("hoveredNode");a&&(a.select(".bg").removeClass("hovered error"),f.remove(),o.model.findByPath(a.attr("data-path")).addHosts(i)),i.groups.array.forEach(function(t){this.removeData(t.path()),e(t,i)}.bind(this)),clearTimeout(this.data("dragTimeout")),i.components.array.forEach(t),i.hosts.array.forEach(function n(a){a.components.array.forEach(t),a.groups.array.forEach(function(t){e(t,a)}),a.hosts.array.forEach(n)}),this.removeData("dragTimeout"),this.removeData("hoveredNode"),this.removeData("offset")});if(i.host){var m=o.editor.select('.node[data-path="'+i.host.path()+'"]'),h=m.selectAll('.node[data-path="'+i.host.path()+'"] > .instance').items,g=(m.select(".bg").asPX("width")-l)/2,v=r;h.forEach(function(e){v+=e.select(".bg").asPX("height")+10}),m.append(f),f.transform("t"+g+","+v)}else f.relocate(i);o.updateValidity(i)}}]),angular.module("editorApp").factory("uiCreateGroupWire",["uiUtils","util","GROUP_RADIUS",function(e,t,n){return function(t,a,r){function o(){i=t.editor.select('.group[data-path="'+a.path()+'"]'),s=t.editor.select('.node[data-path="'+r.path()+'"]'),l=t.editor.select('.group-wire[data-from="'+a.path()+'"][data-to="'+r.path()+'"]');var n=i.transform().localMatrix,o=e.getAbsoluteBBox(s);p={from:{x:0,y:0},to:{x:o.x-n.e,y:o.y-n.f},width:s.select(".bg").asPX("width"),height:s.select(".bg").asPX("height")}}var i,s,l,c,d,p={};o();var u=e.computeWireNodeAnchor(p.from,p.to,p.width,p.height);if(l)l.data("data",p),c=l.select("path").attr({d:"M"+p.from.x+","+p.from.y+" "+u.x+","+u.y}),d=c.getPointAtLength(n+2),c.attr({d:"M"+d.x+","+d.y+" "+u.x+","+u.y}),l.select("circle").attr({cx:u.x,cy:u.y});else{c=t.editor.path("M"+p.from.x+","+p.from.y+" "+u.x+","+u.y).attr({fill:"none",stroke:"#5aa564",strokeWidth:4,strokeLineCap:"round",strokeLineJoin:"round",class:"bg"}).mouseover(function(){this.attr({strokeWidth:5})}).mouseout(function(){this.attr({strokeWidth:4})});var f=t.editor.circle(u.x,u.y,4).attr({fill:"white"});i.group().attr({class:"group-wire","data-from":a.path(),"data-to":r.path()}).data("data",p).append(c).append(f).selectable().startPtDrag(function(t,a){var r=this.data("data"),o={x:r.to.x-t,y:r.to.y-a},i=e.computeWireNodeAnchor(r.from,o,r.width,r.height);c.attr({d:"M"+r.from.x+","+r.from.y+" "+i.x+","+i.y}),d=c.getPointAtLength(n+2),c.attr({d:"M"+d.x+","+d.y+" "+i.x+","+i.y}),f.attr({cx:i.x,cy:i.y})}).endPtDrag(function(t,a){var r=this.data("data"),o={x:r.to.x+t,y:r.to.y+a},i=e.computeWireNodeAnchor(r.from,o,r.width,r.height);c.attr({d:"M"+r.from.x+","+r.from.y+" "+i.x+","+i.y}),d=c.getPointAtLength(n+2),c.attr({d:"M"+d.x+","+d.y+" "+i.x+","+i.y}),f.attr({cx:i.x,cy:i.y})}).dragEnd(function(){o(),this.data("data",p)}),d=c.getPointAtLength(n+2),c.attr({d:"M"+d.x+","+d.y+" "+u.x+","+u.y})}}}]),angular.module("editorApp").factory("uiCreateGroup",["kModelHelper","uiUtils","util","GROUP_RADIUS","GROUP_PLUG_RADIUS",function(e,t,n,a,r){return function(o,i){o.removeUIElem(i.path()),t.updateSVGDefs(o.model);var s=o.editor.circle(0,0,a).attr({fill:"green",stroke:"#000",strokeWidth:3,class:e.isSelected(i)?"bg selected":"bg",opacity:.75}),l=o.editor.circle(0,a/2+r,r).attr({fill:"#f1c30f",class:"group-plug"}).mouseover(function(){this.attr({r:r+1})}).mouseout(function(){this.attr({r:r})}).drag(function(e,n,a,r){var s=this.data("plugPos");this.data("wire").attr({d:"M"+s.x+","+s.y+" "+(s.x+e)+","+(s.y+n)}),clearTimeout(this.data("wireTimeout"));var l=this.data("hoveredNode");l&&l.select(".bg").removeClass("hovered error");var c=setTimeout(function(){var e=t.getPointInEditor(a,r),n=o.getHoveredNode(e.x,e.y);if(n){this.data("hoveredNode",n);var s=n.select(".bg");s.addClass("hovered");var l=o.model.findByPath(n.attr("data-path"));i.findSubNodesByID(l.name)&&s.addClass("error")}else this.data("hoveredNode",null)}.bind(this),100);this.data("wireTimeout",c)},function(){var e=p.transform().localMatrix,t={x:e.e,y:e.f+a/2+r};this.data("plugPos",t);var n=o.editor.path("M"+t.x+","+t.y+" "+t.x+","+t.y).attr({fill:"none",stroke:"#5aa564",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round",opacity:.7});this.data("wire",n)},function(){var e=this.data("hoveredNode");if(e){if(!e.select(".bg").hasClass("error")){var t=o.model.findByPath(e.attr("data-path"));i.findSubNodesByID(t.name)||i.addSubNodes(t)}e.select(".bg").removeClass("hovered error")}this.data("wire").remove(),clearTimeout(this.data("wireTimeout")),this.removeData("wire"),this.removeData("hoveredNode"),this.removeData("plugPos"),this.removeData("wireTimeout")}),c=o.editor.text(0,-5,i.name).attr({fill:n.isTruish(i.started)?"#fff":"#000",textAnchor:"middle",class:"name","clip-path":"url(#group-clip)"}),d=o.editor.text(0,10,i.typeDefinition.name).attr({fill:"white",textAnchor:"middle","clip-path":"url(#group-clip)"}),p=o.editor.group().attr({class:"instance group","data-path":i.path()}).append(s).append(c).append(d).append(l).selectable(i).draggable().dragMove(function(){var e=arguments;i.subNodes.array.forEach(function(t){var n=o.editor.select('.group-wire[data-from="'+i.path()+'"][data-to="'+t.path()+'"]');n&&n.data("startPtDrag").apply(n,e)})}).dragEnd(function(){var e=arguments;i.subNodes.array.forEach(function(t){var n=o.editor.select('.group-wire[data-from="'+i.path()+'"][data-to="'+t.path()+'"]');n&&n.data("dragEnd").forEach(function(t){t.apply(n,e)})})}).relocate(i);return o.updateValidity(i),l.touchstart(function(e){e.cancelBubble=!0}),l.mousedown(function(e){e.cancelBubble=!0}),p}}]),angular.module("editorApp").factory("uiCreateComponent",["$uibModal","uiUtils","util","kFactory","kModelHelper","Notification","COMP_HEIGHT","NODE_HEIGHT",function(e,t,n,a,r,o,i,s){return function(l,c){var d,p;l.removeUIElem(c.path()),t.updateSVGDefs(l.model);var u=l.editor.select('.instance[data-path="'+c.eContainer().path()+'"]'),f=u.select(".bg").asPX("width")-20,m=t.getCompUIHeight(c),h=r.getNodeTreeHeight(c.eContainer()),g=l.editor.rect(0,0,f,m,3).attr({fill:"black",fillOpacity:n.isTruish(c.started)?1:.65,stroke:"white",strokeWidth:1.5,class:r.isSelected(c)?"bg selected":"bg"}),v=l.editor.text(f/2,m/2,c.name).attr({fill:"white",textAnchor:"middle",class:"name","clip-path":"url(#comp-clip-"+h+")"}),y=l.editor.text(f/2,m/2+12,c.typeDefinition.name).attr({fill:"white",textAnchor:"middle","clip-path":"url(#comp-clip-"+h+")"}),b=l.editor.group().attr({class:"instance comp","data-path":c.path()}).append(g).append(v).append(y),k=3,x=0,C=0;c.typeDefinition.provided.array.forEach(function(n){var s=l.editor.rect(-8,5,10,i-10,2).attr({fill:"#bc7645",stroke:"#ECCA40",strokeWidth:2}).mouseover(function(){this.attr({strokeWidth:3})}).mouseout(function(){this.attr({strokeWidth:2})}).mousedown(function(e){e.cancelBubble=!0}).touchstart(function(e){e.cancelBubble=!0}).drag(function(e,a,o,i){var s=this.data("portPos"),d={x:0,y:0};s.x>s.x+e?d.x=s.x+e+(s.x-(s.x+e))/2:d.x=s.x+(s.x+e-s.x)/2,d.y=(s.y>=s.y+a?s.y:s.y+a)+20,this.data("binding").attr({d:"M"+s.x+","+s.y+" Q"+d.x+","+d.y+" "+(s.x+e)+","+(s.y+a)}),clearTimeout(this.data("bindingTimeout"));var p=this.data("hoveredPort");p&&p.select("text").removeClass("hovered error");var u=this.data("hoveredChan");u&&u.select(".bg").removeClass("hovered error");var f=setTimeout(function(){var d=t.getPointInEditor(o,i),p=l.getHoveredPort(d.x,d.y);if(p){this.data("hoveredChan",null),this.data("hoveredPort",p);var u=p.select("text");u.addClass("hovered"),p.hasClass("provided")&&u.addClass("error")}else{this.data("hoveredPort",null);var f=l.getHoveredChan(s.x+e,s.y+a);if(f){this.data("hoveredChan",f);var m=f.select(".bg");m.addClass("hovered");var h=l.model.findByPath(f.attr("data-path"));!r.isAlreadyBound(c.findProvidedByID(n.name),h)&&r.isCompatible(h.typeDefinition,c.eContainer())||m.addClass("error")}else this.data("hoveredChan",null)}}.bind(this),100);this.data("bindingTimeout",f)},function(){var e=p.transform().localMatrix,n=t.getAbsoluteBBox(b),a={x:e.e+n.x,y:e.f+n.y+(i-6)/2+3};this.data("portPos",a);var r=l.editor.path("M"+a.x+","+a.y+" "+a.x+","+a.y).attr({fill:"none",stroke:"#ECCA40",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round",opacity:.7});this.data("binding",r)},function(){clearTimeout(this.data("bindingTimeout"));var t=c.findProvidedByID(n.name);t||(t=a.createPort(),t.name=n.name,t.portTypeRef=n,c.addProvided(t));var i=this.data("hoveredChan");if(i){var s=l.model.findByPath(i.attr("data-path"));if(i.select(".bg").hasClass("error"))s&&!r.isCompatible(s.typeDefinition,c.eContainer())&&o.error({title:"Binding error",message:"<strong>"+s.typeDefinition.name+"</strong> cannot run on platform <strong>"+r.getPlatforms(c.eContainer().typeDefinition).join("")+"</strong>",delay:1e4});else if(s){var d=a.createMBinding();d.hub=s,d.port=t,l.model.addMBindings(d)}i.select(".bg").removeClass("hovered error")}else{var p=this.data("hoveredPort");if(p){if(!p.select("text").hasClass("error")){var u=p.attr("data-name"),f=l.model.findByPath(p.parent().attr("data-path")),m=f.findRequiredByID(u);m||(m=a.createPort(),m.name=u,m.portTypeRef=f.typeDefinition.findRequiredByID(u),f.addRequired(m)),e.open({templateUrl:"app/main/editor/select-chan.modal.html",controller:"SelectChanModalCtrl",resolve:{startPort:t,endPort:m}}).result.then(function(e){if(e){var n=a.createMBinding();n.hub=e,n.port=t,l.model.addMBindings(n);var r=a.createMBinding();r.hub=e,r.port=m,l.model.addMBindings(r)}})}p.select("text").removeClass("hovered error")}}this.data("binding").remove(),this.removeData("binding"),this.removeData("bindingTimeout"),this.removeData("hoveredPort"),this.removeData("hoveredChan"),this.removeData("portPos")}),d=l.editor.text(6,i-4,n.name.substr(0,6)).attr({fill:"white",title:n.name}).append(Snap.parse("<title>"+n.name+"</title>"));p=l.editor.group().attr({class:"port provided","data-name":n.name}).append(s).append(d).transform("t"+k+","+x),b.append(p),x+=i}),c.typeDefinition.required.array.forEach(function(n){var s=l.editor.rect(-3,5,10,i-10,2).attr({fill:"#bc7645",stroke:"#C60808",strokeWidth:2}).mouseover(function(){this.attr({strokeWidth:3})}).mouseout(function(){this.attr({strokeWidth:2})}).mousedown(function(e){e.cancelBubble=!0}).touchstart(function(e){e.cancelBubble=!0}).drag(function(e,a,o,i){var s=this.data("portPos"),d={x:0,y:0};s.x>s.x+e?d.x=s.x+e+(s.x-(s.x+e))/2:d.x=s.x+(s.x+e-s.x)/2,d.y=(s.y>=s.y+a?s.y:s.y+a)+20,this.data("binding").attr({d:"M"+s.x+","+s.y+" Q"+d.x+","+d.y+" "+(s.x+e)+","+(s.y+a)}),clearTimeout(this.data("bindingTimeout"));var p=this.data("hoveredPort");p&&p.select("text").removeClass("hovered error");var u=this.data("hoveredChan");u&&u.select(".bg").removeClass("hovered error");var f=setTimeout(function(){var d=t.getPointInEditor(o,i),p=l.getHoveredPort(d.x,d.y);if(p)this.data("hoveredChan",null),this.data("hoveredPort",p),p.hasClass("required")?p.select("text").addClass("hovered error"):p.select("text").addClass("hovered");else{this.data("hoveredPort",null);var u=l.getHoveredChan(s.x+e,s.y+a);if(u){this.data("hoveredChan",u);var f=u.select(".bg");f.addClass("hovered");var m=l.model.findByPath(u.attr("data-path"));!r.isAlreadyBound(c.findRequiredByID(n.name),m)&&r.isCompatible(m.typeDefinition,c.eContainer())||f.addClass("error")}else this.data("hoveredChan",null)}}.bind(this),100);this.data("bindingTimeout",f)},function(){var e=d.transform().localMatrix,n=t.getAbsoluteBBox(b),a={x:e.e+n.x,y:e.f+n.y+(i-6)/2+3};this.data("portPos",a);var r=l.editor.path("M"+a.x+","+a.y+" "+a.x+","+a.y).attr({fill:"none",stroke:"#C60808",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round",opacity:.7});this.data("binding",r)},function(){clearTimeout(this.data("bindingTimeout"));var t=c.findRequiredByID(n.name);t||(t=a.createPort(),t.name=n.name,t.portTypeRef=n,c.addRequired(t));var i=this.data("hoveredChan");if(i){var s=l.model.findByPath(i.attr("data-path"));if(i.select(".bg").hasClass("error"))s&&!r.isCompatible(s.typeDefinition,c.eContainer())&&o.error({title:"Binding error",message:"<strong>"+s.typeDefinition.name+"</strong> cannot run on platform <strong>"+r.getPlatforms(c.eContainer().typeDefinition).join("")+"</strong>",delay:1e4});else if(s){var d=a.createMBinding();d.hub=s,d.port=t,l.model.addMBindings(d)}i.select(".bg").removeClass("hovered error")}else{var p=this.data("hoveredPort");if(p){if(!p.select("text").hasClass("error")){var u=p.attr("data-name"),f=l.model.findByPath(p.parent().attr("data-path")),m=f.findProvidedByID(u);m||(m=a.createPort(),m.name=u,m.portTypeRef=f.typeDefinition.findProvidedByID(u),f.addProvided(m)),e.open({templateUrl:"app/main/editor/select-chan.modal.html",controller:"SelectChanModalCtrl",resolve:{startPort:t,endPort:m}}).result.then(function(e){if(e){var n=a.createMBinding();n.hub=e,n.port=t,l.model.addMBindings(n);var r=a.createMBinding();r.hub=e,r.port=m,l.model.addMBindings(r)}})}p.select("text").removeClass("hovered error")}}this.data("binding").remove(),this.removeData("binding"),this.removeData("bindingTimeout"),this.removeData("hoveredChan"),this.removeData("hoveredPort"),this.removeData("portPos")}),p=l.editor.text(-6,i-4,n.name.substr(0,6)).attr({fill:"white",textAnchor:"end",title:n.name}).append(Snap.parse("<title>"+n.name+"</title>"));d=l.editor.group().attr({class:"port required","data-name":n.name}).append(s).append(p).transform("t"+(f-k)+","+C),b.append(d),C+=i}),b.selectable(c).draggable().dragStart(function(){var e=document.getElementById("editor-container");this.data("offset",{left:e.offsetLeft,top:e.offsetTop})}).firstDragMove(function(){var e=arguments;this.data("parentNode",c.eContainer()),c.eContainer().removeComponents(c);var t=function(t){t.bindings.array.forEach(function(t){var n=l.editor.select('.binding[data-path="'+t.path()+'"]');n&&n.data("firstDragMove").forEach(function(t){t.apply(n,e)})})};c.provided.array.forEach(t),c.required.array.forEach(t)}).dragMove(function(e,t,n,a){var r=arguments;clearTimeout(this.data("dragTimeout"));var o=this.data("hoveredNode");o&&o.select(".bg").removeClass("hovered error");var i=setTimeout(function(){var e=this.data("offset"),t=l.getHoveredNode(n-e.left,a-e.top,c.path());t?(this.data("hoveredNode",t),t.select(".bg").addClass("hovered")):this.data("hoveredNode",null)}.bind(this),100);this.data("dragTimeout",i);var s=function(e){e.bindings.array.forEach(function(e){var t=l.editor.select('.binding[data-path="'+e.path()+'"]');t&&t.data("endPtDrag").apply(t,r)})};c.provided.array.forEach(s),c.required.array.forEach(s)}).dragEnd(function(){var e=this.data("hoveredNode");e?(e.select(".bg").removeClass("hovered error"),b.remove(),l.model.findByPath(e.attr("data-path")).addComponents(c)):(b.remove(),this.data("parentNode").addComponents(c)),clearTimeout(this.data("dragTimeout")),this.removeData("parentNode"),this.removeData("offset"),this.removeData("hoveredNode"),this.removeData("dragTimeout")});var D=u.selectAll('.instance[data-path="'+c.eContainer().path()+'"] > .instance').items,w=(u.select(".bg").asPX("width")-f)/2,T=s;return D.forEach(function(e){T+=e.select(".bg").asPX("height")+10}),b.transform("t"+w+","+T),u.append(b),l.updateValidity(c),b}}]),angular.module("editorApp").factory("uiCreateChannel",["kModelHelper","uiUtils","util","CHANNEL_RADIUS",function(e,t,n,a){return function(r,o){r.removeUIElem(o.path()),t.updateSVGDefs(r.model);var i=r.editor.circle(0,0,a).attr({fill:"#DB661D",stroke:n.isTruish(o.started)?"#fff":"#000",strokeWidth:2,class:e.isSelected(o)?"bg selected":"bg",opacity:.75,title:o.name+": "+o.typeDefinition.name}),s=r.editor.group().attr({class:"instance chan","data-path":o.path()}).append(i).selectable(o).draggable().dragMove(function(){var e=arguments;o.bindings.array.forEach(function(t){var n=r.editor.select('.binding[data-path="'+t.path()+'"]');n.data("startPtDrag").apply(n,e)})}).dragEnd(function(){var e=arguments;o.bindings.array.forEach(function(t){var n=r.editor.select('.binding[data-path="'+t.path()+'"]');n&&n.data("dragEnd").forEach(function(t){t.apply(n,e)})})}).relocate(o);i.mousemove(function(e,i,l){clearTimeout(this.data("showName"));var c=setTimeout(function(){var e,c,d=t.getPointInEditor(i,l+5),p=r.editor.getBBox().width;d.x>p/2?(c=-(2*a),e="end"):(c=2*a,e="start");var u=s.select(".name");u?u.attr({x:c,textAnchor:e}):s.append(r.editor.text(c,0,o.name+": "+o.typeDefinition.name).attr({fill:n.isTruish(o.started)?"#fff":"#000",textAnchor:e,class:"name"}))},300);this.data("showName",c)}).mouseout(function(){clearTimeout(this.data("showName"));var e=s.select(".name");e&&e.remove()}),r.updateValidity(o)}}]),angular.module("editorApp").factory("uiCreateBinding",["uiUtils","CHANNEL_RADIUS",function(e,t){return function(n,a){if(a.hub&&a.port){var r=n.editor.select('.comp[data-path="'+a.port.eContainer().path()+'"] .port[data-name="'+a.port.name+'"]'),o=n.editor.select('.chan[data-path="'+a.hub.path()+'"]'),i=n.editor.select('.binding[data-path="'+a.path()+'"]');if(r&&o){var s=e.computeBindingCoords(r,o);if(i){i.data("coords",s);var l=i.select(".bg").attr({d:"M"+s.chan.x+","+s.chan.y+" Q"+s.middle.x+","+s.middle.y+" "+s.port.x+","+s.port.y}),c=l.getPointAtLength(t+1);l.attr({d:"M"+c.x+","+c.y+" Q"+s.middle.x+","+s.middle.y+" "+s.port.x+","+s.port.y})}else{var d=n.editor.path("M"+s.chan.x+","+s.chan.y+" Q"+s.middle.x+","+s.middle.y+" "+s.port.x+","+s.port.y).attr({fill:"none",stroke:"provided"===a.port.getRefInParent()?"#ECCA40":"#C60808",strokeWidth:5,strokeLineCap:"round",strokeLineJoin:"round",opacity:.7,class:"bg"}).mouseover(function(){this.attr({opacity:.85,strokeWidth:6})}).mouseout(function(){this.attr({opacity:.7,strokeWidth:5})}),p=d.getPointAtLength(t+1);d.attr({d:"M"+p.x+","+p.y+" Q"+s.middle.x+","+s.middle.y+" "+s.port.x+","+s.port.y}),n.editor.group().attr({class:"binding","data-path":a.path()}).data("coords",s).append(d).selectable().firstDragMove(function(){this.appendTo(n.editor)}).startPtDrag(function(e,n){var a=this.data("coords"),r=a.chan.x+e,o=a.chan.y+n;a.port.x>r?a.middle.x=r+(a.port.x-r)/2:a.middle.x=a.port.x+(r-a.port.x)/2,a.middle.y=(a.port.y>=o?a.port.y:o)+20,d.attr({d:"M"+r+","+o+" Q"+a.middle.x+","+a.middle.y+" "+a.port.x+","+a.port.y});var i=d.getPointAtLength(t+1);d.attr({d:"M"+i.x+","+i.y+" Q"+a.middle.x+","+a.middle.y+" "+a.port.x+","+a.port.y})}).endPtDrag(function(e,n){var a=this.data("coords"),r=a.port.x+e,o=a.port.y+n;r>a.chan.x?a.middle.x=a.chan.x+(r-a.chan.x)/2:a.middle.x=r+(a.chan.x-r)/2,a.middle.y=(o>=a.chan.y?o:a.chan.y)+20,d.attr({d:"M"+a.chan.x+","+a.chan.y+" Q"+a.middle.x+","+a.middle.y+" "+r+","+o});var i=d.getPointAtLength(t+1);d.attr({d:"M"+i.x+","+i.y+" Q"+a.middle.x+","+a.middle.y+" "+r+","+o})}).dragEnd(function(){var t=n.editor.select('.comp[data-path="'+a.port.eContainer().path()+'"] .port[data-name="'+a.port.name+'"]'),r=n.editor.select('.chan[data-path="'+a.hub.path()+'"]');this.data("coords",e.computeBindingCoords(t,r))})}}}}}]),angular.module("editorApp").directive("stringToNumber",function(){return{require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){return e}),a.$formatters.push(function(e){return parseFloat(e)})}}}),function(){function e(e,t,n,a){function r(e){var n;n=e.port&&e.port.length>0?parseInt(e.port):"http:"===e.protocol?80:443,TinyConf.set("registry.host",e.hostname),TinyConf.set("registry.port",n),TinyConf.set("registry.ssl","https:"===e.protocol),v=e,t.set("registry",e.toString())}function o(){return v}function i(){return e.when(KevoreeRegistryClient.namespace.all())}function s(t){return e.when(KevoreeRegistryClient.tdef.getLatestsByNamespace(t)).then(function(e){return e.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),e.map(p)})}function l(t,n){return e.when(KevoreeRegistryClient.tdef.getAllByNamespaceAndName(t,n)).then(function(e){return e.map(p)})}function c(t,n,a){return e.when(KevoreeRegistryClient.du.getReleases(t,n,a)).then(function(e){return e.map(u)})}function d(t,n,a){return e.when(KevoreeRegistryClient.du.getLatests(t,n,a)).then(function(e){return e.map(u)})}function p(e){try{e.model=y.loadModelFromString(e.model).get(0),e.type=f(e.model),e.description=m(e.model)}catch(t){e.error="Unable to parse model",e.type=h(e.model),e.description=g(e.model)}return e}function u(e){try{e.model=y.loadModelFromString(e.model).get(0)}catch(t){e.error="Unable to parse model"}return e}function f(e){return"org.kevoree.NodeType"===e.metaClassName()?"node":"org.kevoree.ComponentType"===e.metaClassName()?"component":"org.kevoree.ChannelType"===e.metaClassName()?"channel":"org.kevoree.GroupType"===e.metaClassName()?"group":void 0}function m(e){var t=e.findMetaDataByID("description");return t?t.value:null}function h(e){return e.class.startsWith("org.kevoree.NodeType")?"node":e.class.startsWith("org.kevoree.ComponentType")?"component":e.class.startsWith("org.kevoree.ChannelType")?"channel":e.class.startsWith("org.kevoree.GroupType")?"group":void 0}function g(e){var t=e.metaData.find(function(e){return"description"===e.name});return t?t.value:null}var v=null,y=n.createJSONLoader(),b=t.get("registry");if(b)try{r(new URL(b))}catch(e){Notification.error({title:"Kevoree Registry",message:"Stored URL in local storage is malformed. You should update it",delay:8e3})}else r(new URL(a));return{getUrl:o,setUrl:r,transformTdef:p,namespace:{all:i},tdef:{getLatestsByNamespace:s,getAllByNamespaceAndName:l},du:{getReleases:c,getLatests:d}}}angular.module("editorApp").factory("kRegistry",e),e.$inject=["$q","storage","kFactory","KEVOREE_REGISTRY_URL"]}(),angular.module("editorApp").directive("loadingOverlay",["kEditor",function(e){return{restrict:"A",scope:!1,link:function(t,n){function a(){n.append(i)}function r(){i.remove()}var o="id_"+Math.floor(1e4*Math.random()+1),i=jQuery("<div>",{id:o,class:"overlay"}).append(jQuery("<p>",{class:"center-message"}).html("Loading model...")),s=e.addPreSetModelHandler(a),l=e.addPostSetModelHandler(r);t.$on("$destroy",function(){s(),l()})}}}]),angular.module("editorApp").factory("kScript",function(){var e=function(){},t={info:function(e,t){console.log("KevScript",t)},debug:function(e,t){console.debug("KevScript",t)},error:function(e,t){console.error("KevScript",t)},warn:function(e,t){console.warn("KevScript",t)},toString:function(){return"KevScript"},setLevel:e,setTag:e};return new KevoreeKevscript(t,{resolver:KevoreeKevscript.Resolvers.tagResolverFactory(t,KevoreeKevscript.Resolvers.modelResolverFactory(t,KevoreeKevscript.Resolvers.registryResolverFactory(t)))})}),angular.module("editorApp").factory("kFactory",function(){return new KevoreeLibrary.factory.DefaultKevoreeFactory}),angular.module("editorApp").directive("instanceName",["kEditor",function(e){return{restrict:"A",require:"ngModel",scope:{instance:"&instance",instanceType:"&instanceType"},link:function(t,n,a,r){r.$parsers.push(function(n){var a,o=e.getModel();switch(t.instanceType()){case"node":a=o.findNodesByID(n);break;case"group":a=o.findGroupsByID(n);break;case"channel":a=o.findHubsByID(n);break;case"component":a=t.instance().eContainer().findComponentsByID(n)}return a?a.path()===t.instance().path()?r.$setValidity("notUniqueName",!0):r.$setValidity("notUniqueName",!1):r.$setValidity("notUniqueName",!0),n})}}}]),angular.module("editorApp").factory("kInstance",["kFactory","kModelHelper",function(e,t){return{initDictionaries:function(n){n.dictionary=n.dictionary||e.createDictionary().withGenerated_KMF_ID("0.0"),n.typeDefinition.dictionaryType&&n.typeDefinition.dictionaryType.attributes.array.forEach(function(a){var r;if(t.isTruish(a.fragmentDependant)){switch(t.getTypeDefinitionType(n.typeDefinition)){case"channel":n.bindings.array.forEach(function(t){if(t.port&&!n.findFragmentDictionaryByID(t.port.eContainer().eContainer().name)){var a=e.createFragmentDictionary();a.name=t.port.eContainer().eContainer().name,n.addFragmentDictionary(a)}});break;case"group":n.subNodes.array.forEach(function(t){if(!n.findFragmentDictionaryByID(t.name)){var a=e.createFragmentDictionary();a.name=t.name,n.addFragmentDictionary(a)}})}n.fragmentDictionary.array.forEach(function(t){r=t.findValuesByID(a.name),r||(r=e.createValue(),r.name=a.name,r.value=a.defaultValue,t.addValues(r))})}else r=n.dictionary.findValuesByID(a.name),r||(r=e.createValue(),r.name=a.name,r.value=a.defaultValue,n.dictionary.addValues(r))})},initFragmentDictionaries:function(n){n.typeDefinition.dictionaryType&&n.typeDefinition.dictionaryType.attributes.array.forEach(function(a){var r;if(t.isTruish(a.fragmentDependant)){switch(t.getTypeDefinitionType(n.typeDefinition)){case"channel":n.bindings.array.forEach(function(t){if(t.port&&!n.findFragmentDictionaryByID(t.port.eContainer().eContainer().name)){var a=e.createFragmentDictionary();a.name=t.port.eContainer().eContainer().name,n.addFragmentDictionary(a)}});break;case"group":n.subNodes.array.forEach(function(t){if(!n.findFragmentDictionaryByID(t.name)){var a=e.createFragmentDictionary();a.name=t.name,n.addFragmentDictionary(a)}})}n.fragmentDictionary.array.forEach(function(t){r=t.findValuesByID(a.name),r||(r=e.createValue(),r.name=a.name,r.value=a.defaultValue,t.addValues(r))})}})}}}]),angular.module("editorApp").factory("kEditor",["$timeout","kFactory","kModelHelper","kInstance","ui","Notification","KWE_POSITION","KWE_FOLDED","KWE_SELECTED","KWE_TAG","CHANNEL_RADIUS","GROUP_RADIUS",function(e,t,n,a,r,o,i,s,l,c,d,p){function u(e){return function(t){function c(e){e.components.array.forEach(function(e){e.provided.array.forEach(function(e){e.bindings.array.forEach(function(e){r.editor&&r.createBinding(e)})}),e.required.array.forEach(function(e){e.bindings.array.forEach(function(e){r.editor&&r.createBinding(e)})})}),e.groups.array.forEach(function(t){r.editor&&r.createGroupWire(t,e)}),e.hosts.array.forEach(c)}var d,p;e.invokeModelUpdateListeners(),"typeDefinitions"!==t.elementAttributeName&&"packages"!==t.elementAttributeName||e.invokeModelUpdateListeners("tdefs");
try{if(t.etype===KevoreeLibrary.modeling.api.util.ActionType.object.REMOVE)"/"===t.previousPath?"hubs"===t.elementAttributeName||"nodes"===t.elementAttributeName||"groups"===t.elementAttributeName?(r.editor&&r.deleteInstance(t.source,t.previous_value),e.invokeModelUpdateListeners("selected")):"mBindings"===t.elementAttributeName&&r.editor&&r.deleteBinding(t.previous_value):"hosts"===t.elementAttributeName||"components"===t.elementAttributeName?(r.editor&&r.deleteInstance(t.source,t.previous_value),e.invokeModelUpdateListeners("selected")):"groups"===t.elementAttributeName?(r.editor&&r.deleteGroupWire(t.previous_value,t.previousPath),d=t.value.findFragmentDictionaryByID(t.source.name),d&&d.delete()):"bindings"===t.elementAttributeName&&"hubs"===t.source.getRefInParent()&&t.source.fragmentDictionary.array.forEach(function(e){for(var n=!1,a=0;a<t.source.bindings.size();a++){var r=t.source.bindings.get(a);if(r.port&&r.port.eContainer().eContainer().name===e.name){n=!0;break}}n||e.delete()});else if(t.etype===KevoreeLibrary.modeling.api.util.ActionType.object.REMOVE_ALL)if("/"===t.previousPath)switch(t.elementAttributeName){case"hubs":r.editor&&r.deleteChannels();break;case"nodes":r.editor&&r.deleteNodes();break;case"groups":r.editor&&r.deleteGroups();break;case"mBindings":r.editor&&r.deleteBindings()}else switch(t.elementAttributeName){case"groups":t.value.array.forEach(function(e){r.editor&&r.deleteGroupWire(e.path(),t.previousPath);var n=e.findFragmentDictionaryByID(t.source.name);n&&n.delete()});break;case"bindings":t.value.array.forEach(function(e){r.editor&&r.deleteBinding(e.path()),e.hub&&e.port||e.delete()})}else if(t.etype===KevoreeLibrary.modeling.api.util.ActionType.object.ADD)if("/"===t.previousPath)switch(t.elementAttributeName){case"hubs":r.editor&&r.createChannel(t.value);break;case"nodes":case"hosts":r.editor&&(r.createNode(t.value),p=n.getHighestNode(t.value),p&&r.refreshNode(p.path()));break;case"groups":r.editor&&r.createGroup(t.value);break;case"mBindings":r.editor&&r.createBinding(t.value)}else switch(t.elementAttributeName){case"groups":r.editor&&r.createGroupWire(t.value,t.source);break;case"components":r.editor&&r.createComponent(t.value),p=n.getHighestNode(t.value),r.editor&&r.refreshNode(p.path()),c(p);break;case"hosts":r.editor&&r.createNode(t.value),t.value.components.array.forEach(function(e){r.editor&&r.createComponent(e)}),t.value.hosts.array.sort(function(e,t){return n.getNodeTreeHeight(t)-n.getNodeTreeHeight(e)}).forEach(function e(t){r.editor&&r.createNode(t),t.components.array.forEach(function(e){r.editor&&r.createComponent(e)}),t.hosts.array.forEach(e)}),p=n.getHighestNode(t.source),r.editor&&r.refreshNode(p.path()),c(p);break;case"subNodes":a.initFragmentDictionaries(t.source),e.invokeModelUpdateListeners("selected");break;case"bindings":e.invokeModelUpdateListeners("selected");break;case"metaData":t.value.name===s&&"nodes"===t.source.getRefInParent()&&r.editor&&r.toggleFold(t.source,n.isTruish(t.value.value))}else if(t.etype===KevoreeLibrary.modeling.api.util.ActionType.object.SET)switch(t.elementAttributeName){case"name":"nodes"===t.source.getRefInParent()&&(t.source.groups.array.forEach(function(e){d=e.findFragmentDictionaryByID(t.previous_value),d&&(d.name=t.source.name)}),t.source.components.array.forEach(function(e){function n(e){e.bindings.array.forEach(function(e){e.hub&&(d=e.hub.findFragmentDictionaryByID(t.previous_value),d&&(d.name=t.source.name))})}e.provided.array.forEach(n),e.required.array.forEach(n)})),r.editor&&r.updateInstance(t.previousPath,t.source);break;case"value":"metaData"===t.source.getRefInParent()&&t.source.name===i?(r.editor&&r.updatePosition(t.source.eContainer()),"nodes"===t.source.eContainer().getRefInParent()?c(t.source.eContainer()):"groups"===t.source.eContainer().getRefInParent()?t.source.eContainer().subNodes.array.forEach(function(e){r.editor&&r.createGroupWire(t.source.eContainer(),e)}):"hubs"===t.source.eContainer().getRefInParent()&&t.source.eContainer().bindings.array.forEach(function(e){r.editor&&r.createBinding(e)})):"metaData"===t.source.getRefInParent()&&t.source.name===s?"nodes"===t.source.eContainer().getRefInParent()&&r.editor&&r.toggleFold(t.source.eContainer(),n.isTruish(t.source.value)):"dictionary"===t.source.eContainer().getRefInParent()?r.editor&&r.updateValidity(t.source.eContainer().eContainer()):"metaData"===t.source.getRefInParent()&&t.source.name===l&&e.invokeModelUpdateListeners("selected");break;case"started":r.editor&&r.updateInstance(t.previousPath,t.source);break;case"typeDefinition":if(null!==t.value)switch(t.source.getRefInParent()){case"components":r.editor&&r.updateCompTypeDefinition(t.source,t.previous_value)}}}catch(e){o.error({title:"Error",message:"Unable to update model"}),console.error(e.stack)}}}function f(){this.model=t.createContainerRoot().withGenerated_KMF_ID(0),t.root(this.model),this.preSetModelHandler=[],this.postSetModelHandler=[],this.modelUpdateListenersEnabled=!0,this.modelUpdateListeners=[],this.newModelListeners=[],this.modelListener={elementChanged:u(this)},r.setModel(this.model)}return f.prototype={getModel:function(){return this.model},setModel:function(n,a){this.preSetModelHandler.forEach(function(e){e()}),setTimeout(function(){var o;try{KevoreeValidator(n),this.model=n,t.root(this.model),this.model.addModelTreeListener(this.modelListener),r.setModel(n),this.invokeNewModelListeners()}catch(e){o=e}finally{o&&(console.error("[editor.factory.setModel()] Error setting model"),console.error(o.stack)),this.postSetModelHandler.forEach(function(e){e()}),a&&e(angular.noop,100).then(function(){a(o)})}}.bind(this),20)},merge:function(e){this.model.removeModelTreeListener(this.modelListener);var n=t.createModelCompare();n.merge(this.model,e).applyOn(this.model),t.root(this.model),this.model.addModelTreeListener(this.modelListener),r.setModel(this.model),this.drawModel()},addPreSetModelHandler:function(e){var t=this.preSetModelHandler.push(e)-1;return function(){this.preSetModelHandler.splice(t,1)}.bind(this)},addPostSetModelHandler:function(e){var t=this.postSetModelHandler.push(e)-1;return function(){this.postSetModelHandler.splice(t,1)}.bind(this)},addNewModelListener:function(e,t){return this.newModelListeners[e]||(this.newModelListeners[e]=[]),this.newModelListeners[e].push(t),function(){this.newModelListeners[e]&&this.newModelListeners[e].splice(this.newModelListeners[e].indexOf(t),1)}.bind(this)},addModelUpdateListener:function(e,t,n){this.modelUpdateListeners[e]||(this.modelUpdateListeners[e]=[]);var a={strict:n,listener:t};return this.modelUpdateListeners[e].push(a),function(){this.modelUpdateListeners[e]&&this.modelUpdateListeners[e].splice(this.modelUpdateListeners[e].indexOf(a),1)}.bind(this)},invokeModelUpdateListeners:function(e){this.modelUpdateListenersEnabled&&Object.keys(this.modelUpdateListeners).forEach(function(t){this.modelUpdateListeners[t].forEach(function(n){n.strict?t===e&&n.listener():n.listener()})}.bind(this))},invokeNewModelListeners:function(){Object.keys(this.newModelListeners).forEach(function(e){this.newModelListeners[e].forEach(function(e){e()})}.bind(this))},disableModelUpdateListeners:function(){this.modelUpdateListenersEnabled=!1},enableModelUpdateListeners:function(){this.modelUpdateListenersEnabled=!0},removeAllListeners:function(){var e;for(e in this.modelUpdateListeners)delete this.modelUpdateListeners[e];for(e in this.newModelListeners)delete this.newModelListeners[e]},removeModelUpdateListeners:function(e){delete this.modelUpdateListeners[e]},removeNewModelListeners:function(e){delete this.newModelListeners[e]},fixOverlapping:function(){function e(e,n){var a=e.findMetaDataByID(i);a?a.value=JSON.stringify(n):(a=t.createValue(),a.name=i,a.value=JSON.stringify(n),e.addMetaData(a))}var a=p+20;this.model.groups.array.forEach(function(t){e(t,{x:a,y:p+20}),a+=2*p+20});var r=d+20;this.model.hubs.array.forEach(function(t){e(t,{x:r,y:180}),r+=2*d+20});var o=25;this.model.nodes.array.forEach(function(t){if(!t.host){var a=n.getNodeTreeHeight(t);e(t,{x:o,y:220}),o+=230+20*a}})},drawModel:function(){r.editor&&(this.model.hubs.array.forEach(function(e){r.createChannel(e)}),this.model.nodes.array.sort(function(e,t){return n.getNodeTreeHeight(t)-n.getNodeTreeHeight(e)}).forEach(function(e){r.createNode(e),e.components.array.forEach(function(e){r.createComponent(e)})}),this.model.groups.array.forEach(function(e){r.createGroup(e),e.subNodes.array.forEach(function(t){r.createGroupWire(e,t)})}),this.model.mBindings.array.forEach(function(e){r.createBinding(e)}),r.order(),this.model.select("**/metaData[name="+s+"]").array.forEach(function(e){r.toggleFold(e.eContainer(),n.isFolded(e.eContainer()))}))},modelHasErrors:function(){return!1}},new f}]),function(){function e(){function e(e){return"true"===e||e===!0||e>0}var t=this;if(t.readOnly=!1,t.isTruish=e,t.dictionary&&t.dictionary.eContainer()){var n=t.dictionary.eContainer().findMetaDataByID("access_mode");t.readOnly=n&&"read-only"===n.value}}angular.module("editorApp").component("dictionary",{templateUrl:"app/components/dictionary/dictionary.html",bindings:{name:"@",attrs:"<",dictionary:"<",fragment:"<"},controller:e})}(),function(){function e(e){function t(e){var t;if(e.platform)t="js"===e.platform?"javascript":e.platform;else if(e.findFiltersByID){var n=e.findFiltersByID("platform").value;t="js"===n?"javascript":n}return t}var n=this;n.baseUrl=e.getUrl(),n.platform=t}angular.module("editorApp").component("dusList",{templateUrl:"app/components/deploy-unit/dus-list.html",bindings:{dus:"<"},controller:e}),e.$inject=["kRegistry"]}(),angular.module("editorApp").run(function(){CodeMirror.defineMode("kevscript",function(){var e={start:[{regex:/\/\/.*/,token:"comment"},{regex:/add/,token:"statement",push:"addStmt",process:function(e){e.stmt="add",e.instancePath=[]}},{regex:/set/,token:"statement",push:"setStmt",process:function(e){e.stmt="set",e.instancePath=[]}},{regex:/attach/,token:"statement",push:"attachStmt",process:function(e){e.stmt="attach",e.instancePath=[]}},{regex:/detach/,token:"statement",push:"detachStmt",process:function(e){e.stmt="detach",e.instancePath=[]}},{regex:/move/,token:"statement",push:"moveStmt",process:function(e){e.stmt="move",e.instancePath=[]}},{regex:/start/,token:"statement",push:"startStmt",process:function(e){e.stmt="start",e.instancePath=[]}},{regex:/stop/,token:"statement",push:"stopStmt",process:function(e){e.stmt="stop",e.instancePath=[]}},{regex:/pause/,token:"statement",push:"pauseStmt",process:function(e){e.stmt="pause",e.instancePath=[]}},{regex:/remove/,token:"statement",push:"removeStmt",process:function(e){e.stmt="remove",e.instancePath=[]}},{regex:/bind/,token:"statement",push:"bindStmt",process:function(e){e.stmt="bind",e.instancePath=[]}},{regex:/unbind/,token:"statement",push:"unbindStmt",process:function(e){e.stmt="unbind",e.instancePath=[]}},{regex:/repo/,token:"statement",push:"repoStmt",process:function(e){e.stmt="repo",e.instancePath=[]}},{regex:/include/,token:"statement",push:"includeStmt",process:function(e){e.stmt="include",e.instancePath=[]}},{regex:/network/,token:"statement",push:"networkStmt",process:function(e){e.stmt="network",e.instancePath=[]}},{regex:/[a-z]+/}],addStmt:[{regex:/,/,token:"delimiter"},{regex:/:/,token:"delimiter",next:"typedef"},{regex:/(?=[a-zA-Z0-9%*_-])/,push:"instancepath",process:function(e){e.instancePath=[]}}],setStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,push:"instancepath",process:function(e){e.instancePath=[]}},{regex:/=/,token:"delimiter",next:"value"}],repoStmt:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string",pop:!0},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string",pop:!0}],includeStmt:[{regex:/([a-zA-Z0-9_-]+)(:)([a-zA-Z0-9.:%@_-]+$)/,token:["version","delimiter","network"],pop:!0}],networkStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"network"}],attachStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"namelistInstancepath"}],detachStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"namelistInstancepath"}],moveStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"namelistInstancepath"}],removeStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"namelist"}],startStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"namelist"}],stopStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"namelist"}],pauseStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"namelist"}],bindStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"instancepathInstancepath",process:function(e){e.instancePath=[]}}],unbindStmt:[{regex:/(?=[a-zA-Z0-9%*_-])/,next:"instancepathInstancepath",process:function(e){e.instancePath=[]}}],typedef:[{regex:/([A-Z][a-zA-Z0-9]*)([\/])/,token:["typedef","delimiter"],next:"tdefversion",process:function(e,t){e.typedef=t[1]}},{regex:/[A-Z][a-zA-Z0-9]*/,token:"typedef",pop:!0},{regex:/[a-z0-9]+/,token:"namespace",process:function(e,t){e.namespace=t[0]}},{regex:/\./,token:"delimiter"}],tdefversion:[{regex:/(LATEST)([\/])/,token:["constant","delimiter"],next:"duversion"},{regex:/([0-9]+)([\/])/,token:["version","delimiter"],next:"duversion",process:function(e,t){e.version=t[1]}},{regex:/(%)([a-zA-Z0-9_-]+)(%)([\/])/,token:["ctxvarbracket","ctxvar","ctxvarbracket","delimiter"],next:"duversion"},{regex:/(%%)([a-zA-Z0-9_-]+)(%%)([\/])/,token:["ctxvarbracket","ctxvar","ctxvarbracket","delimiter"],next:"duversion"},{regex:/LATEST/,token:"constant",pop:!0},{regex:/[0-9]+/,token:"version",pop:!0},{regex:/(%)([a-zA-Z0-9_-]+)(%)/,token:["ctxvarbracket","ctxvar","ctxvarbracket"],pop:!0},{regex:/(%%)([a-zA-Z0-9_-]+)(%%)/,token:["ctxvarbracket","ctxvar","ctxvarbracket"],pop:!0},{regex:/[A-Z]+/}],duversion:[{regex:/LATEST|RELEASE/,token:"constant",pop:!0},{regex:/%%/,token:"ctxvarbracket",next:"genctxvar"},{regex:/%/,token:"ctxvarbracket",next:"ctxvar"},{regex:/{/,token:"bracket",next:"versionDecl"},{regex:/[A-Z]+/}],versionDecl:[{regex:/}/,token:"bracket",pop:!0},{regex:/[a-zA-Z0-9_-]+/,token:"platform"},{regex:/LATEST|RELEASE/,token:"constant",pop:!0},{regex:/%%/,token:"ctxvarbracket",next:"genctxvar"},{regex:/%/,token:"ctxvarbracket",next:"ctxvar"},{regex:/'[^']*'/,token:"string"},{regex:/"[^"]*"/,token:"string"}],version:[{regex:/[\/]/,token:"delimiter"},{regex:/%%/,token:"ctxvarbracket",push:"genctxvar",pop:!0},{regex:/%/,token:"ctxvarbracket",push:"ctxvar",pop:!0},{regex:/[0-9]+/,token:"version",pop:!0},{regex:/LATEST|RELEASE/,token:"constant",pop:!0}],value:[{regex:/'/,token:"string",next:"singlequote"},{regex:/"/,token:"string",next:"doublequote"},{regex:/%%/,token:"ctxvarbracket",next:"genctxvar"},{regex:/%/,token:"ctxvarbracket",next:"ctxvar"}],ctxvar:[{regex:/%/,token:"ctxvarbracket",pop:!0},{regex:/[a-zA-Z0-9_-]+/,token:"ctxvar"}],genctxvar:[{regex:/%%/,token:"ctxvarbracket",pop:!0},{regex:/[a-zA-Z0-9_-]+/,token:"ctxvar"}],singlequote:[{regex:/\\./,token:"escaped"},{regex:/'/,token:"string",pop:!0},{regex:/[^\\']*/,token:"string"}],doublequote:[{regex:/\\./,token:"escaped"},{regex:/"/,token:"string",pop:!0},{regex:/[^\\"]*/,token:"string"}],namelist:[{regex:/,/,token:"delimiter"},{regex:/(?=[a-zA-Z0-9%*_-]*[ \t\n]*,)/,push:"instancepath",process:function(e){e.instancePath=[]}},{regex:/(?=[a-zA-Z0-9%*_-])/,next:"instancepath",process:function(e){e.instancePath=[]}}],namelistInstancepath:[{regex:/,/,token:"delimiter"},{regex:/(?=[a-zA-Z0-9%*_-]*[ \t\n]*,)/,push:"instancepath",process:function(e){e.instancePath=[]}},{regex:/(?=[a-zA-Z0-9%*_-])/,next:"instancepathInstancepath",process:function(e){e.instancePath=[]}}],instancepathInstancepath:[{regex:/[ \t\n]+/,next:"instancepath",process:function(e){e.instancePath=[]}},{regex:/(?=[^ \t\n])/,push:"instancepath",process:function(e){e.instancePath=[]}}],instancepath:[{regex:/([*])([.\/])/,token:["wildcard","delimiter"]},{regex:/(%%)(?=[^ ]*%%[.\/])/,token:"ctxvarbracket",push:"genctxvar"},{regex:/(%)(?=[^ ]*%[.\/])/,token:"ctxvarbracket",push:"ctxvar"},{regex:/([a-zA-Z0-9_-]+)([.\/])/,token:["identifier","delimiter"],process:function(e,t){e.instancePath.push(t[1])}},{regex:/%%/,token:"ctxvarbracket",next:"genctxvar"},{regex:/%/,token:"ctxvarbracket",next:"ctxvar"},{regex:/[*]/,token:"wildcard",pop:!0},{regex:/[a-zA-Z0-9_-]+/,token:"identifier",process:function(e,t){e.instancePath.push(t[0])},pop:!0}],network:[{regex:/[ \t\n]+/,next:"networkVal"},{regex:/(?=[a-zA-Z0-9%*_-])/,push:"instancepath",process:function(e){e.instancePath=[]}}],networkVal:[{regex:/%/,token:"ctxvarbracket",next:"ctxvar"},{regex:/[a-zA-Z0-9.:%@_-]+/,token:"network",pop:!0}],meta:{lineComment:"//"}};return{startState:function(){return{state:"start",stack:[]}},token:function(t,n){if(n.pending){var a=n.pending.shift();return 0===n.pending.length&&(n.pending=null),t.pos+=a.text.length,a.token}var r=e[n.state];if(r)for(var o=0;o<r.length;o++){var i=r[o];if(i){var s=t.match(i.regex);if(s){if(i.next)n.state=i.next;else if(i.pop&&n.stack.length>0){var l=n.stack.pop();n.state=l.state,"function"==typeof l.onPop&&l.onPop(n)}else i.push&&(n.stack.push({state:n.state,onPop:i.onPop}),n.state=i.push);if("function"==typeof i.process&&i.process(n,s),i.token){if(s.length>2){n.pending=[];for(var c=2;c<s.length;c++)s[c]&&n.pending.push({text:s[c],token:i.token[c-1]});return t.backUp(s[0].length-(s[1]?s[1].length:0)),i.token[0]}return"function"==typeof i.token.join?i.token.join(" "):i.token}return null}}}return t.next(),null},copyState:function(e){var t={stmt:e.stmt,state:e.state,stack:e.stack.slice()};return e.pending&&(t.pending=e.pending.slice()),e.instancePath&&(t.instancePath=e.instancePath.slice()),e.namespace&&(t.namespace=e.namespace),e.typedef&&(t.typedef=e.typedef),t}}})}),angular.module("editorApp").run(["kScript","kEditor",function(e,t){function n(e,t){for(var n=-1,a=0;a<t.length;a++)if(e[0]>=t[a].start&&e[1]<=t[a].end){n=t[a].line;break}return n}function a(e,t){for(var n=0,a=0;a<t.length;a++){var r=n+(t[a].end-t[a].start)+1;if(r>e)return e-n;n=r}return e-n}var r=["repoToken","includeToken","addToken","removeToken","moveToken","setToken","attachToken","detachToken","networkToken","bindToken","unbindToken","namespaceToken","startToken","stopToken","pauseToken","comment"];CodeMirror.registerHelper("lint","kevscript",function(o){return function(i,s,l,c){CodeMirror.signal(c,"lintStart");var d=0,p=i.split("\n").map(function(e,t){var n={start:d,end:d+e.length,line:t};return d+=e.length+1,n});e.parse(i,t.getModel(),o,function(e,t,o){var i,d=[];if(e)if(e.nt){var u="Unable to match '"+e.nt+"'";"ws"===e.nt?u="Unable to match 'whitespace'":"kevScript"===e.nt?u="A line must start with a statement (add, attach, set, etc.)":r.indexOf(e.nt)>=0&&(u="Expected statement or comment (do you mean '"+e.nt.split("Token").shift()+"'?)"),d.push({severity:"error",message:u,from:CodeMirror.Pos(e.line-1,0===e.col?0:e.col-1),to:CodeMirror.Pos(e.line-1,0===e.col?1:e.col)})}else if(e.pos){var f=n(e.pos,p);d.push({severity:"error",message:e.message,from:CodeMirror.Pos(f,a(e.pos[0],p)),to:CodeMirror.Pos(f,a(e.pos[1],p))})}else i=e;else l.lintedModel=t;o.forEach(function(e){var t=n(e.pos,p);d.push({severity:"warning",message:e.message,from:CodeMirror.Pos(t,a(e.pos[0],p)),to:CodeMirror.Pos(t,a(e.pos[1],p))})}),CodeMirror.signal(c,"lintDone",i,d,t),s(c,d)})}})}]),angular.module("editorApp").run(["kModelHelper",function(e){CodeMirror.registerHelper("hint","kevscript",function(t,n){function a(){return t.options.lint.lintedModel}function r(){return a().nodes.array.concat(a().groups.array).concat(a().hubs.array)}function o(e){return r().find(function(t){return t.name===e})}function i(e){return e.class.startsWith("org.kevoree.ComponentType")?"component":e.class.startsWith("org.kevoree.ChannelType")?"channel":e.class.startsWith("org.kevoree.GroupType")?"group":e.class.startsWith("org.kevoree.NodeType")?"node":"tdef"}function s(){t.doc.replaceSelection(" ")}var l,c=document.querySelector("#kevscript-hint-popup").innerHTML,d=t.getCursor(),p=t.getTokenAt(d),u=p.string,f=p.start,m=p.end,h=[];if("typedef"===p.type||"typedef"===p.state.state){if("namespace"===p.type)return l=u,u=l.trim(),f+=l.length-u.length,KevoreeRegistryClient.namespace.all().then(function(e){n({list:e.filter(function(e){return 0===u.trim().length||e.name.startsWith(u)}).sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(e){return{type:"namespace",typeText:"n",text:e.name,bufferText:e.name+"."}}).map(function(e){return{text:e.bufferText,className:"cm-kevs-hint-elem",render:function(t){t=jQuery(t);var n=Mustache.render(c,e),a=jQuery(n);t.append(a)}}}),from:CodeMirror.Pos(d.line,f),to:CodeMirror.Pos(d.line,m)})});f="."===u?p.end:p.start;var g="."===u?p.state.namespace:"kevoree";return KevoreeRegistryClient.tdef.getLatestsByNamespace(g).then(function(e){n({list:e.filter(function(e){return"."===u||0===u.trim().length||e.name.startsWith(u)}).sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(e){var t=JSON.parse(e.model),n=i(t);return{type:n,typeText:n.substr(0,1),text:e.name,bufferText:e.name,desc:"latest version: "+e.version,from:CodeMirror.Pos(d.line,f)}}).map(function(e){return{text:e.bufferText,className:"cm-kevs-hint-elem",render:function(t){t=jQuery(t);var n=Mustache.render(c,e),a=jQuery(n);t.append(a)},from:e.from,to:e.to}}),from:CodeMirror.Pos(d.line,p.end),to:CodeMirror.Pos(d.line,p.end)})})}switch(p.state.state){case"start":"identifier"===p.type?"attach"===p.state.stmt||"detach"===p.state.stmt?h=a().groups.array.map(function(e){return{type:"group",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version}}).filter(function(e){return 0===u.length||e.text.startsWith(u)}):"bind"!==p.state.stmt&&"unbind"!==p.state.stmt||(h=a().hubs.array.map(function(e){return{type:"channel",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version}}).filter(function(e){return 0===u.length||e.text.startsWith(u)})):(l=u,u=l.trim(),f+=l.length-u.length,h=[{text:"add",desc:"create an instance"},{text:"remove",desc:"remove an instance"},{text:"set",desc:"change a param value"},{text:"bind",desc:"connect a port to a chan"},{text:"unbind",desc:"disconnect a port from a chan"},{text:"attach",desc:"connect a node to a group"},{text:"detach",desc:"disconnect a node from a group"},{text:"network",desc:"define a node network value"},{text:"start",desc:"start an instance"},{text:"stop",desc:"stop an instance"},{text:"move",desc:"move an instance to another node"}].map(function(e){return e.type="stmt",e.bufferText=e.text+" ",e}).filter(function(e){return 0===u.length||e.text.startsWith(u)}).sort(function(e,t){return e.text.localeCompare(t.text)}));break;case"addStmt":case"bindStmt":case"unbindStmt":"add"===u||"set"===u||"bind"===u||"unbind"===u?s():(l=u,u=l.trim(),f+=l.length-u.length,h=a().nodes.array.map(function(e){return{type:"node",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version,bufferText:e.name+"."}}),u.length>0&&(h=h.filter(function(e){return e.text.startsWith(u)})));break;case"setStmt":"set"===u?s():3===p.state.instancePath.length?h=a().nodes.array.map(function(e){return{type:"node",text:e.name,bufferText:e.name+" = ''",desc:e.typeDefinition.name+"/"+e.typeDefinition.version}}).filter(function(e){return e.text.startsWith(u)}):2===p.state.instancePath.length?(l=o(p.state.instancePath[0]),l&&(h=l.typeDefinition.dictionaryType.attributes.array.map(function(e){return{type:"attr",text:e.name+(e.fragmentDependant?"/<node>":""),bufferText:e.fragmentDependant?e.name+"/":e.name,desc:(e.optional?"optional ":"")+'"'+e.datatype.toString().toLowerCase()+'"'}}),"org.kevoree.ContainerNode"===l.metaClassName()&&(h=h.concat(l.components.array.map(function(e){return{type:"component",text:e.name,bufferText:e.name+".",desc:e.typeDefinition.name+"/"+e.typeDefinition.version}}))),h=h.filter(function(e){return e.text.startsWith(u)}))):(l=u,u=l.trim(),f+=l.length-u.length,h=r().map(function(t){return{type:e.getTypeDefinitionType(t.typeDefinition),text:t.name,desc:t.typeDefinition.name+"/"+t.typeDefinition.version,bufferText:t.name+"."}}),u.length>0&&(h=h.filter(function(e){return e.text.startsWith(u)})));break;case"attachStmt":case"detachStmt":"attach"===u||"detach"===u?s():(l=u,u=l.trim(),f+=l.length-u.length,h=a().nodes.array.map(function(e){return{type:"node",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version}}),u.length>0&&(h=h.filter(function(e){return e.text.startsWith(u)})));break;case"network":"network"===u?s():(l=u,u=l.trim(),f+=l.length-u.length,h=a().nodes.array.map(function(e){return{type:"node",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version,bufferText:e.name+"."}}),u.length>0&&(h=h.filter(function(e){return e.text.startsWith(u)})));break;case"networkStmt":u="",f+=1,h=a().nodes.array.map(function(e){return{type:"node",text:e.name,bufferText:e.name+".",desc:e.typeDefinition.name+"/"+e.typeDefinition.version}});break;case"tdefversion":"/"===u&&(u="",f=p.end,m+=1),h=[{type:"version",text:"LATEST",desc:"the latest available version"}].concat(a().select("packages["+(p.state.namespace||"kevoree")+"]/typeDefinitions[name="+p.state.typedef+"]").array.map(function(e){return{type:"version",text:e.version,desc:e.eContainer().name+"."+e.name}})),u.length>0&&(h=h.filter(function(e){return e.text.startsWith(u)}));break;case"duversion":return"/"===u&&(u="",f=p.end,m+=1),KevoreeRegistryClient.du.getLatests(p.state.namespace||"kevoree",p.state.typedef,p.state.version).then(function(e){return e.length>0?[{type:"version",bufferText:"{"+e.map(function(e,t,n){var a=" "+e.platform+": '"+e.version+"'";return t<n-1&&(a+=" "),a}).join(", ")+"}",text:e.map(function(e,t,n){var a=e.platform+"="+e.version;return t<n-1&&(a+=" "),a}).join(", "),desc:"current latest deploy units"}]:[]}).catch(function(){return[]}).then(function(e){return KevoreeRegistryClient.du.getReleases(p.state.namespace||"kevoree",p.state.typedef,p.state.version).then(function(t){return t.length>0?e.concat([{type:"version",bufferText:"{"+t.map(function(e,t,n){var a=" "+e.platform+": '"+e.version+"'";return t<n-1&&(a+=" "),a}).join(", ")+"}",text:t.map(function(e,t,n){var a=e.platform+"="+e.version;return t<n-1&&(a+=" "),a}).join(", "),desc:"current latest deploy units (stable)"}]):e}).catch(function(){return e})}).then(function(e){return e.concat([{type:"version",text:"LATEST",desc:"always get latest deploy units"},{type:"version",text:"RELEASE",desc:"always get latest deploy units (stable)"}])}).then(function(e){n({list:e.filter(function(e){return e.text.startsWith(u)}).map(function(e){return e.typeText=e.type.substr(0,1),{text:e.bufferText,className:"cm-kevs-hint-elem",render:function(t){t=jQuery(t);var n=Mustache.render(c,e),a=jQuery(n);t.append(a)}}}),from:CodeMirror.Pos(d.line,f),to:CodeMirror.Pos(d.line,m)})});case"instancepath":case"instancepathInstancepath":case"namelistInstancepath":if("set"===p.state.stmt){var v=o(p.state.instancePath[0]);v&&(1===p.state.instancePath.length?(h=v.typeDefinition.dictionaryType.attributes.array.map(function(e){return{type:"attr",text:e.name+(e.fragmentDependant?"/<node>":""),bufferText:e.name+(e.fragmentDependant?"/":" = ''"),desc:(e.optional?"optional ":"")+'"'+e.datatype.toString().toLowerCase()+'"',from:CodeMirror.Pos(d.line,p.end)}}),v.components&&(h=h.concat(v.components.array.map(function(e){return{type:"component",text:e.name,bufferText:e.name+".",desc:e.typeDefinition.name+"/"+e.typeDefinition.version,from:CodeMirror.Pos(d.line,p.end)}})))):2===p.state.instancePath.length&&("delimiter"===p.type&&"/"===p.string&&(u="",f+=1,v.subNodes&&(h=v.subNodes.array.map(function(e){return{type:"node",text:e.name,bufferText:e.name+" = ''",desc:e.typeDefinition.name+"/"+e.typeDefinition.version}}))),v.components&&(l=v.findComponentsByID(p.state.instancePath[1]),l&&(h=l.typeDefinition.dictionaryType.attributes.array.map(function(e){return{type:"attr",text:e.name,bufferText:e.name+" = ''",desc:(e.optional?"optional ":"")+'"'+e.datatype.toString().toLowerCase()+'"',from:CodeMirror.Pos(d.line,p.end)}})))))}else if("bind"===p.state.stmt||"unbind"===p.state.stmt){if(0===p.state.instancePath.length)h=a().hubs.array.map(function(e){return{type:"channel",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version,from:CodeMirror.Pos(d.line,p.end)}});else if(1===p.state.instancePath.length)"delimiter"===p.type&&"."===p.string?(l=a().findNodesByID(p.state.instancePath[0]),l&&(h=l.components.array.map(function(e){return{type:"component",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version,bufferText:e.name+".",from:CodeMirror.Pos(d.line,p.end)}}))):(h=a().nodes.array.map(function(e){return{type:"node",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version,bufferText:e.name+"."}}),u.length>0&&(h=h.filter(function(e){return e.text.startsWith(u)})));else if(2===p.state.instancePath.length&&"delimiter"===p.type&&"."===p.string&&(l=a().findNodesByID(p.state.instancePath[0]))){var y=l.findComponentsByID(p.state.instancePath[1]);y&&(h=y.typeDefinition.provided.array.map(function(e){return{type:"input",text:e.name,from:CodeMirror.Pos(d.line,p.end)}}).concat(y.typeDefinition.required.array.map(function(e){return{type:"output",text:e.name,from:CodeMirror.Pos(d.line,p.end)}})))}}else"attach"!==p.state.stmt&&"detach"!==p.state.stmt||(0===p.state.instancePath.length&&"wildcard"!==p.type?h=a().groups.array.map(function(e){return{type:"group",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version,from:CodeMirror.Pos(d.line,p.end)}}):1===p.state.instancePath.length&&("delimiter"===p.type&&"."===p.string?(l=a().findNodesByID(p.state.instancePath[0]),l&&(h=l.components.array.map(function(e){return{type:"component",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version,bufferText:e.name+".",from:CodeMirror.Pos(d.line,p.end)}}))):(" "===u&&(u="",f+=1),h=a().nodes.array.map(function(e){return{type:"node",text:e.name,desc:e.typeDefinition.name+"/"+e.typeDefinition.version}}),u.length>0&&(h=h.filter(function(e){return e.text.startsWith(u)})))));break;default:h=[]}return n({list:h.map(function(e){return e.bufferText=e.bufferText||e.text,e.typeText=function(){return e.type.substr(0,1)},e}).map(function(e){return{text:e.bufferText,className:"cm-kevs-hint-elem",render:function(t){t=jQuery(t);var n=Mustache.render(c,e),a=jQuery(n);t.append(a)},from:e.from,to:e.to}}),from:CodeMirror.Pos(d.line,f),to:CodeMirror.Pos(d.line,m)})})}]),angular.module("editorApp").constant("VERSION","5.14.2").constant("APP_NAME","Kevoree Web Editor").constant("KWE_POSITION","kwe_position").constant("KWE_FOLDED","kwe_folded").constant("KWE_TAG","kwe_tag").constant("KWE_SELECTED","kwe_selected").constant("KEVOREE_REGISTRY_URL","https://registry.kevoree.org"),angular.module("editorApp").config(["$stateProvider","$urlRouterProvider","hotkeysProvider","hljsServiceProvider","NotificationProvider",function(e,t,n,a,r){t.otherwise("/"),e.state("app",{abstract:!0,url:"?host&port&path",views:{"navbar@":{templateUrl:"app/navbar/navbar.html",controller:"NavBarCtrl",controllerAs:"vm"}}}),n.template='<div class="editor-shortcuts" ng-include src="\'app/components/util/hotkeys.html\'" ng-if="helpVisible"></div>',a.setOptions({tabReplace:"  "}),r.setOptions({startTop:90,replaceMessage:!0,delay:5e3}),TinyConf.set("cache",{root:"kevs-cache-",ttl:864e5})}]),function(){angular.module("editorApp").run(["$templateCache",function(e){e.put("app/kevscript/kevscript.html",'<div class="menubar"><div class="menu-btn" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle>File&nbsp;<span class="caret"></span></button><ul class="dropdown-menu" uib-dropdown-menu role="menu"><li><a ng-click="open($event)"><span class="name">Open</span> <span class="shortcut">Ctrl+O</span></a></li><li class="divider"></li><li><a ng-click="save($event)"><span class="name">Save</span> <span class="shortcut">Ctrl+S</span></a></li></ul></div><div class="menu-btn"><button type="button" class="btn btn-default" ng-click="toggleShortcutHelp()">Help</button></div></div><div class="kevs-container"><div class="col-md-3 clearfix"><div class="col-xs-12 well"><fieldset><legend class="legend-sm">Context variables</legend><table class="table table-condensed table-striped no-margin well well-sm"><thead><tr><th class="col-xs-1"><a href ng-click="clearCtxVars()" title="Clear values" ng-if="keys(ctxVars).length > 0"><i class="fa fa-trash-o"></i></a></th><th class="col-xs-5">Key</th><th class="col-xs-6">Value</th></tr></thead><tbody><tr ng-repeat="(key, value) in ctxVars"><th><a href ng-click="removeCtxVar(key)" title="Remove \'{{ key }}\'"><i class="fa fa-trash"></i></a></th><td><code>{{ key }}</code></td><td><code>{{ value }}</code></td></tr><tr><th style="vertical-align: middle"><a href ng-click="addCtxVar(newVal)" title="Add"><i class="fa fa-plus"></i></a></th><td><input type="text" class="form-control input-xs" ng-model="newVal.key" placeholder="key" ui-keypress="{13: \'addCtxVar(newVal)\'}"></td><td><input type="text" class="form-control input-xs" ng-model="newVal.value" placeholder="value" ui-keypress="{13: \'addCtxVar(newVal)\'}"></td></tr></tbody></table></fieldset></div></div><div class="col-md-9 fit-y"><div class="kevscript-editor-container well fit-y"><fieldset class="fit-y"><legend><span>KevScript</span> <button class="btn btn-sm btn-default pull-right" ng-click="model2kevs()">Convert current model to KevScript</button></legend><div class="kevscript-editor" ui-codemirror="{onLoad: editorLoaded}" ui-codemirror-opts="editorOptions" ng-model="kevscript"></div><div class="kevscript-editor-buttons"><button class="btn btn-default" ng-click="merge()" ng-disabled="!isMergeable()">{{ processing ? \'Merging\' : \'Merge\' }}</button></div><div class="kevscript-editor-logs"><div ng-switch="editorState"><div class="text-muted" ng-switch-when="typing"><i class="fa fa-keyboard-o"></i> Typing...</div><div class="text-muted" ng-switch-when="linting"><i class="fa fa-hourglass-half"></i> Linting...</div><div ng-switch-when="idle"><div class="text-success" ng-if="!error"><i class="fa fa-check"></i> No errors</div><div class="text-danger" ng-if="error"><i class="fa fa-times"></i> <strong>Error</strong>: {{ error.message }}</div><div class="text-success" ng-if="lintWarnings.length === 0"><i class="fa fa-check"></i> No warnings</div><div class="text-warning" ng-if="lintWarnings.length > 0"><i class="fa fa-warning"></i> {{ lintWarnings.length + \' warning\' + (lintWarnings.length > 1 ? \'s\':\'\') }}</div></div></div></div></fieldset></div></div></div><input id="kevscript-upload" type="file" class="hide" ng-model="kevscriptFile" on-data="onFileLoaded($name, $data)"><script type="text/x-mustache-template" id="kevscript-hint-popup"><div class="hint-primary">\n\t\t<div class="hint-anchor {{type}}">{{typeText}}</div>\n\t\t<div class="hint-text">{{text}}</div>\n\t</div>\n\t{{#desc}}\n\t<div class="hint-secondary">\n\t\t{{desc}}\n\t</div>\n\t{{/desc}}</script>'),
e.put("app/libraries/dus-installer.html",'<div class="panel panel-kevoree" ng-disabled="$ctrl.disabled"><div class="panel-heading"><span>{{ $ctrl.tag }} DeployUnits</span> <button class="btn btn-sm btn-default pull-right" ng-click="$ctrl.addToModel()" ng-disabled="$ctrl.disabled || !$ctrl.dus || $ctrl.dus.length === 0">Add to model</button></div><div class="panel-body breath-all-sm" ng-if="$ctrl.disabled && !$ctrl.dus"><em>Loading...</em></div><div class="panel-body breath-all-sm" ng-if="!$ctrl.disabled && !$ctrl.dus"><em>You must select a TypeDefinition</em></div><div class="panel-body breath-all-sm" ng-if="$ctrl.dus.length === 0"><em>No DeployUnit found</em></div><dus-list dus="$ctrl.dus"></div>'),e.put("app/libraries/dus.modal.html",'<div class="modal-header"><button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button><h4 class="modal-title" translate="entity.delete.title">Confirm DeployUnits replacement</h4></div><div class="modal-body"><p>TypeDefinition <strong>{{ vm.tdef.namespace + \'.\' + vm.tdef.name + \'/\' + vm.tdef.version }}</strong> already has DeployUnits in the current model:</p><div class="alert alert-warning m-breath-bottom-sm"><dus-list dus="vm.currentDus"></div><p>Do you want to replace them with the following DeployUnits:</p><div class="alert alert-info no-margin"><dus-list dus="vm.dus"></div></div><div class="modal-footer"><button class="btn btn-default" ng-click="$dismiss()"><span class="glyphicon glyphicon-ban-circle"></span> <span>&nbsp;</span> <span>Cancel</span></button> <button class="btn btn-info" ng-click="$close()"><span class="glyphicon glyphicon-ok"></span> <span>&nbsp;</span> <span>Replace</span></button></div>'),e.put("app/libraries/klist.html",'<div class="klist panel panel-kevoree" ng-disabled="$ctrl.disabled"><div class="panel-heading"><span>{{ $ctrl.title }}</span> <span class="pull-right"><span ng-if="$ctrl.filter">{{ filteredElems.length + \'/\' + $ctrl.elems.length || \'-\' }}</span> <span ng-if="!$ctrl.filter">{{ $ctrl.elems.length || \'-\' }}</span></span></div><div class="panel-body" ng-if="$ctrl.elems.length === 0"><em>No {{ $ctrl.title }} available</em></div><div class="panel-body breath-all-sm" ng-if="$ctrl.elems.length > 0"><input type="text" class="form-control input-sm" ng-model="$ctrl.filter" placeholder="{{ $ctrl.placeholder || \'Filter elements\' }}"></div><div class="panel-body" ng-if="!$ctrl.elems && !$ctrl.disabled"><em>You must select a {{ $ctrl.parent }}</em></div><div class="panel-body" ng-if="!$ctrl.elems && $ctrl.disabled"><em>Loading...</em></div><div class="list-group"><div ng-repeat="elem in filteredElems = ($ctrl.elems | filter:$ctrl.filter)" class="list-group-item tdef-item-{{ elem.type }} clickable" ng-class="{ active: elem.active }" ng-click="$ctrl.select(elem)"><h4 class="list-group-item-heading" ng-class="{ \'no-margin\': ($ctrl.props.length === 0) }">{{ elem.name }}</h4><p class="list-group-item-text" ng-if="$ctrl.props.length > 0" ng-repeat="prop in $ctrl.props"><span class="capitalize">{{ prop.title || prop }}:</span> <span>{{ elem[prop.prop || prop] }}</span></p></div></div></div>'),e.put("app/libraries/libraries.html",'<div class="libs-container"><div class="row-fluid" id="libraries-inner-container"><div class="col-sm-6 col-md-3 col-lg-2 no-padding fit-y"><klist data-title="Namespaces" data-elems="vm.namespaces" data-props="[\'owner\']" data-placeholder="Filter by name, owner" data-on-select="vm.selectNs(elem)" data-disabled="vm.disabled"></div><div class="col-sm-6 col-md-4 col-lg-2 no-padding fit-y"><klist data-parent="Namespace" data-title="TypeDefinitions" data-elems="vm.tdefs" data-props="[{ title: \'LATEST\', prop: \'version\' }]" data-placeholder="Filter by name, type, version" data-on-select="vm.selectTdef(elem)" data-disabled="vm.disabled"></div><div class="col-sm-6 col-md-5 col-lg-8 no-padding fit-y"><tdef-detail tdef="vm.tdefDetail" versions="vm.tdefDetailVersions" on-version-changed="vm.changeTdefVersion(tdef)" data-disabled="vm.disabled" on-add-dus-to-model="vm.addDusToModel(dus)"></div></div></div>'),e.put("app/libraries/tdef-detail.html",'<div class="tdef-detail clearfix"><div class="row-fluid breath-bottom-sm clearfix"><div class="panel panel-kevoree" ng-disabled="$ctrl.disabled"><div class="panel-heading"><span ng-if="!$ctrl.tdef">-</span> <span ng-if="$ctrl.tdef">{{ $ctrl.tdef.namespace + \'.\' + $ctrl.tdef.name }}</span> <span class="pull-right"><select class="form-control" ng-model="$ctrl.selectedVersion" ng-options="tdef as tdef.version for tdef in versions = ($ctrl.versions | orderBy:\'version\':true) track by tdef.id" ng-change="$ctrl.changeVersion()" ng-disabled="$ctrl.disabled || $ctrl.versions.length === 0 || !$ctrl.versions"></select></span></div><div class="panel-body breath-all-sm"><div class="table-responsive breath-bottom-sm"><table class="table table-striped table-condensed no-margin"><thead><tr><th class="col-xs-1">ID</th><th>Description</th></tr></thead><tbody><tr><td class="col-xs-1"><a href="{{ $ctrl.baseUrl + \'#/tdefs/\' + $ctrl.tdef.id }}" target="_blank" class="value" ng-if="$ctrl.tdef">#{{ $ctrl.tdef.id }}</a></td><td><p ng-if="!$ctrl.tdef.description">-</p><truncate data-content="$ctrl.tdef.description" data-length="200" ng-if="$ctrl.tdef.description"></td></tr></tbody></table></div><div class="row-fluid breath-top-sm clearfix"><div class="col-lg-6 no-padding breath-right-sm"><dus-installer tag="RELEASE" dus="$ctrl.tdef.releases" data-disabled="$ctrl.disabled" on-add-to-model="$ctrl.addDusToModel(dus)"></div><div class="col-lg-6 no-padding breath-left-sm"><dus-installer tag="LATEST" dus="$ctrl.tdef.latests" data-disabled="$ctrl.disabled" on-add-to-model="$ctrl.addDusToModel(dus)"></div></div></div></div></div></div>'),e.put("app/main/main.html",'<div class="menubar"><div class="menu-btn" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle><span>File</span> <span>&nbsp;</span> <span class="caret"></span></button><ul class="dropdown-menu" uib-dropdown-menu role="menu"><li><a ng-click="open($event)"><span class="name">Open</span> <span class="shortcut">Ctrl+O</span></a></li><li><a ng-click="merge($event)"><span class="name">Merge</span> <span class="shortcut">Ctrl+M</span></a></li><li><a ng-click="openFromNode($event)"><span class="name">Open from node</span> <span class="shortcut">Ctrl+Shift+O</span></a></li><li><a ng-click="mergeFromNode($event)"><span class="name">Merge from node</span> <span class="shortcut">Ctrl+Shift+M</span></a></li><li class="divider"></li><li><a ng-click="save($event)"><span class="name">Save</span> <span class="shortcut">Ctrl+S</span></a></li></ul></div><div class="menu-btn" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle><span>Edit</span> <span>&nbsp;</span> <span class="caret"></span></button><ul class="dropdown-menu" uib-dropdown-menu role="menu"><li><a ng-click="copy()"><span class="name">Copy selected instance(s)</span> <span class="shortcut">Ctrl+C</span></a></li><li><a ng-click="paste()"><span class="name">Paste selected instance(s)</span> <span class="shortcut">Ctrl+V</span></a></li><li class="divider"></li><li><a ng-click="fixOverlapping($event)"><span class="name">Fix overlapping</span> <span class="shortcut">Alt+O</span></a></li><li class="divider"></li><li><a ng-click="deleteAll($event)"><span class="name">Delete all</span> <span class="shortcut">Alt+Shift+D</span></a></li><li><a ng-click="deleteInstances($event)"><span class="name">Delete instances</span> <span class="shortcut">Alt+Shift+I</span></a></li><li><a ng-click="deleteSelection($event)"><span class="name">Delete selection</span> <span class="shortcut">Del</span></a></li></ul></div><div class="menu-btn"><button type="button" class="btn btn-default" ng-click="toggleShortcutHelp()">Help</button></div><div class="menu-btn pull-right" ng-switch on="synced"><button type="button" class="btn btn-default" ng-click="connectSync($event)" ng-switch-when="false">Connect</button> <span ng-switch-when="true" style="color: green">{{url}}</span> <button type="button" class="btn btn-default" ng-click="disconnectSync($event)" ng-switch-when="true">Disconnect</button></div></div><div id="tdef-drag-panel"><div ui-view="typedefs"></div><div ui-view="editor"></div><div ui-view="instance"></div></div><input id="file" type="file" on-data="onFileLoaded($name, $data)" class="hide">'),e.put("app/navbar/navbar.html",'<div id="navbar" class="navbar navbar-inverse navbar-top navbar-fixed-top" ng-cloak><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle" ng-click="vm.isCollapsed = !vm.isCollapsed"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand navbar-img"><img src="content/images/kevoree-fed4db278e.png"></a></div><div class="navbar-collapse collapse" uib-collapse="vm.isCollapsed"><ul class="nav navbar-left navbar-nav"><li ng-class="{active: vm.$state.includes(\'main\')}"><a data-ui-sref="main" ng-click="!vm.isCollapsed ? (vm.isCollapsed = !vm.isCollapsed):\'\'">Model View</a></li><li ng-class="{active: vm.$state.includes(\'treeview\')}"><a data-ui-sref="treeview" ng-click="!vm.isCollapsed ? (vm.isCollapsed = !vm.isCollapsed):\'\'">Tree View</a></li><li ng-class="{active: vm.$state.includes(\'libraries\')}"><a data-ui-sref="libraries" ng-click="!vm.isCollapsed ? (vm.isCollapsed = !vm.isCollapsed):\'\'">Registry Libraries</a></li><li ng-class="{active: vm.$state.includes(\'kevscript\')}"><a data-ui-sref="kevscript" ng-click="!vm.isCollapsed ? (vm.isCollapsed = !vm.isCollapsed):\'\'">KevScript Editor</a></li></ul><ul class="nav navbar-right navbar-nav"><li ng-class="{active: vm.$state.includes(\'settings\')}"><a data-ui-sref="settings" ng-click="!vm.isCollapsed ? (vm.isCollapsed = !vm.isCollapsed):\'\'">Settings</a></li></ul><div></div></div></div></div>'),e.put("app/settings/settings.html",'<div class="settings-container"><div class="col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 well" ng-cloak><h4>Kevoree Web Editor settings:</h4><ul class="list-group list-group-with-buttons"><li class="list-group-item clearfix"><div class="col-sm-6">Version</div><div class="col-sm-6"><span class="pull-right">{{ VERSION }}</span></div></li><li class="list-group-item clearfix"><div class="col-sm-6">Kevoree Registry</div><div class="col-sm-offset-1 col-sm-5 col-lg-offset-2 col-lg-4"><div class="input-group input-group-sm"><input type="text" class="form-control" placeholder="ie. {{ getUrl() }}" ng-model="registryUrl"> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="changeKevoreeRegistry()" ng-disabled="!canChangeKevoreeRegistry()">Save</button></span></div></div></li><li class="list-group-item clearfix"><div class="col-sm-6">KevScript LocalStorage Cache</div><div class="col-sm-6"><button class="btn btn-sm btn-warning pull-right" type="button" ng-click="clearKevScriptCache()" ng-disabled="!canClearKevScriptCache()">Clear</button></div></li></ul></div></div>'),e.put("app/treeview/treeview.html",'<div class="menubar"><div class="menu-btn" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle><span>File</span> <span>&nbsp;</span> <span class="caret"></span></button><ul class="dropdown-menu" uib-dropdown-menu role="menu"><li><a ng-click="open($event)"><span class="name">Open</span> <span class="shortcut">Ctrl+O</span></a></li><li><a ng-click="merge($event)"><span class="name">Merge</span> <span class="shortcut">Ctrl+M</span></a></li><li><a ng-click="openFromNode($event)"><span class="name">Open from node</span> <span class="shortcut">Ctrl+Shift+O</span></a></li><li><a ng-click="mergeFromNode($event)"><span class="name">Merge from node</span> <span class="shortcut">Ctrl+Shift+M</span></a></li><li class="divider"></li><li><a ng-click="save($event)"><span class="name">Save</span> <span class="shortcut">Ctrl+S</span></a></li></ul></div><div class="menu-btn" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle><span>Edit</span> <span>&nbsp;</span> <span class="caret"></span></button><ul class="dropdown-menu" uib-dropdown-toggle role="menu"><li><a ng-click="deleteAll($event)"><span class="name">Delete all</span> <span class="shortcut">Alt+Shift+D</span></a></li><li><a ng-click="deleteInstances($event)"><span class="name">Delete instances</span> <span class="shortcut">Alt+Shift+I</span></a></li><li><a ng-click="deleteSelected($event)"><span class="name">Delete selected</span> <span class="shortcut">Del</span></a></li></ul></div><div class="menu-btn"><button type="button" class="btn btn-default" ng-click="toggleShortcutHelp()">Help</button></div></div><div class="tree-container"><div class="col-md-4 col-lg-3 fit-y"><div class="well fit-y"><div class="row clearfix"><div class="col-xs-12"><div class="form-group form-group-filter" ng-class="{\'has-error\':filterError}"><div class="input-group input-group-sm"><input type="text" class="form-control" placeholder="Filter by name:*, tag:*, is:*, vers:*" ng-model="filterExpr" ng-change="onFilterExprChanged()"> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="clearFilter()" title="Clear filter" ng-disabled="!filterExpr.length"><i class="fa fa-times"></i></button></span></div><span class="help-block filter-error">{{ filterError }}</span></div></div></div><div class="treeview-actions row"><div class="col-xs-12"><a href="" class="treeview-action" ng-click="collapse()" title="Collapse"><i class="fa fa-compress"></i> </a><a href="" class="treeview-action" ng-click="expand()" title="Expand"><i class="fa fa-expand"></i> </a><a href="" class="treeview-action" ng-click="toggleTags()" title="{{ showTags ? \'Hide tags\':\'Show tags\' }}"><i class="fa" ng-class="showTags ? \'fa-eye-slash\':\'fa-eye\'"></i> </a><a href="" class="treeview-action" ng-click="reverseSort()" title="{{ showTags ? \'Sort desc\':\'Sort asc\' }}"><i class="fa" ng-class="treeReverse ? \'fa-sort-alpha-desc\':\'fa-sort-alpha-asc\'"></i></a></div><div class="col-xs-12"><a href="" class="treeview-action" ng-click="selectAll()" title="Select all">All</a> <a href="" class="treeview-action" ng-click="selectNodes()" title="Select nodes">N</a> <a href="" class="treeview-action" ng-click="selectComponents()" title="Select components">C</a> <a href="" class="treeview-action" ng-click="selectGroups()" title="Select groups">G</a> <a href="" class="treeview-action" ng-click="selectChannels()" title="Select channels">Ch</a> <a href="" class="treeview-action" ng-click="clearSelected()" title="Clear selection"><i class="fa fa-square-o"></i> </a><span class="pull-right" title="selection / total">{{ selectedItems.length }} / {{ nbInstances }}</span></div></div><div class="treecontrol-container"><div id="treecontrol-scroll-container" class="treecontrol-inner-container"><em ng-if="items.length === 0">No instance in current model</em><ul class="list-unstyled tree" infinite-scroll="loadMore()" infinite-scroll-distance="0" infinite-scroll-container="\'#treecontrol-scroll-container\'"><li class="item" ng-repeat="item in items | doFilter:query | orderBy:\'name\':treeReverse | limitTo:limit track by item.path" ng-class="{ selected: item.selected, expanded: !item.folded }"><span class="icon {{ item.type }}"><i class="expand-handle fa" ng-class="!item.folded ? \'fa-minus\':\'fa-plus\'" ng-if="item.children && item.children.length > 0" ng-click="onExpand(item)"></i></span><div class="name" ng-click="onClick(item)" ng-mouseenter="item.hovered = true" ng-mouseleave="item.hovered = false"><span>{{ item.name }}</span> <em class="text-muted" ng-class="{ hide: !item.hovered }">{{ item.typeName + \'/\' + item.version }}</em> <span class="tag badge pull-right" ng-repeat="tag in item.tags" ng-if="showTags && item.tags.length < 3">{{ tag }}</span> <span class="tag badge pull-right" ng-if="showTags && item.tags.length >= 3" tooltip="tags: {{ item.tags.join(\', \') }}" tooltip-placement="right" tooltip-append-to-body="true">...</span></div><ul class="list-unstyled tree" ng-if="!item.folded"><li class="item" ng-repeat="child in item.children | doFilter:query | orderBy:\'name\':treeReverse track by child.path" ng-class="child.selected ? \'selected\':\'\'"><span class="icon {{ child.type }}"></span><div class="name" ng-click="onClick(child)" ng-mouseenter="child.hovered = true" ng-mouseleave="child.hovered = false"><span>{{ child.name }}</span> <em class="text-muted" ng-class="{ hide: !child.hovered }">{{ child.typeName + \'/\' + child.version }}</em> <span class="tag badge pull-right" ng-repeat="tag in child.tags" ng-if="showTags && child.tags.length < 3">{{ tag }}</span> <span class="tag badge pull-right" ng-if="showTags && child.tags.length >= 3" tooltip="tags: {{ child.tags.join(\', \') }}" tooltip-placement="right" tooltip-append-to-body="true">...</span></div></li></ul></li></ul></div></div></div></div><div class="treeview-rightpanel col-md-8 col-lg-9 fit-y"><uib-tabset class="tab-set"><uib-tab heading="Actions"><div class="tab-pane-container well"><tab-actions></tab-actions></div></uib-tab><uib-tab heading="Create"><div class="tab-pane-container well"><tab-create></tab-create></div></uib-tab><uib-tab heading="Params" ng-if="selectedItems.length"><div class="tab-pane-container well"><tab-params></tab-params></div></uib-tab><uib-tab heading="Tags" ng-if="selectedItems.length"><div class="tab-pane-container well"><tab-tags></tab-tags></div></uib-tab></uib-tabset></div></div><input id="file" type="file" on-data="onFileLoaded($name, $data)" class="hide">'),e.put("app/components/deploy-unit/dus-list.html",'<div class="list-group no-margin"><div ng-repeat="du in $ctrl.dus" class="deploy-unit list-group-item"><i class="icon {{ \'devicon-\' + $ctrl.platform(du) + \'-plain\' }} colored" title="{{$ctrl.platform(du)}}"></i> <span class="name"><span>{{ du.name }}</span> <a href="{{ $ctrl.baseUrl + \'#/dus/\' + du.id }}" target="_blank" class="value" ng-if="du.id">#{{ du.id }}</a> <span class="error" ng-if="du.error"><i class="glyphicon glyphicon-warning-sign" uib-tooltip="{{ du.error }}" tooltip-trigger="\'mouseenter\'" tooltip-placement="right"></i></span></span><br><span class="version">{{ du.version }}</span></div></div>'),e.put("app/components/dictionary/dictionary.html",'<form name="{{ $ctrl.name }}" class="instance-form"><div ng-hide="!$ctrl.fragment || $ctrl.dictionary.values.size() > 0"><p class="text-muted"><em>No value</em> - <a class="point-cursor" ng-click="$ctrl.dictionary.delete()">Delete dictionary?</a></p></div><div ng-repeat="(index, attr) in $ctrl.attrs | orderBy:\'name\'"><ng-form name="form"><div class="form-group" ng-class="form[attr.name].$valid ? \'\':\'has-error has-feedback\'"><label ng-attr-title="{{$ctrl.isTruish(attr.optional)?\'optional\':\'required\'}}">{{ attr.name + ($ctrl.isTruish(attr.optional) ? \'\':\' *\') }}</label><input ng-if="attr.datatype.name() === \'BYTE\' || attr.datatype.name() === \'CHAR\'" name="{{ attr.name }}" type="text" class="form-control input-sm" ng-model="($ctrl.dictionary.findValuesByID(attr.name)).value" ng-change="$ctrl.onChange($ctrl[$ctrl.name][attr.name])" ng-required="!$ctrl.isTruish(attr.optional)" ng-disabled="$ctrl.readOnly"> <span ng-if="attr.datatype.name() === \'BYTE\' || attr.datatype.name() === \'CHAR\'" class="glyphicon glyphicon-remove form-control-feedback" ng-hide="$ctrl[$ctrl.name][attr.name].$valid"></span><textarea ng-if="attr.datatype.name() === \'STRING\'" rows="1" name="{{attr.name}}" class="form-control input-sm" ng-model="($ctrl.dictionary.findValuesByID(attr.name)).value" ng-change="$ctrl.onChange($ctrl[$ctrl.name][attr.name])" ng-required="!$ctrl.isTruish(attr.optional)" style="resize: vertical" ng-disabled="$ctrl.readOnly">\n          </textarea><span ng-if="attr.datatype.name() === \'STRING\'" class="glyphicon glyphicon-remove form-control-feedback" ng-hide="$ctrl[$ctrl.name][attr.name].$valid"></span> <input ng-if="attr.datatype.name() === \'LONG\' || attr.datatype.name() === \'FLOAT\' || attr.datatype.name() === \'DOUBLE\' || attr.datatype.name() === \'SHORT\' || attr.datatype.name() === \'INT\'" name="{{ attr.name }}" type="number" step="any" class="form-control input-sm" string-to-number ng-model="($ctrl.dictionary.findValuesByID(attr.name)).value" ng-change="$ctrl.onChange($ctrl[$ctrl.name][attr.name])" ng-required="!$ctrl.isTruish(attr.optional)" ng-disabled="$ctrl.readOnly"> <span ng-if="attr.datatype.name() === \'LONG\' || attr.datatype.name() === \'FLOAT\' || attr.datatype.name() === \'DOUBLE\' || attr.datatype.name() === \'SHORT\' || attr.datatype.name() === \'INT\'" class="glyphicon glyphicon-remove form-control-feedback" ng-hide="$ctrl[$ctrl.name][attr.name].$valid"></span><div ng-if="attr.datatype.name() === \'BOOLEAN\'" class="btn-group btn-group-block clearfix"><label class="btn btn-sm btn-default" ng-model="($ctrl.dictionary.findValuesByID(attr.name)).value" uib-btn-radio="\'true\'" ng-disabled="$ctrl.readOnly">True</label><label class="btn btn-sm btn-default" ng-model="($ctrl.dictionary.findValuesByID(attr.name)).value" uib-btn-radio="\'false\'" ng-disabled="$ctrl.readOnly">False</label></div></div></ng-form></div></form>'),e.put("app/components/util/filename.modal.html",'<div class="modal-header"><h3 class="modal-title">{{ title }}</h3></div><div class="modal-body"><p>{{ body }}</p><label for="filename">Filename</label><input type="text" id="filename" class="form-control" ng-model="filename" data-ui-keypress="{13:\'save()\'}"></div><div class="modal-footer"><button class="btn btn-primary" ng-click="save()">Save</button> <button class="btn btn-warning" ng-click="$dismiss(\'cancel\')">Cancel</button></div>'),e.put("app/components/util/host-port-path.modal.html",'<div class="modal-header"><h3 class="modal-title">{{ title }}</h3></div><div class="modal-body"><div class="alert alert-danger" ng-show="error"><button type="button" class="close" ng-click="closeError()"><span>&times;</span></button> {{ error }}</div><form class="form-horizontal"><div class="form-group"><label for="host" class="col-sm-3 control-label input-sm">Hostname / IP</label><div class="col-sm-9"><input type="text" class="form-control input-sm" id="host" placeholder="Hostname or IP" ng-model="host" ng-keypress="confirm($event)" ng-change="onHostChange(host)"></div></div><div class="form-group"><label for="port" class="col-sm-3 control-label input-sm">Port</label><div class="col-sm-9"><input type="number" min="0" max="65535" class="form-control input-sm" id="port" placeholder="Port" ng-model="port" ng-keypress="confirm($event)"></div></div><div class="form-group"><label for="path" class="col-sm-3 control-label input-sm">Path</label><div class="col-sm-9"><input type="text" class="form-control input-sm" id="path" placeholder="Path" ng-model="path" ng-keypress="confirm($event)"></div></div></form></div><div class="modal-footer"><button class="btn btn-primary" ng-click="confirm()">{{ action }}</button> <button class="btn btn-warning" ng-click="$dismiss(\'cancel\')">Cancel</button></div>'),e.put("app/components/util/hotkeys.html",'<div class="editor-shortcuts-container fade" ng-class="{in: helpVisible}"><button type="button" class="editor-shortcuts-close close" ng-click="toggleCheatSheet()"><span>&times;</span></button><div class="editor-shortcuts-middle"><div class="editor-shortcuts-inner"><div class="container"><div class="col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6"><div class="row editor-shortcuts-row" ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><div class="col-xs-4"><div class="cfp-hotkeys-key" ng-repeat="key in hotkey.format() track by $index">{{ key }}</div></div><div class="col-xs-8">{{ hotkey.description }}</div></div></div></div></div></div></div>'),e.put("app/main/editor/editor.html",'<div id="editor-container" class="editor" data-drop="true" data-jqyoui-droppable="dropDroppable" data-jqyoui-options="dropOptions"><svg id="editor" width="100%" height="100%"></svg></div>'),e.put("app/main/editor/select-chan.modal.html",'<div class="modal-header"><h3 class="modal-title">Select a channel</h3></div><div class="modal-body"><div class="clearfix"><div class="alert alert-warning" ng-if="instances.length === 0 && types.length === 0"><p><strong>Warning</strong></p><p>Unable to find any compatible channel TypeDefinition or instances. You must have at least one channel type (that is compatible with the targetted node platform(s)) in order to connect ports together.</p></div><div class="col-sm-5"><p class="text-justify">You want to connect 2 <strong>ports</strong> together.<br>In Kevoree this is made by connecting those 2 ports to the same channel instance.<br>Select which channel you want to use in the right panel.</p></div><div class="col-sm-7"><div class="select-chan-panel panel"><div class="panel-heading">Available instances</div><div class="list-group"><div ng-if="instances.length === 0" class="list-group-item"><em>none found</em></div><a class="list-group-item point-cursor" ng-repeat="chan in instances" ng-click="select(chan)" ng-class="chan.selected ? \'active\':\'\'">{{ chan.typeDefinition.name }} <span class="pull-right">{{ chan.name }}</span></a></div><div class="panel-heading">or create a new instance</div><div class="list-group"><div ng-if="types.length === 0" class="list-group-item"><em>none found</em></div><a class="list-group-item point-cursor" ng-repeat="type in types" ng-click="select(type)" ng-class="type.selected ? \'active\':\'\'">{{ type.name }} <span class="pull-right">{{ \'v\' + type.version }}</span></a></div></div></div></div></div><div class="modal-footer"><button class="btn btn-primary" ng-click="confirm()" focus="200" ng-disabled="!isValid()">Confirm</button> <button class="btn btn-default" ng-click="$close()">Close</button></div>'),e.put("app/main/instance/group.modal.html",'<div class="modal-header"><h3 class="modal-title">Connection with group <strong>{{ group.name }}</strong></h3></div><div class="modal-body"><div class="alert alert-warning" ng-if="modelHasErrors"><button type="button" class="close" ng-click="closeModelHasErrorsWarning()"><span>&times;</span></button><p><strong>Warning</strong></p><p>Your current model contains error(s). Pushing it could break your running Kevoree runtimes.</p></div><h5>Choose the URI to connect to {{ group.name }}:</h5><p class="text-muted">The following data are retrieved from <strong>{{ group.name }}</strong> group dictionaries and to its attached nodes dictionaries and their respective Network Informations</p><div class="form-group input-group input-group-sm col-xs-12"><span class="input-group-addon" style="width: 60px">Host</span><select class="form-control" ng-model="selectedHost" ng-change="changeHost()" focus="200"><option value="{{ value }}" ng-repeat="(value, node) in hosts" ng-selected="value === selectedHost">{{ value + \' (\' + node + \')\' }}</option></select><span class="input-group-addon" style="width: 100px">{{ hosts[selectedHost] }}</span></div><div class="form-group input-group input-group-sm col-xs-12"><span class="input-group-addon" style="width: 60px">Port</span><select class="form-control" ng-model="selectedPort" ng-change="changePort()"><option value="{{ value }}" ng-repeat="(value, node) in ports" ng-selected="value === selectedPort">{{ value + \' (\' + node + \')\' }}</option></select><span class="input-group-addon" style="width: 100px">{{ ports[selectedPort] }}</span></div><div class="form-group input-group input-group-sm col-xs-12"><span class="input-group-addon" style="width: 60px">Path</span><select class="form-control" ng-model="selectedPath" ng-change="changePath()"><option value="{{ value }}" ng-repeat="(value, node) in paths" ng-selected="value === selectedPath">{{ value + \' (\' + node + \')\' }}</option></select><span class="input-group-addon" style="width: 100px">{{ paths[selectedPath] }}</span></div><div ng-if="processing"><hr><h5 class="text-center">Trying to connect to <strong>{{ \'ws://\' + selectedHost + \':\' + selectedPort + selectedPath }}</strong></h5><div class="spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div></div></div><div ng-if="error"><hr><div class="alert alert-danger"><button type="button" class="close" ng-click="closeError()"><span>&times;</span></button><p><strong>Error</strong></p><p>{{ error }}</p></div></div><div ng-if="success"><hr><div class="alert alert-success"><button type="button" class="close" ng-click="closeSuccess()"><span>&times;</span></button><p><strong>Success</strong></p><p>Model {{ action }} <strong>{{ \'ws://\' + selectedHost + \':\' + selectedPort + selectedPath }}</strong></p></div></div></div><div class="modal-footer"><button class="btn btn-primary text-capitalize" ng-click="push()" ng-disabled="processing">Push</button> <button class="btn btn-primary text-capitalize" ng-click="pull()" ng-disabled="processing">Pull</button> <button class="btn btn-default" ng-click="close()">Close</button></div>'),e.put("app/main/instance/instance.html",'<div class="sidebar sidebar-right sidebar-right-{{vm.type}}" ng-if="vm.instance"><div ng-class="vm.type+\'-right-bg\'"><h5 class="sidebar-header sidebar-header-right text-capitalize point-cursor" ng-click="vm.mainCollapsed = !vm.mainCollapsed"><i class="fa" ng-class="vm.mainCollapsed ? \'fa-plus\':\'fa-minus\'"></i> &nbsp;{{ vm.instance.typeDefinition.name }}</h5></div><div class="instance-form" uib-collapse="vm.mainCollapsed"><div class="instance-metas pull-right"><i class="fa fa-cube" title="Virtual type" ng-if="vm.isVirtual()"></i> <i class="fa fa-lock" title="Read-only instance" ng-if="vm.isReadOnly()"></i></div><form name="form"><div class="form-group" ng-class="form.name.$valid ? \'\':\'has-error has-feedback\'"><label for="name">Name</label><input id="name" name="name" type="text" class="form-control input-sm" placeholder="Instance name" ng-model="vm.instance.preName" ng-change="vm.changeName(form, vm.instance.preName)" data-instance="vm.instance" data-instance-name data-instance-type="vm.type" ng-disabled="vm.isReadOnly()" required> <span class="glyphicon glyphicon-remove form-control-feedback" ng-hide="form.name.$valid"></span><p class="help-block" ng-if="!form.name.$valid">Name must be unique and not null</p></div><div class="form-group"><label for="version">Version</label><select id="version" class="form-control input-sm" ng-model="vm.instance.selectedVersion" ng-options="version for version in vm.versions" ng-change="vm.changeVersion(vm.instance.selectedVersion)" ng-disabled="vm.isReadOnly()"></select></div><div class="form-group clearfix"><label>DeployUnits</label><div ng-if="!vm.dus || vm.dus.length === 0"><em ng-if="vm.isVirtual()">- virtual type -</em> <em ng-if="!vm.isVirtual()">- empty -</em></div><dus-list dus="vm.dus"></div><div class="form-group clearfix"><label>State</label><div class="btn-group btn-group-block"><label class="btn btn-sm btn-default" ng-model="vm.instance.started" uib-btn-radio="true" ng-disabled="vm.isReadOnly()">Started</label><label class="btn btn-sm btn-default" ng-model="vm.instance.started" uib-btn-radio="false" ng-disabled="vm.sReadOnly()">Stopped</label></div></div></form></div><div><div ng-class="type+\'-right-bg\'"><h5 class="sidebar-header sidebar-header-right point-cursor" ng-click="descCollapsed = !descCollapsed"><i class="fa" ng-class="vm.descCollapsed ? \'fa-plus\':\'fa-minus\'"></i> &nbsp;Description</h5></div><div class="instance-form" uib-collapse="vm.descCollapsed"><truncate content="vm.description" length="200"></div></div><div ng-switch="vm.processing"><div ng-switch-when="true"><div class="instance-form"><h4 class="text-center">Loading</h4><div class="spinner spinner-white"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div></div></div></div><div ng-switch-when="false"><!-- Dictionary panel --><div ng-show="vm.instance.dictionary.values.size() > 0"><div ng-class="type+\'-right-bg\'"><h5 class="sidebar-header sidebar-header-right point-cursor" ng-click="vm.dicCollapsed = !vm.dicCollapsed"><i class="fa" ng-class="vm.dicCollapsed ? \'fa-plus\':\'fa-minus\'"></i> &nbsp;Dictionary</h5></div><div uib-collapse="vm.dicCollapsed"><dictionary data-name="dicForm" data-attrs="vm.dicAttrs" data-dictionary="vm.instance.dictionary" data-fragment="false"></div></div><!-- Fragment Dictionary panels --><div ng-repeat="fragDic in vm.instance.fragmentDictionary.array"><div ng-class="type+\'-right-bg\'"><h5 class="sidebar-header sidebar-header-right point-cursor" ng-click="vm.fragCollapsed[fragDic.name] = !vm.fragCollapsed[fragDic.name]"><i class="fa" ng-class="vm.fragCollapsed[fragDic.name] ? \'fa-plus\':\'fa-minus\'"></i> &nbsp;Fragment Dictionary - <strong>{{ fragDic.name }}</strong></h5></div><div uib-collapse="vm.fragCollapsed[fragDic.name]"><dictionary data-name="{{fragDic.name}}" data-attrs="vm.fragDicAttrs" data-dictionary="fragDic" data-fragment="true"></div></div><!-- Network panel --><div ng-show="vm.hasNetworkInformation()"><div ng-repeat="net in vm.instance.networkInformation.array"><div ng-class="type+\'-right-bg\'"><h5 class="sidebar-header sidebar-header-right point-cursor clearfix" ng-click="vm.netCollapsed = !vm.netCollapsed"><i class="fa" ng-class="vm.netCollapsed ? \'fa-plus\':\'fa-minus\'"></i> &nbsp;Network Informations - <strong>{{ net.name }}</strong> <a class="point-cursor" class="pull-right" ng-click="vm.manageNetwork($event, net)"><i class="fa fa-cog"></i></a></h5></div><div uib-collapse="vm.netCollapsed"><div class="instance-form"><div class="form-group" ng-repeat="val in net.values.array | orderBy:\'name\'"><label for="net-{{ net.name + \'-\' + val.name }}">{{ val.name }}</label><input id="net-{{ net.name + \'-\' + val.name }}" name="net-{{ net.name + \'-\' + val.name }}" type="text" class="form-control input-sm" ng-model="val.value"></div></div></div></div><div class="instance-form"><a class="point-cursor" ng-click="vm.addNetwork()">Add new network</a></div></div></div></div></div><div class="sidebar sidebar-right sidebar-right-footer" ng-if="vm.instance && (vm.type === \'group\')"><div class="btn-container"><button class="btn btn-default" ng-click="vm.openGroupModal()" ng-disabled="vm.instance.subNodes.size() === 0" focus="true">Push/Pull model</button></div></div>'),
e.put("app/main/instance/network.modal.html",'<div class="modal-header"><h3 class="modal-title">Network <strong>{{ node.name + \'.\' + net.name }}</strong></h3></div><div class="modal-body"><form name="form" class="instance-form"><!-- Network name --><div class="form-group" ng-class="form.name.$valid ? \'\':\'has-error has-feedback\'"><label for="name">Name</label><input id="name" name="name" type="text" class="form-control input-sm" placeholder="Network name" ng-model="net.name" required focus="200"> <span class="glyphicon glyphicon-remove form-control-feedback" ng-hide="form.name.$valid"></span></div><!-- Add value form --><label>Add value</label><div class="row form-group" ng-class="form.newValName.$valid ? \'\':\'has-error has-feedback\'"><div class="col-sm-5 col-xs-11"><input id="newValName" name="newValName" type="text" class="form-control input-sm" placeholder="ie: lo, eth0" ng-model="newVal.name" data-ui-keypress="{13: \'addNewVal()\'}" min="1"></div><div class="col-sm-6 col-xs-11"><input name="newValValue" type="text" class="form-control input-sm" placeholder="ie: 127.0.0.1, localhost" ng-model="newVal.value" data-ui-keypress="{13: \'addNewVal()\'}" min="1"></div><div class="col-sm-1 col-xs-1" style="line-height: 30px"><a class="point-cursor" ng-click="addNewVal()" title="Add new value ?"><i class="fa fa-plus"></i></a></div></div><!-- Values list --><label>Values</label><div ng-show="net.values.size() === 0"><p><em>&lt;no value&gt;</em></p></div><div class="row form-group" ng-repeat="(index, val) in net.values.array | orderBy:\'name\'"><div class="col-sm-5 col-xs-11"><input name="valName{{index}}" type="text" class="form-control input-sm" placeholder="ie: lo, eth0" ng-model="val.name"></div><div class="col-sm-6 col-xs-11"><input name="valValue{{index}}" type="text" class="form-control input-sm" placeholder="ie: 127.0.0.1, localhost" ng-model="val.value"></div><div class="col-sm-1 col-xs-1" style="line-height: 30px"><a class="point-cursor" ng-click="val.delete()" title="Delete {{ net.eContainer().name + \'.\' + net.name + \'.\' + val.name }} ?"><i class="fa fa-trash"></i></a></div></div></form></div><div class="modal-footer"><button class="btn btn-warning" ng-click="delete()" ng-show="node.findNetworkInformationByID(net.name)">Delete</button> <button class="btn btn-primary" ng-click="add()" ng-hide="node.findNetworkInformationByID(net.name)" ng-disabled="!canSave()">Save</button> <button class="btn btn-default" ng-click="$close()">Close</button></div>'),e.put("app/main/typedefs/typedef-tooltip.html",'<div class="breath-bottom-sm"><h5 style="text-align: left"><strong>Description:</strong></h5><p ng-if="tdef.description" class="text-justify" ng-bind-html="tdef.description | trustHtml"></p><p ng-if="!tdef.description">- none -</p><h5 style="text-align: left"><strong>DeployUnits:</strong></h5><p ng-if="tdef.deployUnits.length === 0">- none -</p><dus-list dus="tdef.deployUnits"></div>'),e.put("app/main/typedefs/typedefs.html",'<div class="sidebar"><h5 class="sidebar-header">Type Definitions</h5><div class="sidebar-helper text-muted text-justify" ng-hide="hasPackages()"><p><em>No TypeDefinition in current model</em></p><br><p>You can load a <strong>.json</strong> model from a file (Ctrl+O) or from a node somewhere using WebSocket (Ctrl+Shift+O)</p><br><p>You can also create your own model using the <a data-ui-sref="kevscript">KevScript Editor</a> or by adding TypeDefinitions from the <a data-ui-sref="libraries">Registry Libraries</a></p></div><div class="pkg-panel" ng-repeat="pkg in packages | orderBy:\'name\'"><h4 class="pkg-title" ng-click="pkg.collapsed = !pkg.collapsed"><i class="fa" ng-class="pkg.collapsed ? \'fa-plus\' : \'fa-minus\'"></i> <span>&nbsp;</span> <span>{{ pkg.name }}</span></h4><div uib-collapse="pkg.collapsed"><div class="tdef-list"><div class="tdef-item" ng-repeat="tdef in pkg.tdefs | orderBy:\'name\'" ng-class="\'tdef-item-\'+tdef.type" ng-dblclick="addInstance(tdef)" data-drag="true" data-jqyoui-draggable="dragDraggable" data-jqyoui-options="dragOptions" data-pkg-path="{{ tdef.pkgPath }}" uib-tooltip-template="\'app/main/typedefs/typedef-tooltip.html\'" tooltip-placement="right" tooltip-popup-delay="650" tooltip-append-to-body="true">{{ tdef.name }}</div></div></div></div></div>'),e.put("app/treeview/tab-actions/tab-actions.html",'<div class="row"><div class="col-md-8 col-sm-6"><fieldset><legend>Select instances by tags</legend><div ng-if="tagsCount === 0"><p>There is no tag in the model.</p><p><em>To add tags, select instances in the left panel and go to the <strong>Tags</strong> tab.</em></p></div><a href="" ng-click="selectByTag(items)" ng-repeat="(tag, items) in tags" style="text-decoration: none"><span class="tag badge"><span>{{ tag }}</span></span></a></fieldset></div><div class="col-md-4 col-sm-6"><div class="row"><span class="hidden-lg breath"></span><fieldset><legend>Push/Pull model</legend><div class="form-group col-xs-12"><label for="selectGroup">Group</label><select class="form-control" name="selectGroup" ng-model="selectedGroup" ng-disabled="groups.length === 0" ng-options="group as group.name for group in groups | orderBy:\'name\'"></select><span class="help-block" ng-if="selectedGroup.subNodes.array.length === 0">You must attach this group to a node in order to push/pull</span></div><div class="col-xs-12"><button class="btn btn-default" ng-click="openGroupModal()" ng-disabled="!selectedGroup || selectedGroup.subNodes.array.length === 0">Push/Pull model</button></div></fieldset></div></div></div>'),e.put("app/treeview/tab-create/tab-create.html",'<fieldset><legend>Instances creation</legend><div class="row"><div class="form-group col-sm-4 col-lg-2"><label for="type">Meta type</label><select name="type" class="form-control" ng-model="selectedType" ng-change="onTypeChange()" ng-options="type as type for type in types"></select></div><div class="form-group col-sm-8 col-lg-10"><label for="instanceType">Type</label><select name="instanceType" class="form-control" ng-model="selectedInstanceType" ng-disabled="!areInstanceTypesValid()" ng-options="tdef.name for tdef in instanceTypes[selectedType] | isCompatible:selectedType:selectedNode.name"></select><span class="help-block" ng-if="instanceTypes[selectedType].length === 0">No {{ selectedType }} type available in current model. <a ui-sref="libraries">Add some</a></span></div></div><div class="row"><div class="form-group col-xs-12"><label for="nbInstances">How many instances to create</label><input name="nbInstances" type="number" min="1" class="form-control" ng-model="instancesCount" ng-disabled="!isValid()" ng-change="verifyName()"></div></div><div class="row"><div class="form-group col-xs-12"><label for="namePattern">Naming pattern</label><div class="input-group"><input name="namePattern" type="text" class="form-control" ng-model="namePattern" ng-disabled="!isValid()" ng-change="verifyName()"> <span class="input-group-addon"><em>eg:</em> {{ namePattern | namingPattern:{index: 0, metatype: selectedType} }}</span></div><span class="help-block"><span class="help-text" tooltip="The selected meta type name (current: {{ selectedType }})" tooltip-placement="right">{metatype}</span>,&nbsp; <span class="help-text" tooltip="The value will be the current iteration index value" tooltip-placement="right">{index}</span>,&nbsp; <span class="help-text" tooltip="Specify the range with {randomInt:min:max}" tooltip-placement="right">{randomInt}</span>,&nbsp; <span class="help-text" tooltip="Specify the length with {randomStr:length}" tooltip-placement="right">{randomStr}</span></span></div></div><div class="row"><div class="form-group form-group-sm col-xs-12"><label class="control-label">State</label><div class="btn-group btn-group-block clearfix"><label class="btn btn-sm btn-default" ng-model="state.started" uib-btn-radio="true" ng-disabled="!isValid()">Started</label><label class="btn btn-sm btn-default" ng-model="state.started" uib-btn-radio="false" ng-disabled="!isValid()">Stopped</label></div></div></div><div class="row"><div class="form-group col-xs-12"><label for="tags">Tag instances</label><input name="tags" type="text" class="form-control" ng-model="tags" ng-disabled="!isValid()" placeholder="comma-separated list of tags"></div></div><div class="row"><div class="col-xs-12" ng-if="message"><div class="alert alert-{{ message.type }}">{{ message.content }}</div></div><div class="col-xs-12"><button class="btn btn-default" ng-click="create()" ng-disabled="!isValid()">Create</button></div></div></fieldset>'),e.put("app/treeview/tab-params/tab-params.html",'<div ng-if="error"><div class="alert alert-warning" ng-if="error"><strong>Warning</strong><p>Selected instances must be of <strong>same type &amp; version</strong> in order to set parameters, those two differ:<ul><li ng-repeat="type in types">{{ type }}</li></ul></p></div></div><div ng-if="!error"><fieldset><legend>{{ typeName }}</legend><div class="row"><div class="col-md-4"><div class="form-group form-group-sm"><label class="control-label" for="instanceState">state *</label><div class="row-fluid clearfix"><div class="btn-group btn-group-block clearfix"><label class="btn btn-sm btn-default" ng-model="state.started" uib-btn-radio="true">Started</label><label class="btn btn-sm btn-default" ng-model="state.started" uib-btn-radio="false">Stopped</label></div></div></div></div></div><div class="row" ng-repeat="attr in dictionary"><div ng-switch="attr.type"><div class="clearfix" ng-switch-when="text"><div class="col-md-4"><div class="form-group form-group-sm"><label class="control-label" for="{{ attr.name }}">{{ attr.name + (attr.optional ? \'\':\' *\') }}</label><div class="row-fluid clearfix"><textarea name="{{ attr.name }}" class="form-control" rows="1" placeholder="{{ attr.defaultValue ? \'Default: \' + attr.defaultValue : \'\' }}" ng-model="attr.value" ng-disabled="each[attr.name]"></textarea></div></div></div><div class="col-xs-12 col-md-8 text-right"><div class="form-group form-group-sm"><label class="control-label"></label><div class="form-inline"><input type="text" class="form-control input-sm" placeholder="Prepend" ng-model="prepend[attr.name]" ng-init="prepend[attr.name] = \'\'" style="width: 80px"> <input type="number" class="form-control input-sm" placeholder="Length" ng-model="length[attr.name]" ng-init="length[attr.name] = 5" style="width: 80px"> <input type="text" class="form-control input-sm" placeholder="Append" ng-model="append[attr.name]" ng-init="append[attr.name] = \'\'" style="width: 80px"> <button class="btn btn-sm btn-default input-sm" ng-click="random(attr)" ng-disabled="each[attr.name]">Generate</button><div class="checkbox"><label><input type="checkbox" ng-model="each[attr.name]" ng-init="each[attr.name] = false">&nbsp; <span class="help-text" tooltip="Generate a new value for each instance" tooltip-placement="left">Each</span></label></div></div></div></div></div><div ng-switch-when="number"><div class="col-md-4"><div class="form-group form-group-sm"><label class="control-label" for="{{ attr.name }}">{{ attr.name + (attr.optional ? \'\':\' *\') }}</label><div class="row-fluid clearfix"><input name="{{ attr.name }}" type="number" class="form-control" placeholder="{{ attr.defaultValue ? \'Default: \' + attr.defaultValue : \'\' }}" ng-model="attr.value" ng-disabled="each[attr.name]"></div></div></div><div class="col-xs-12 col-md-8 text-right"><div class="form-group form-group-sm"><label class="control-label"></label><div class="form-inline"><input type="number" class="form-control" placeholder="Min value" ng-model="min[attr.name]" ng-init="min[attr.name] = 0" style="width: 80px"> <input type="number" class="form-control" placeholder="Max value" ng-model="max[attr.name]" ng-init="max[attr.name] = 65535" style="width: 80px"> <button class="btn btn-sm btn-default" ng-click="random(attr)" ng-disabled="each[attr.name]">Generate</button><div class="checkbox"><label><input type="checkbox" ng-model="each[attr.name]" ng-init="each[attr.name] = false">&nbsp; <span class="help-text" tooltip="Generate a new value for each instance" tooltip-placement="left">Each</span></label></div></div></div></div></div><div ng-switch-when="boolean"><div class="col-md-4"><div class="form-group form-group-sm"><label class="control-label" for="{{ attr.name }}">{{ attr.name + (attr.optional ? \'\':\' *\') }}</label><div class="row-fluid clearfix"><div class="btn-group btn-group-block clearfix" ng-disabled="each[attr.name]"><label class="btn btn-sm btn-default" ng-model="attr.value" uib-btn-radio="\'true\'">True</label><label class="btn btn-sm btn-default" ng-model="attr.value" uib-btn-radio="\'false\'">False</label></div></div></div></div><div class="col-xs-12 col-md-8 text-right"><div class="form-group form-group-sm"><label class="control-label"></label><div class="form-inline"><button class="btn btn-sm btn-default" ng-click="random(attr)" ng-disabled="each[attr.name]">Generate</button><div class="checkbox"><label><input type="checkbox" ng-model="each[attr.name]" ng-init="each[attr.name] = false">&nbsp; <span class="help-text" tooltip="Generate a new value for each instance" tooltip-placement="left">Each</span></label></div></div></div></div></div></div></div><fieldset ng-if="nets.length > 0" collapsed="networkCollapsed"><legend>Network Information <a ng-click="networkCollapsed = !networkCollapsed"><i class="fa fa-plus"></i></a></legend><div class="col-md-6" ng-repeat="net in nets"><!-- Network name --><div class="form-group"><label for="name">Name</label><input name="name" type="text" class="form-control input-sm" placeholder="Network name" ng-model="net.name"></div><!-- Add value form --><label>Add value</label><div class="row form-group"><div class="col-sm-5 col-xs-11"><input name="newValName" type="text" class="form-control input-sm" placeholder="ie: lo, eth0" ng-model="newVal.name" ui-keypress="{13: \'addNewVal()\'}"></div><div class="col-sm-6 col-xs-11"><input name="newValValue" type="text" class="form-control input-sm" placeholder="ie: 127.0.0.1, localhost" ng-model="newVal.value" ui-keypress="{13: \'addNewVal()\'}"></div><div class="col-sm-1 col-xs-1" style="line-height: 30px"><a class="point-cursor" ng-click="addNewVal()" title="Add new value ?"><i class="fa fa-plus"></i></a></div></div><!-- Values list --><label>Values</label><div ng-if="net.values.length === 0"><p><em>&lt;no value&gt;</em></p></div><div class="row form-group" ng-repeat="(index, val) in net.values | orderBy:\'name\'"><div class="col-sm-5 col-xs-11"><input name="valName{{index}}" type="text" class="form-control input-sm" placeholder="ie: lo, eth0" ng-model="val.name"></div><div class="col-sm-6 col-xs-11"><input name="valValue{{index}}" type="text" class="form-control input-sm" placeholder="ie: 127.0.0.1, localhost" ng-model="val.value"></div><div class="col-sm-1 col-xs-1" style="line-height: 30px"><a class="point-cursor" ng-click="val.delete()" title="Delete {{ net.name + \'.\' + val.name }} ?"><i class="fa fa-trash"></i></a></div></div></div></fieldset><div class="col-xs-12"><button class="btn btn-default" ng-click="applyToAllInstances()">Apply to selection</button> <span ng-show="message" class="text-{{message.type}}">{{ message.content }}</span><div class="pull-right"><button class="btn btn-default" ng-click="allRandom()">All random</button> <button class="btn btn-default" ng-click="toggleEach()">Toggle each</button></div></div></fieldset></div>'),e.put("app/treeview/tab-tags/tab-tags.html",'<div class="row"><div class="col-md-8"><fieldset><legend>List of tags</legend><p class="text-muted" style="text-align: justify">Tags allow you to create arbitrary set of instances. You can remove a previously added tag by clicking on the cross next to its name.</p><p ng-if="tags.length === 0"><em>There is no tag for the current selection</em></p><span class="tag badge" ng-repeat="tag in tags"><span>{{ tag }}</span> <a href="" ng-click="removeTag(tag)"><i class="fa fa-times"></i></a></span></fieldset></div><div class="col-md-4"><fieldset><legend>Tag the selection</legend><p class="text-muted" style="text-align: justify">Add a tag to the current selection</p><div class="input-group" ng-class="error ? \'has-error has-feedback\':\'\'"><input type="text" class="form-control" ng-model="tag" placeholder="Tag name" ui-keypress="{13: \'addTag()\'}" ng-change="validate()"> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="addTag()" ng-disabled="error || tag.length === 0">Add</button></span></div><span class="text-danger" ng-if="error">{{ error }}</span></fieldset></div></div>')}])}();
//# sourceMappingURL=app-7acaacc074.js.map
